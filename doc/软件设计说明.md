# 接口故障机理分析原型系统软件设计说明

## 1. 引言

### 1.1 编写目的
本文档旨在按照通用软件工程标准模板，对接口故障机理分析原型系统的软件设计进行全面描述，为开发人员、测试人员及维护人员提供统一的技术依据。文档覆盖系统总体架构、模块设计、数据设计、界面设计、关键算法、非功能需求及测试策略等内容，确保系统演进过程中具备可追踪、可扩展的设计基线。

### 1.2 项目概述
接口故障机理分析原型系统是一套基于 PyQt5 的桌面应用，面向复杂系统的接口建模与故障分析。系统提供模块建模、接口建模、任务剖面管理、环境建模、故障树自动生成等能力，支持交互式图形化建模及JSON格式的项目持久化。【F:main.py†L11-L38】【F:src/core/project_manager.py†L28-L58】【F:src/core/fault_tree_generator.py†L31-L65】

### 1.3 读者对象
- 项目管理者：了解系统总体设计与模块边界。
- 开发人员：参考详细设计实现功能或进行二次开发。
- 测试人员：依据模块说明与接口契约制定测试用例。
- 运维与实施人员：理解部署需求与运行环境。

### 1.4 范围与约束
- 范围：桌面端原型，主要关注建模与分析逻辑，不包含大型分布式部署。
- 约束：依赖 PyQt5 框架，当前版本定位于单机应用；仿真与分析算法为原型实现，可根据需求进一步增强。

### 1.5 参考资料
- 《GB/T 8567-2006 计算机软件产品开发文件编制指南》
- 《IEEE Std 1016-2017 系统与软件设计描述》
- 项目源代码存储库

## 2. 术语与定义
- **模块（Module）**：系统组成单元，分为硬件、软件、算法等类型，用于建模系统部件。【F:src/models/module_model.py†L18-L78】
- **接口（Interface）**：模块间数据或控制交互通道，包含类型、方向、参数及失效模式定义。【F:src/models/interface_model.py†L23-L200】
- **任务剖面（Task Profile）**：描述任务目标、成功判据及运行条件的实体，是故障树生成的重要输入。【F:src/models/system_model.py†L41-L104】
- **环境模型（Environment Model）**：定义外部环境应力及其对模块的影响，用于仿真环境因素。【F:src/models/environment_model.py†L13-L200】
- **故障树（Fault Tree）**：任务或系统失效的层次化逻辑模型，由事件和逻辑门组成。【F:src/core/fault_tree_generator.py†L31-L194】

## 3. 系统总体描述

### 3.1 系统定位
系统面向复杂系统工程领域，提供接口级故障机理分析能力，通过图形化建模与自动生成故障树，辅助工程师进行风险识别与验证。

### 3.2 目标用户
- 系统工程师：建模系统结构、接口与任务。
- 安全工程师：构建故障树分析潜在失效。
- 研究人员：验证算法原型与环境影响。

### 3.3 假设与依赖
- 运行环境具备 Python 3.12 及 PyQt5 库。
- 用户具备基本的系统工程知识，能够理解模块、接口与故障树概念。
- 项目文件以 JSON 形式存储，可通过内置项目管理器进行读写。【F:src/core/project_manager.py†L35-L83】

### 3.4 系统环境
系统作为单机桌面应用运行，主要组件包括：
- GUI 层（PyQt5）：负责用户交互与可视化。【F:src/ui/main_window.py†L10-L120】
- 业务逻辑层：项目管理、故障树生成、仿真等核心逻辑。【F:src/core/project_manager.py†L15-L99】【F:src/core/fault_tree_generator.py†L16-L194】
- 数据模型层：模块、接口、任务、环境等数据结构及序列化逻辑。【F:src/models/system_model.py†L297-L420】

## 4. 总体架构设计

### 4.1 架构风格
系统采用分层架构：
1. **表示层**：由 `MainWindow` 及其面板构成，负责组织界面、触发业务操作。【F:src/ui/main_window.py†L31-L120】
2. **业务层**：包含 `ProjectManager`、`FaultTreeGenerator` 等服务类，协调数据模型与业务规则。【F:src/core/project_manager.py†L15-L99】【F:src/core/fault_tree_generator.py†L16-L194】
3. **数据层**：以模型类实现实体属性、行为、序列化与仿真逻辑。【F:src/models/system_model.py†L297-L420】【F:src/models/module_model.py†L43-L200】

### 4.2 模块分解
- **主程序**：启动 Qt 应用、装配主窗口。【F:main.py†L22-L38】
- **项目管理模块**：负责项目创建、保存、加载及状态维护。【F:src/core/project_manager.py†L15-L99】
- **故障树分析模块**：根据系统模型和任务剖面生成故障树结构及概率信息。【F:src/core/fault_tree_generator.py†L31-L194】
- **系统模型模块**：维护系统结构、模块、接口、连接、环境及任务数据，并提供仿真入口。【F:src/models/system_model.py†L297-L420】
- **模块建模模块**：定义模块属性、接口集合、参数与状态变量的管理逻辑。【F:src/models/module_model.py†L43-L200】
- **接口建模模块**：描述接口类型、失效模式、触发条件及状态历史。【F:src/models/interface_model.py†L23-L200】
- **环境建模模块**：定义环境类型、应力因子及对系统状态的影响方式。【F:src/models/environment_model.py†L13-L200】
- **用户界面模块**：提供主窗口、系统画布及各功能面板，用于交互建模与数据显示。【F:src/ui/main_window.py†L31-L120】【F:src/ui/system_canvas.py†L1-L200】

### 4.3 数据流与控制流
1. 用户通过主窗口选择建模模块，在系统画布上构建模块与接口。
2. `ProjectManager` 维护系统模型实例，并在用户操作后标记变更。【F:src/core/project_manager.py†L18-L33】
3. 用户触发仿真或故障树分析时，业务层读取当前系统、任务和环境数据，执行计算并返回结果。【F:src/models/system_model.py†L337-L372】【F:src/core/fault_tree_generator.py†L31-L194】
4. 结果通过界面组件呈现，并可序列化为 JSON 项目文件。【F:src/core/project_manager.py†L35-L83】

### 4.4 部署视图
- 单机部署：在 Windows/Linux 桌面运行 Python 解释器，安装依赖后启动主程序。
- 数据存储：项目文件保存在本地文件系统中，无额外数据库依赖。

## 5. 数据设计

### 5.1 数据模型概述
系统使用对象模型封装关键数据实体，并提供 `to_dict`/`from_dict` 方法实现 JSON 序列化：
- `SystemStructure`：集中管理模块、接口、连接、环境及任务集合，并记录画布视图信息。【F:src/models/system_model.py†L297-L420】
- `Module`：继承自 `BaseModel`，包含接口集合、参数、状态变量与自定义执行代码，可生成仿真输出。【F:src/models/module_model.py†L43-L168】
- `Interface` 及关联类：定义接口元数据、失效模式、触发条件与运行状态。【F:src/models/interface_model.py†L23-L200】
- `EnvironmentModule` 与 `StressFactor`：描述环境类型与随时间变化的应力值，支持多种分布与时间剖面。【F:src/models/environment_model.py†L13-L200】
- `TaskProfile` 与 `SuccessCriteria`：提供任务成功判据、初始条件和分析结果存储。【F:src/models/system_model.py†L41-L104】

### 5.2 持久化设计
`ProjectManager` 在保存项目时，将 `SystemStructure` 序列化为 JSON 文件，目录不存在时自动创建；加载时解析 JSON 并重建对象实例，实现项目持久化。【F:src/core/project_manager.py†L35-L80】

### 5.3 数据一致性策略
- 模块、接口、连接均以唯一 ID 作为键，`SystemStructure` 在添加/删除时同步维护关联集合，确保引用一致性。【F:src/models/system_model.py†L309-L362】
- 删除模块时自动移除相关连接，避免悬挂引用。【F:src/models/system_model.py†L314-L330】
- 加载项目时根据 `module_type` 选择具体模块类，保证模块行为正确恢复。【F:src/models/system_model.py†L361-L396】

## 6. 接口设计

### 6.1 用户界面
- **主窗口**：包含菜单栏、工具栏、状态栏及多个标签页面板，提供项目操作、建模与分析入口。【F:src/ui/main_window.py†L31-L120】
- **系统画布**：支持模块拖拽、接口可视化、连线操作及模块配置对话框，模拟图形化建模体验。【F:src/ui/system_canvas.py†L1-L200】
- **功能面板**：模块、接口、任务剖面、环境和故障树面板通过 `set_project_manager` 与业务层交互，保证数据一致。

### 6.2 外部接口
- 文件接口：通过 JSON 项目文件与外部系统交换数据，遵循 `SystemStructure` 序列化格式。【F:src/core/project_manager.py†L51-L77】【F:src/models/system_model.py†L369-L420】
- Python 扩展接口：模块、环境和接口均支持嵌入自定义 Python 代码，用于原型快速扩展算法或应力计算。【F:src/models/module_model.py†L71-L114】【F:src/models/environment_model.py†L136-L199】【F:src/models/interface_model.py†L61-L120】

### 6.3 内部接口
- 业务层与模型层通过对象引用进行交互，`ProjectManager` 公开 `set_current_system`、`get_current_system` 等接口供界面层调用。【F:src/core/project_manager.py†L23-L99】
- 故障树生成器接收 `SystemStructure` 与 `TaskProfile` 实例，输出 `FaultTree` 对象供 UI 展示或进一步分析。【F:src/core/fault_tree_generator.py†L31-L194】

## 7. 详细设计

### 7.1 主程序流程
1. `main()` 函数初始化 `QApplication`，设置应用名称、版本及高 DPI 属性。【F:main.py†L22-L33】
2. 创建并展示 `MainWindow` 实例，进入事件循环。【F:main.py†L33-L38】

### 7.2 ProjectManager 类
- 维护当前系统实例、文件路径与修改标记。
- 提供创建新项目、保存、另存与加载等方法；保存和加载均处理 JSON 文件并更新状态。【F:src/core/project_manager.py†L15-L83】
- 提供状态查询接口 `has_unsaved_changes`、`get_current_system` 等，供 UI 判断保存提示。【F:src/core/project_manager.py†L85-L99】

### 7.3 SystemStructure 类
- 管理模块、接口、连接、环境模型与任务剖面的增删查，并维护画布视图参数。【F:src/models/system_model.py†L297-L356】
- 支持系统仿真：遍历模块执行自定义代码，应用环境应力后返回系统状态，用于任务评估与故障树分析输入。【F:src/models/system_model.py†L337-L372】
- 实现 `to_dict`/`from_dict` 序列化，自动恢复具体模块、接口、连接及环境对象。【F:src/models/system_model.py†L372-L420】

### 7.4 Module 类
- 扩展自 `BaseModel`，定义模块类型、几何信息、接口集合、参数、状态变量和 Python 代码执行能力。【F:src/models/module_model.py†L43-L131】
- 支持接口兼容层：`add_connection_point` 将旧版连接点转换为新接口对象，便于迁移。【F:src/models/module_model.py†L81-L128】
- `execute_python_code` 方法在受控环境中运行模块脚本，返回输出结果。【F:src/models/module_model.py†L105-L129】

### 7.5 Interface 模型
- 枚举接口类型、硬件子类型及失效模式，支持触发条件评估与失效模式管理。【F:src/models/interface_model.py†L23-L200】
- `TriggerCondition.evaluate` 基于阈值、事件、时间或概率逻辑判断是否触发，支持自定义代码扩展，便于构建复杂失效场景。【F:src/models/interface_model.py†L61-L163】

### 7.6 Environment 模型
- `EnvironmentModule` 组合多个 `StressFactor`，支持多种分布与时间剖面生成应力值，并对受影响模块状态进行修改。【F:src/models/environment_model.py†L45-L200】
- 支持执行自定义 Python 代码以模拟复杂环境作用。

### 7.7 FaultTreeGenerator 类
- 根据任务成功判据或系统结构递归分解故障原因，生成事件与逻辑门树结构。【F:src/core/fault_tree_generator.py†L75-L194】
- 支持配置接口失效、模块失效与环境影响的包含策略，并设置顶事件信息与任务执行时间。【F:src/core/fault_tree_generator.py†L23-L73】【F:src/core/fault_tree_generator.py†L148-L173】

### 7.8 图形化建模组件
- `SystemCanvas` 提供模块图形项、接口图形项及配置对话框，支持拖拽移动、连线与交互提示，提升建模效率。【F:src/ui/system_canvas.py†L1-L200】
- 模块图形项根据模块类型设置不同颜色和交互行为。【F:src/ui/system_canvas.py†L166-L199】

## 8. 关键业务流程

### 8.1 项目生命周期
1. 用户在主窗口选择“新建项目”，`ProjectManager` 创建新的 `SystemStructure` 并设置为当前项目。【F:src/core/project_manager.py†L28-L33】
2. 用户通过各面板编辑模块、接口、任务与环境，`ProjectManager` 根据操作标记项目已修改。【F:src/core/project_manager.py†L23-L33】
3. 保存时调用 `save_project_as` 或 `save_project` 将模型写入 JSON 文件。【F:src/core/project_manager.py†L35-L58】
4. 打开项目时调用 `load_project` 解析 JSON 并恢复系统状态。【F:src/core/project_manager.py†L64-L80】

### 8.2 故障树生成
1. 用户选择任务剖面并触发故障树分析。
2. `FaultTreeGenerator` 初始化配置、创建顶事件并根据成功判据或系统结构生成分层事件。【F:src/core/fault_tree_generator.py†L31-L140】
3. 模块失效事件可组合内部失效、接口失效和环境影响，形成 OR 门结构。【F:src/core/fault_tree_generator.py†L148-L194】
4. 生成的故障树返回界面层展示或用于进一步分析。

### 8.3 系统仿真流程
1. `SystemStructure.simulate_system` 遍历模块执行脚本，收集输出状态。【F:src/models/system_model.py†L337-L352】
2. 环境模型应用应力，修改受影响模块状态，形成最终系统状态。【F:src/models/system_model.py†L352-L368】
3. 任务剖面可基于系统状态评估成功率，用于故障树概率计算与任务判定。【F:src/models/system_model.py†L65-L104】

## 9. 非功能设计

### 9.1 性能
- 由于为桌面原型，系统主要处理单机数据，性能瓶颈集中在故障树生成与仿真脚本执行。可通过限制故障树最大深度与使用轻量脚本确保响应速度。【F:src/core/fault_tree_generator.py†L23-L194】

### 9.2 可用性
- GUI 提供标签页组织功能区，并通过图形化画布和对话框降低学习成本。【F:src/ui/main_window.py†L31-L120】【F:src/ui/system_canvas.py†L27-L200】

### 9.3 可扩展性
- 模块、接口、环境均支持自定义 Python 代码扩展行为；故障树生成器通过配置项控制分析范围，便于后续扩展算法。【F:src/models/module_model.py†L105-L129】【F:src/models/environment_model.py†L191-L199】【F:src/core/fault_tree_generator.py†L23-L194】

### 9.4 可维护性
- 所有数据模型均实现序列化方法，便于调试与持久化；项目管理器集中处理文件操作，降低界面层复杂度。【F:src/models/system_model.py†L372-L420】【F:src/core/project_manager.py†L35-L83】

### 9.5 安全性
- 作为离线原型，主要安全风险在于执行用户提供的 Python 脚本。建议在实际部署时增加沙箱或脚本校验机制。

## 10. 测试设计

### 10.1 单元测试建议
- 为 `ProjectManager` 编写保存/加载测试，验证 JSON 序列化正确性。
- 为 `SystemStructure` 的增删操作编写测试，确保关联关系维护正确。
- 为 `FaultTreeGenerator` 构造简单系统模型，验证生成故障树结构与配置项生效。

### 10.2 集成测试建议
- GUI 集成测试：模拟用户在画布上创建模块、接口并保存项目。
- 故障树分析流程：加载包含任务剖面的项目，触发分析，校验生成结果。

### 10.3 验收测试场景
- 用户能够完成从新建项目、建模、仿真到故障树分析的全流程操作，并成功保存/加载项目。

## 11. 配置与部署

### 11.1 软件环境
- Python 3.12 及以上版本。
- 必需依赖：PyQt5、项目自带模块。

### 11.2 部署步骤
1. 安装 Python 及依赖库。
2. 克隆或下载项目代码。
3. 在项目根目录执行 `python main.py` 启动应用。

### 11.3 配置管理
- 项目配置主要通过 GUI 设置并保存至 JSON 文件；可结合版本管理系统追踪项目文件变更。

## 12. 附录

### 12.1 未来扩展建议
- 引入脚本执行沙箱，提升安全性。
- 增强故障树概率计算，支持蒙特卡洛仿真。
- 提供多语言界面与部署打包工具。

### 12.2 修订记录
- V1.0：首次编制软件设计说明。

