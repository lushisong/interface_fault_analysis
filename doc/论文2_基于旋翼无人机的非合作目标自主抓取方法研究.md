# 工学硕士学位论文

# 基于旋翼无人机的非合作目标自主抓取方法研究

二〇二二年六月

# Research on Autonomous Grasping Method for Non-Cooperative Target Based on Multi-rotor UAV





# 目录

# 第一章绪论

第一章 绪论1.1 研究背景与意义1.2 国内外研究现状1.2.1 自主抓取无人机构型研究现状1.2.2 旋翼无人机- 机械臂建模与控制研究现状1.2.3 目标检测跟踪与视觉伺服控制研究现状1.3 论文研究内容与组织结构第二章 旋翼无人机自主抓取系统总体设计2.1 任务需求分析与系统组成2.1.1 自主抓取任务需求分析2.1.2 系统组成与工作流程2.2 旋翼无人机平台与机载设备选型2.2.1 六旋翼无人机平台2.2.2 机载云台相机2.2.3 机载计算设备2.3 机械臂及末端执行机构设计2.3.1 多自由度机械臂构型2.3.2 末端执行器2.3.3 末端随动相机2.4 系统复合模型构建与装配集成2.5 本章小结第三章 旋翼无人机- 机械臂系统动力学建模3.1 坐标系定义及转换关系3.1.1 基本坐标系定义3.1.2 坐标转换关系与欧拉角定义3.2 多旋翼无人机建模3.2.1 机体系下动力学模型3.2.2 世界系下动力学模型3.3 4R 型机械臂运动学建模3.3.1 机械臂改进D- H 法参数定义3.3.2 机械臂运动学模型3.4 系统拉格朗日动力学建模3.4.1 动能推导3.4.2 势能推导

3.4.3 动力学模型 36

3.5 本章小结 37

第四章 系统自适应控制与运动规划方法研究 38

4.1 基于 UDE- GS 的六旋翼无人机控制方案 38

4.1.1 六旋翼无人机基本控制原理 38  4.1.2 姿态环 UDE 控制律设计 42  4.1.3 考虑惯性项偏移的 UDE- GS 控制方案 46

4.2 机械臂逆运动学求解与轨迹规划方法 47

4.2.1 机械臂可操作性分析 47

4.2.2 基于 BFGS 拟牛顿法的机械臂逆运动学求解 48

4.2.3 基于关节空间的机械臂多项式轨迹规划 49

4.3 滚动时域执行策略与结果分析 50

4.3.1 机械臂滚动时域执行策略 50

4.3.2 步进电机与舵机的传递函数 51

4.3.3 机械臂执行结果分析 52

4.4 本章小结 54

第五章 系统组合视觉伺服控制方法研究 55

5.1 视觉系统的标定与测试 55

5.1.1 相机模型与内参标定 55

5.1.2 视觉系统手眼标定 58

5.2 目标检测与位姿估计方法 59

5.2.1 基于 YOLOv5s 的图像目标检测 59

5.2.2 基于 EPrP 的位姿估计方法 60

5.3 组合视觉伺服控制方法 63

5.3.1 组合视觉伺服控制逻辑 63

5.3.2 基于图像的视觉伺服控制原理 65

5.3.3 视觉伺服控制仿真验证 65

5.4 本章小结 67

第六章 系统联合仿真分析与实物试验验证 68

6.1 Simulink 仿真系统集成设计 68

6.1.1 Simulink 系统仿真框架 68

6.1.2 Simulink 与 ROS 通讯 72

6.2 仿真试验结果对比分析 73

6.2.1 联合仿真参数设置 73

6.2.2 运动学结果分析 73

6.2.3 动力学结果分析 77

6.3 户外实物抓取试验局部验证 82

6.4 本章小结 85

结束语 .86主要研究成果与结论 .86未来研究工作与展望 .87参考文献 .88附录 系统动力学相关参数补充 .96

# 表目录

表1.1 旋翼无人机- 机械臂自主操作方法研究团队及相关成果 2  表1.2 旋翼无人机- 机械臂相关建模与控制方法对比 9  表2.1 M600 Pro六旋翼无人机主要参数 17  表2.2 禅思X3机载云台相机主要参数 19  表2.3 机械臂数字舵机参数 20  表2.4 末端执行器步进电机参数 21  表2.5 RC Split 4 末端随动相机主要参数 22  表3.1 4R型机械臂连杆改进D- H参数表 31  表4.1 串级PID与UDE控制律姿态环参数设置 47  表4.2 串级PID与UDE控制律位置环参数设置 47  表5.1 末端随动相机参数标定结果 57  表5.2 目标立方体在世界系下的预设位姿 66  表6.1 联合仿真基本参数设置 73

# 图目录

图4.11 机械臂关节角轨迹规划子系统 ..... 50图4.12 预估执行时长变化曲线 ..... 51图4.13 机械臂规划关节角与关节角速率对比 ..... 52图4.14 末端执行器齐次变换及速度状态量计算模块 ..... 53图4.15 末端执行器速度与角速度变化曲线 ..... 53图5.1 相机中央投影与相关坐标示意图 ..... 55图5.2 MATLAB 相机内参标定检测示意图 ..... 57图5.3 相机畸变映射图[91] ..... 58图5.4 相机系下标定板的相对位姿 ..... 58图5.5 标定各图像平均投影误差 ..... 58图5.6 YOLOv5s 网络结构图[100] ..... 59图5.7 不同背景下的目标检测结果 ..... 60图5.8 预设立方体目标在机载相机像平面下的投影 ..... 62图5.9 目标相对基坐标系的位置实时估计曲线（单位：m） ..... 62图5.10 目标相对基坐标系的姿态实时估计曲线（单位：rad） ..... 62图5.11 各面标记角点在 OpenCV ArUco 库中的表示[103] ..... 63图5.12 系统组合视觉伺服控制方法结构框图 ..... 64图5.13 目标特征点在机载相机像平面的运动轨迹 ..... 66图5.14 目标特征点在末端相机像平面的运动轨迹 ..... 66图5.15 基坐标系下机械臂执行初始与终止位形示意图 ..... 67图6.1 旋翼无人机- 机械臂自主抓取系统 Simulink 仿真总体框架 ..... 68图6.2 六旋翼无人机 Simscape 子系统 ..... 69图6.3 气动阻尼项近似计算模块 ..... 69图6.4 陀螺力矩近似计算模块 ..... 70图6.5 六旋翼无刷电机与螺旋桨 Simscape 子系统 ..... 70图6.6 4R 型机械臂 Simscape 子系统 ..... 71图6.7 末端执行器 Simscape 子系统 ..... 71图6.8 末端执行器指令触发与执行系统 ..... 71图6.9 Simscape Mechanics Explorer 可视化仿真演示界面 ..... 72图6.10 无人机位姿参数响应曲线（无扰动） ..... 74图6.11 无人机速度与欧拉角变化率曲线 ..... 75图6.12 机械臂关节角响应曲线（单位：°） ..... 75图6.13 机械臂关节角速度响应曲线（单位：°/s） ..... 75图6.14 末端执行器与目标距离变化曲线对比 ..... 76

图6.15 自主抓取各阶段无人机、机械臂构型变化 ..... 76图  $6.16t = 10 \mathrm{~s}$  完成自主抓取时系统各向视图 ..... 77图6.17 世界系下的无人机与末端执行器轨迹 ..... 77图6.18 无人机各电机转速变化曲线 ..... 78图6.19 旋翼电机推力与力矩变化曲线 ..... 78图6.20 无人机在机体系下所受气动阻力与阻尼力矩 ..... 79图6.21 旋翼电机对机体系陀螺力矩变化曲线 ..... 79图6.22 机械臂运动过程对无人机产生的扰动力及扰动力矩 ..... 80图6.23 运动过程系统质心变化曲线 ..... 80图6.24 运动过程机体系及质心平行机体系转动惯量变化曲线 ..... 81图6.25 机体系到惯量主轴坐标系欧拉角变化 (单位：rad) ..... 81图6.26 基于 M600 Pro 无人机平台的实物试验系统组成 ..... 82图6.27 无人机户外自主抓取试验流程图 ..... 83图6.28 无人机自主抓取流程实物展示 ..... 84图6.29 户外机械臂抓取实物试验 ..... 84

# 摘要

本文以基于视觉伺服的旋翼无人机对非合作目标的自主抓取问题为研究对象，设计了装配4R型舵机机械臂的六旋翼无人机自主操作组合系统构型，围绕系统动力学建模、无人机与机械臂的自适应控制与轨迹规划、系统视觉伺服控制等技术问题开展了如下研究：

建立了旋翼无人机- 机械臂复合系统的动力学模型。针对所选用的六旋翼无人机与机械臂构型，分别参照开源飞控标准及改进D- H法则设定相应坐标系；在运动学分析的基础上，建立了无人机简化动力学模型，并依据拉格朗日方程推导建立了复合系统的完整动力学模型；简要分析了动力学模型的惯性、科氏、重力等分项及广义力的特性。

设计了基于UDE- GS方法的系统自适应控制方法。在分析旋翼无人机通用的底层串级PID控制逻辑的基础上，将不确定性与扰动估计器（Uncertainty and Disturbance Estimator, UDE）及调度增益（Gain Scheduling, GS）引入控制系统，根据机械臂实时构型的惯性参数变化设计前馈补偿项；基于拟牛顿迭代法进行机械臂逆运动学求解，利用“滚动时域”的三次多项式方法规划关节空间下的机械臂轨迹；通过系统基本构型及机械臂的极端位形下的控制对比仿真验证所设计方法的可行性与鲁棒性。

提出了结合图像目标检测与EPnP位姿估计方法的系统视觉伺服控制方案。以地面危爆品为对象，对基于YOLO的目标检测结果通过角点检测提取特征点，进一步利用EPnP方法根据检测所得的目标特征点进行位姿估计；采用“眼在手外”的机载云台相机与“眼在手上”的末端随动相机结合的混合视觉伺服系统，分别在靠近与抓取阶段采用基于位置的视觉伺服（Position- based Visual Servo, PBVS）与基于图像的视觉伺服（Image- based Visual Servo, IBVS）的控制方法，实现对目标的精准抓取。

完成了基于Simulink- ROS的联合仿真分析与分系统实物试验验证。通过Simscape多体动力学模块搭建集成系统的仿真模型，并将本文所设计的无人机- 机械臂自适应控制与视觉伺服控制方案通过Simulink与ROS端的目标检测信息进行联合仿真，分别设定固定立体靶标与移动目标并增加高斯扰动，验证了不同工况下全系统视觉伺服控制方案的可行性；上述目标检测与机械臂视觉伺服控制方案在M600 Pro无人机平台上进行了分系统的局部实物试验验证。

关键词：旋翼无人机；动力学分析；空中自主操作；非合作目标；视觉伺服控制

# Abstract

This paper focuses on the autonomous aerial manipulation problem of the multi- rotor UAV based on visual servo control. A configuration of hexa- rotor UAV system equipped with a 4R robotic manipulator is designed. Research on the system dynamics modeling, adaptive control and trajectory planning method of the UAV and manipulator, visual servo control of the system and other technical issues are carried out as follows:

The dynamics model of UAV- manipulator complex system is established. According to the UAV and manipulator configurations selected, corresponding coordinate systems are set based on open- source flight control standard and modified Denavit- Hartenberg (D- H) parameters respectively. Based on kinematics analysis, the dynamics model of the composite system is established according to Lagrange equation. The subitems' characteristics of Inertia, Coriolis and Gravity of the dynamic model are analyzed. In order to facilitate the control system design, a simplified system dynamics model is deduced.

An adaptive control method based on inertial compensation UDE- GS method is designed. Based on the analysis of the general underlying cascade PID control logic of hexa- rotor UAV, uncertainty and disturbance estimator (UDE) as well as gain scheduling (GS) logic are introduced into the control system, and the feedforward compensation was designed according to the variation of inertial parameters of the real- time configuration of the manipulator. The inverse kinematics of the manipulator was solved based on the quasi- Newton iteration method, and the trajectory of the manipulator in joint space was planned using the cubic polynomial method of "receding horizon". The feasibility and robustness of the proposed method are verified by comparison simulation of the basic configuration of the system and the extreme configuration of the manipulator.

A visual servo control scheme combining object detection and EPnP pose estimation method is proposed. An object detection and recognition model based on YOLOv5s is trained for ground micro- explosive target. EPnP method is further used to estimate the pose of the detected object feature points. A combined visual servo system contained an airborne fixed camera (Eye- to- Hand) and an end follow- up camera (Eye- in- Hand) is adopted. The position- based visual servo (PBVS) and image- based visual servo (IBVS) control methods are used in the approaching and grasping phases respectively to realize the accurate grasping of the target.

The co- simulation scheme based on Simulink- ROS platforms is carried out. The simulation model of the integrated system was built based on Simscape multibody dynamics module. The UAV- manipulator visual servo control scheme designed in this

paper is combined with Simulink and ROS for closed- loop simulation. Fixed stereo- target and moving target were respectively set and appropriate disturbance is added. The feasibility of the whole system visual servo control scheme under different working conditions is verified. The above object detection and visual servo control scheme were also verified by partial physical experiment on M600 Pro UAV platform.

Key Words: Multi- rotor UAV, Dynamics Analysis, Autonomous Aerial Manipulation, Non- cooperative Target, Visual Servo Control

# 第一章 绪论

第一章 绪论随着飞行控制技术的进步及微机电系统的发展，旋翼无人机以其较强的自主飞行能力与环境适应能力正在军事和民用领域得到日益广泛的应用。旋翼无人机可提供稳定的空中三维空间悬停或机动平台，而机械臂等操纵机构可以执行灵活的自主抓取任务。基于旋翼无人机的自主抓取平台使传统的旋翼飞行器可以从空中执行抓取任务，深度拓展了其在民用和军事领域的应用范围。

# 1.1 研究背景与意义

当前常见无人机主要分为固定翼无人机、旋翼直升机与多旋翼无人机。其中多旋翼无人机一般具有对称结构，通过控制螺旋桨转速实现姿态的快速调节，具有操控简单，低成本与高可靠性等优点。目前，旋翼无人机主要用于对环境和目标的远距离非接触式操作。近年来，无人机与环境的接触式操作正成为新兴的研究方向。通过在无人机飞行平台上安装带有末端执行器的机械臂等机构，增强了无人机系统和环境的交互能力。这种新型空中机器人结合了旋翼无人机高机动飞行和机械臂灵活作业的特性，在货物抓取、样品采集、扫雷排爆等领域具有广泛的应用前景。本文重点研究配备多自由度机械臂的六旋翼无人机自主抓取动力学与视觉伺服控制方法。

当前针对基于旋翼无人机的抓取系统研究在系统动力学建模、目标检测跟踪以及控制律设计等方面面临较多问题，主要表现如下：

(1) 动力学建模：旋翼无人机可视为6自由度运动刚体，以螺旋桨高速旋转产生的空气动力为动力来源。一般的四旋翼等无人机构型为典型的欠驱动系统，对外界扰动较为敏感。其与多连杆机械臂的组合在增加系统自由度的同时也增加了系统状态变量的耦合性，使得系统模型进一步复杂化。二者之间的相互耦合作用使得无人机-机械臂组合体在动力学层面表现为复杂的高维度、非线性、强耦合的系统。

(2) 目标检测跟踪：由于旋翼无人机的载荷能力与功耗所限，对目标的识别跟踪常采用低成本光学传感器和嵌入式计算设备进行机载实现。一般基于卷积神经网络的机器视觉算法需要调用高性能GPU，不便于在无人机平台实现。对于非合作目标，控制系统与目标物体不通信，无法预知其状态特征，仅能通过传感器对目标的几何与物理特征进行外部测量。在传感器稳定跟踪目标后估计无人机与目标的相对位姿（位置、姿态）进而将位姿信息转化为机械臂的作动信号等方面均面临诸多研究难题。

(3)组合系统控制律设计：由飞控系统控制误差及环境扰动造成的无人机位姿漂移会影响机械臂末端作业性能；而机械臂的动态操作及系统的质心偏移等因素也会显著影响旋翼无人机的飞行稳定性。为使末端执行器以特定姿态到达空间内预定工作点并抑制扰动的影响，无人机-机械臂系统通常采用高冗余设计，使系统的运动规划问题复杂化。旋翼无人机和机械臂间的这种相互耦合作用对作业过程中的无人机飞行控制与机械臂末端控制均提出了较高要求。

本文瞄准多旋翼无人机接触式操作的研究前沿，开展了基于旋翼无人机- 机械臂组合系统的非合作目标自主抓取技术研究。研究成果除了可直接应用于单无人机平台的自主抓取规划和控制中，还可进一步拓展至多无人机协同操作、空间机械臂等研究领域，对于未来无人自主系统的轨迹规划和跟踪控制技术的发展有积极的参考意义。

# 1.2 国内外研究现状

# 1.2.1自主抓取无人机构型研究现状

基于旋翼无人机的操纵平台通常由两类子系统组成：浮动基座型旋翼飞行器和驱动器型机械臂[2]。国内外众多科研团队对无人机- 机械臂组合系统（即飞行机械臂）在抓取、转运等复杂操作任务的应用进行了广泛而积极的研究探索[3]。表1.1总结了近年来具有代表性的研究团队及其采用的组合系统构型与基本参数。

表1.1旋翼无人机-机械臂自主操作方法研究团队及相关成果  

<table><tr><td>研究团队</td><td>飞行平台</td><td>操纵机构</td><td>建模策略</td><td>规划控制方法</td><td>操作任务</td></tr><tr><td>宾夕法尼亚大学 GRASP 实验室[4,5]</td><td>四旋翼无人机 (AscTech)</td><td>夹持器</td><td>一体式</td><td>PID, IBVS</td><td>悬挂栖息，动态抓取</td></tr><tr><td>苏黎世联邦理工学院 (ETH) [6]</td><td>四旋翼无人机</td><td>磁性夹取器</td><td>分离式</td><td>PID</td><td>抓取转运</td></tr><tr><td>斯坦福大学[7]</td><td>四旋翼无人机 (FlyCroTugs)</td><td>缆绳，夹持器</td><td>分离式</td><td>PID</td><td>拉升载荷，协同开门</td></tr><tr><td>中科院沈阳自动化研究所[8]</td><td>六旋翼无人机 (大疆 E800)</td><td>7 自由度机械臂，仿 Yale OpenHand</td><td>分离式</td><td>PID, H-控制器</td><td>抓取目标</td></tr><tr><td>中山大学[9]</td><td>四旋翼无人机 (大疆 M100)</td><td>3 自由度机械臂，机械抓手</td><td>分离式</td><td>PD, PID</td><td>自主识别抓取</td></tr><tr><td>南开大学智能机器人技术重点实验室[10]</td><td>四旋翼无人机</td><td>2 自由度机械臂，鳍条仿生抓手</td><td>一体式</td><td>滑模控制器，PID</td><td>V-REP/Coppeliasim + MATLAB 仿真</td></tr><tr><td>上海交通大学[11]</td><td>四旋翼无人机 (Tarot660)</td><td>2 自由度机械臂</td><td>分离式</td><td>PID, MPC 跟踪鲁棒控制器</td><td>轨迹跟踪仿真</td></tr><tr><td>哈尔滨工业大学[12]</td><td>六旋翼无人机 (Firefly 仿真)</td><td>单自由度机械臂，机械抓手</td><td>一体式</td><td>最小化 Snap, iLQR</td><td>ROS-Gazebo 仿真</td></tr><tr><td>雷恩大学，图卢兹大学[13]</td><td>四旋翼无人机 (MonkeyRotor)</td><td>单自由度机械臂</td><td>一体式</td><td>内外环多级控制</td><td>\</td></tr></table>

国防科技大学研究生院硕士学位论文  

<table><tr><td>首尔大学[14, 15]</td><td>多旋翼无人机 (Firefly)</td><td>2 自由度机械臂，机械抓手</td><td>一体式</td><td>RRT*, DMPs</td><td>载荷参数估计，协同搬运物体</td></tr><tr><td>南京航空航天大学[16]</td><td>六旋翼无人机</td><td>2 自由度机械臂</td><td>一体式</td><td>PD，LADRC</td><td>抓取目标</td></tr><tr><td>哈尔滨工业大学[17]</td><td>六旋翼无人机</td><td>6-R(RR)S 构型并联机械臂</td><td>一体式</td><td>LQR，RBF-ASMC</td><td>轨迹跟踪仿真</td></tr></table>

# 1.2.1.1旋翼无人机飞行平台

旋翼无人机可以在复杂的三维空间中实现自由悬停飞行，易于与外部环境交互。现有的大部分相关研究主要基于无人直升机与多旋翼无人机两种飞行平台。

# (1)基于旋翼直升机的自主抓取系统

旋翼直升机起飞重量大，可携带多自由度工业机械臂；续航时间长，可以完成长耗时任务，是早期空中操作抓取的研究热点。如：德国航空航天中心(DLR)[18]设计了一种由交叉双桨直升机和7自由度机械臂组成的旋翼飞行机械臂系统。该系统集成了视觉系统，能够拔出固定在地面上的长杆，在室外环境中通过视觉引导对目标物进行自主抓取作业。中科院沈阳自动化研究所[19]则针对UAVGP竞赛任务设计了自主识别抓取油桶的无人直升机平台，在试验飞行中验证了控制方案与路径规划系统的高可靠性。然而，直升机通常具有复杂的机构和气动特性，这给控制器设计带来了较大困难。由于主转子产生的振荡效应，无人直升机稳定的自主操作较为困难。与直升机机身相连的串行操纵臂使系统对所有振动和共振效应极为敏感[20]。此外，由于机械臂有限的工作空间及大尺寸旋翼的空间干涉问题，操作任务一般只能在主旋翼下方进行[3]。而较大的机身尺寸与较高的危险性使直升机操作空间局限于户外，进一步限制了其在自主抓取方向的应用前景。

![](images/e9179868fcf96721e1f1c58514aa52b528afa44950ede1a85421a0d77d3627d0.jpg)  
图1.1基于无人直升机的自主抓取平台

# (2)基于多旋翼无人机的自主抓取系统

多旋翼无人机相较无人直升机具有机械结构简单、飞行控制相对稳定、操作便捷灵活等特点，是目前主流的空中操纵平台。但同时也具有有效载荷较小，飞行时间有限及较低的气动效率等明显缺陷。近年来具有代表性的相关研究见表1.1。当前，多数研究团队使用的无人机平台是基于常规多旋翼无人机构型(如四旋翼、

六旋翼等)。也有少数研究者将非常规构型的多旋翼飞行器应用于空中操作，如倾斜六旋翼(tilt- hexa- rotor)[21]，多旋翼立方模块（Cuboid Modular）组合[22]等。

![](images/515862411b601236aa222df8abf892b78497f4262edc465916ff6c6463ccb9ac.jpg)  
图1.2基于多旋翼无人机的抓取/运输平台代表构型

除旋翼直升机与多旋翼无人机外，近来也有其他类型的垂直起降飞行器（VTOL）用于空中抓取任务的研究尝试，如涵道风扇无人机[24]和四旋翼- 飞艇混合飞行器[25]等。若无特别说明，下文中的旋翼无人机均特指多旋翼无人机。

# 1.2.1.2操纵抓取执行机构

无人机抓取系统可以进行不同的空中操作，这主要取决于它们的操纵执行机构。在无人机平台上设计和安装的操纵执行机构，主要可包括机械臂与末端执行器(夹持器)两大类。

# (1)机械臂构型

机械臂在空中自主操作中应用广泛，通常安装在无人机机身下方并位于整个系统质心附近以便于抓取物体并减少对无人机的控制影响。多自由度有利于扩大操纵空间，提高操纵能力的通用性，增强任务适应性。当前关于基于旋翼无人机

平台的抓取大多需要基于多自由度机械臂实现。在无人机自主抓取平台中应用最普遍的是伺服舵机驱动的常规机械臂[8, 26, 27]；德国DLR则采用了LWR KUKA工业机械臂[18]；部分机械臂采用高冗余度(自由度大于6)结构[28, 29]或设有转动/移动关节[29, 30]；可适应特殊任务需要的双机械臂系统也正成为研究热点[31, 32]；此外一些新颖的异形机构正在应用于无人机自主抓取平台中，如苏黎世联邦理工学院等研究机构采用的平行或串行机械结构[23, 33]；首尔大学机器人团队设计了一种自锁折纸机械臂结构(图1.2- g)[34]，可以凭借极轻的自重完成对远距大质量物体的抓取。

# (2) 末端执行器构型

末端执行器针对瞬时或连续接触操作的要求常采用不同设计。多数方案将夹持器设在机械臂终端实现抓取目标，而部分方案则仅设计夹持器作为执行机构以避免机械臂运动对无人机控制的耦合影响(夹持器重量轻、重心变化小、被抓物体没有相对运动，对无人机动力学影响有限)。夹持器通常为特定目标专门设计，以适应不同的物体形状、材料等物理特性。耶鲁大学设计的Yale Openhand机械爪[35]对所抓取物体的形状有一定的自适应特性，这种特性降低了飞行机械臂对被抓取目标物形状的限制，使其具有更强的抓取任务作业能力。文献[9]根据任务要求设计一种三自由度抓取装置，如图1.3(c)所示。该装置可以上下移动，抓握方向调节和全向机构可以选择最合适的抓握方向，既保证了抓握性能，又降低了对飞行控制器的精度要求。文献[10]采用了如图1.3(d)所示的基于鳍条效应（Fin Ray® Effect）的仿生夹爪。这种仿生学设计可以使执行器自动贴合形状各异的目标物体，对于抓取的姿态与角度误差具有较强的包容性[36]。

![](images/fef57849887115bc407adcc059bc9bef135d485929471937361c9b1ea3d26916.jpg)  
图1.3 末端抓取夹持器实例

基于上述无人机- 机械臂组合系统可进行了多种空中操纵任务，主要分为自由

飞行操作和运动受限操作两大类[2, 3]。已有研究中的典型任务有智能抓取[9]，开关阀门[32]，动态捕获[5]，协同搬运[14]等。多数相关研究是基于准静态模型，而宾夕法尼亚大学的GRASP实验室从快速抓捕猎物的猛禽汲取灵感，提出了一种利用机载单目相机和IMU反馈的动态抓取方法，并通过试验验证了该方法的可行性[5]。

# 1.2.2 旋翼无人机-机械臂建模与控制研究现状

操纵机制的引入和对高操作能力的要求使系统建模和控制成为无人机自主抓取方法研究的热点。除了具有与无人机系统(非线性、强耦合、欠驱动等)相同的特性外，无人机- 机械臂组合体是多刚体系统，与外界环境相互作用，参数辨识与估计困难，使其比常规无人机动力学更加复杂[37]。

# 1.2.2.1 系统动力学建模与分析方法

现有文献中主要有两类方法来解决无人机- 机械臂组合系统的动力学分析问题，即分离式方法和一体式方法。第一种方法将无人机- 机械臂组合系统看作两个子系统，并将机械臂子系统的影响视为对无人机子系统的动力学扰动[11, 38]。第二种方法将无人机- 机械臂组合系统视为一个统一的系统，在分析和控制中使用无人机- 机械臂系统动力学的组合[12, 39]。前者一般用牛顿- 欧拉方法建模，而后者则通常采用欧拉- 拉格朗日方程[40]进行动力学分析。

# (1) 基于牛顿-欧拉方法的分离式动力学建模

分离式建模策略将无人机与机械臂分为两个不同的子系统，在无人机建模过程中将机械臂子系统的影响视为动力学扰动，同时无人机运动对机械臂运动学也有影响。因此，分离式的无人机动力学通常具有与常规无人机相似的形式。此外，机械臂运动所带来的耦合作用也表现在无人机组件的质心位置和转动惯量上。利用Denavit- Hartenberg (D- H)法则和牛顿- 欧拉方法，可以很容易地推导出单个机械臂的运动学和动力学建模。

基于分离式建模策略，无人机平台的动力学模型可以由递推牛顿- 欧拉方法推导得到[40]：

$$
\left[ \begin{array}{cc}M & \mathrm{O}_3\\ \mathrm{O}_3 & I \end{array} \right]\left[ \begin{array}{c}\ddot{p}_V\\ \omega_V \end{array} \right] + \left[ \begin{array}{cc}\mathrm{O}_3\\ \omega_V\times \left(I\omega_V\right) \end{array} \right] = \left[ \begin{array}{c}T_q - ge_3^T\\ \mathcal{Q}_q + D_q \end{array} \right] + \left[ \begin{array}{c}f\\ n \end{array} \right] \tag{1.1}
$$

其中，  $M$  和  $I$  分别为质量与惯量矩阵，  $T_{q}$  为由旋翼产生的推力(升力)项，  $Q_{q}$  是输入的转矩，  $D_{q}$  是旋翼诱导阻尼力矩，  $ge_{3}^{T}$  为重力项，  $f$  和  $n$  分别为机械臂作用于飞行器的力和力矩。

# (2) 基于拉格朗日方程的一体化动力学建模

随着机器人自由度的增加，动力学模型包含的各耦合项增多，形式复杂。旋

翼飞行机械臂的动力学模型可分为刚体动力学模型和空气动力学模型。其中，刚体动力学模型用于描述旋翼无人机集体和机械臂各连杆的运动与受力特性。旋翼无人机- 机械臂系统的各刚体在三维空间中的运动可用浮动基座的多连杆刚体的运动表示。关于浮动基座的多连杆刚体动力学建模的研究在空间机器人领域最早出现。空间机器人兴起于20世纪80年代，作为典型的浮动基座的多连杆刚体系统，其在动力学建模方面的研究较为成熟，对于此类复杂的多刚体系统的动力学建模多采用欧拉- 拉格朗方程[11]。该方法建立的动力学模型中，包含旋翼无人机的位置、姿态与机械臂关节角等状态量。旋翼无人机和机械臂状态量之间存在复杂的非线性耦合。因此，复合系统的刚体动力学模型表现为高维度的复杂非线性系统。文献[12, 42, 43]均采用拉格朗日方程对多自由度的飞行机械臂系统进行动力学建模；文献[44]基于对相互扰动力学作用的分析建立整体动力学模型，并在悬停飞行模式下将其简化为线性控制参考模型，进而对旋翼系统控制延时所引起的动力学扰动进行补偿。

通过欧拉- 拉格朗日方程，无人机与机械臂的组合系统动力学模型一般可表示为[3]：

$$
\begin{array}{rl}\left[ \begin{array}{ll}\pmb {H}_{\mathrm{b}} & \pmb{H}_{\mathrm{bm}}\\ \pmb{H}_{\mathrm{bm}}^{\mathrm{T}} & \pmb{H}_{\mathrm{m}} \end{array} \right]\left[ \begin{array}{l}\ddot{X}_{\mathrm{b}}\\ \ddot{q} \end{array} \right] + \left[ \begin{array}{l}\pmb{C}_{\mathrm{b}}\\ \pmb{C}_{\mathrm{m}} \end{array} \right] + \left[ \begin{array}{l}\pmb {G}_{\mathrm{b}}\\ \pmb{G}_{\mathrm{m}} \end{array} \right] = \left[ \begin{array}{l}\pmb{F}_{\mathrm{p}}\\ \pmb{\tau}_{\mathrm{m}} \end{array} \right] \end{array} \tag{1.2}
$$

其中， $\pmb{H}_{\mathrm{b}}$  为无人机惯性矩阵， $\pmb{H}_{\mathrm{m}}$  为机械臂惯性矩阵， $\pmb{H}_{\mathrm{bm}}$  为耦合惯性矩阵。 $\pmb{X}_{\mathrm{b}} = \left[\pmb {p}_{\mathrm{b}} \pmb {\Phi}_{\mathrm{b}}\right]^{\mathrm{T}}$  为无人机位姿(地惯系下坐标及偏航- 俯仰- 滚转姿态角)。 $\pmb{C}_{\mathrm{b}}$  和  $\pmb{C}_{\mathrm{m}}$  代表科氏力和离心惯性力。 $\pmb{G}_{\mathrm{b}}$  和  $\pmb{G}_{\mathrm{m}}$  是相应的重力项。 $\pmb{F}_{\mathrm{p}}$  和  $\pmb{\tau}_{\mathrm{m}}$  分别为无人机气动力和机械臂关节电机驱动力。

# (3)基于位形流形的等距嵌入模型

拉格朗日动力学系统可定义于黎曼流形上。具有约束的力学系的位形流形  $M$  可视为嵌在由自由质点组成的3n维位形空间中。该空间的黎曼度量以二次型 $\sum_{i = 1}^{n} m_{i} \dot{r}_{i}^{2}$  表示[45]。基于位形流形（C- Manifold）的嵌入模型是近来机器人领域重点研究的动力学建模新方法。其简洁动力学形式  $\pmb{J}^{\mathrm{T}} \ddot{\pmb{z}} = \pmb{\tau}$  与拉格朗日方程等价，在机器人的自适应控制中有良好的应用前景[46]。

递推牛顿- 欧拉公式或欧拉- 拉格朗日公式两种方法都能推导得到系统动力学方程，但前者更便于实际应用，而后者更适合研究动力学特性和分析研究。由欧拉- 拉格朗日公式得到的紧凑解析形式明确地提供了惯量矩阵、离心力和科氏力矩阵，以及重力矢量，因此有利于控制设计目的；用牛顿- 欧拉公式递推得到运动方程可以更有效地求解逆动力学问题[40]。此外，文献[47]提出了一种基于弹簧- 质量- 阻尼模型的闭环无人机建模和控制方法，针对性研究了在交互场景下的接触力控

制问题。

当前相关研究虽然对旋翼无人机与机械臂的建模控制及载荷稳定性进行了广泛分析和论证，然而多数文献对系统间耦合作用对整体动力学模型的影响机理研究并不透彻。特别是分离式建模方法，分别建立无人机和机械臂的动力学模型，而二者的相互作用仅作为外界扰动来考虑，且多采用PID等无模型控制器的鲁棒特性进行补偿。对旋翼无人机与机械臂之间相对动力学的忽视，如不考虑机械臂运动所引起的质心偏移与转动惯量的变化，会对执行终端的操作效果与抓取精度产生较大影响[44]。

# 1.2.2.2 无人机-机械臂自主控制与运动规划研究现状

# (1）无人机-机械臂自主控制

由于无人机与机械臂的耦合特性，现有的一般针对传统无人机构型的控制算法在应用于旋翼无人机- 机械臂组合系统时往往表现不佳[48]。根据分离式与一体化的建模策略可相应地采用不同控制方法。

$①$  基于分离式建模的控制策略

分离式控制策略是为旋翼无人机与机械臂分别设计独立的控制器，以实现无人机的稳定飞行控制和末端执行器的位置跟踪控制。大多数飞行作业任务可在悬停飞行模式下完成，此时旋翼无人机对机械臂的动力学层面的耦合较小，在机械臂控制时只需考虑其和旋翼无人机状态在运动学层面的耦合作用，即通过运动学逆解实现[49]。在后续控制器设计中，可把机械臂在动力学层面的耦合作用作为旋翼无人机外部扰动处理。Konstantin[49]等人把力/力矩传感器安装在直升机和工业机械臂之间以测量二者间的耦合力，同时把测量值用于直升机的控制以提高直升机的悬停性能。机械臂运动时的位形改变会引起系统惯性参数的变化，而其质心与转动惯量的变化量及其变化率可以反映出机械臂对旋翼无人机的耦合作用。文献[50,51]把质心的位置作为旋翼无人机动力学模型中的变化参数，在此基础上设计了反步（Backstepping）控制器以提升旋翼无人机的稳定飞行性能。

文献[52，53]通过牛顿一欧拉法选代计算出机械臂对旋翼无人机的扰动力/力矩，并在此基础上设计出了基于DOB(DisturbanceObserver）控制器用于飞行机械臂的控制。其中文献[52]中系统提出了模糊模型参考学习控制（FMLC）方法并与基于反馈线性化的PID（FL- PID），直接模糊逻辑控制（DFLC）两种控制律对比，可以实现系统在增加/释放载荷时的高精度稳定控制及良好的轨迹跟踪性能。

$(2)$  基于一体化建模的控制策略

一体化控制策略把旋翼无人机与机械臂视作一个整体系统，通过设计统一的控制器以同时实现无人机与机械臂各状态的稳定。该建模控制策略虽然能够清晰地反映出系统各状态间的耦合特性，从理论上证明整体系统的稳定性，但由于飞

行机械臂系统本身的高维度、欠驱动和强耦合特性，目前多数基于该策略设计的控制器相对复杂，实验大多在仿真中完成，难以在计算资源有限的实际嵌入式系统中实现[50]。如文献[43]通过设计阻抗控制器以实现系统在执行接触作业任务时的稳定悬停。在考虑系统不确定参数时，文献[54]进一步设计了一种非线性鲁棒自适应阻抗控制器。为实现飞行机械臂系统作业时控制性能的最优及末端执行器的轨迹跟踪控制，文献[55]、[56]分别设计了模型预测控制器（Model- Predictive Control）与自适应控制器（Adaptive Control），并分析了系统的闭环稳定性。

Lippiello V[57]等人提出一种基于混合模型预测控制（Hybrid Mode Predictive Control）的飞行接触式作业控制算法，该算法能够应用于不同飞行模态下，同时也能保证过渡过程的最优。该控制算法以末端的位置和接触力作为控制指标，能够实现位置轨迹跟踪的同时保持接触力不变，并成功应用于飞行书写任务。文献[17]基于六旋翼飞行器平台上设计了一种并联构型的机械装置，对系统整体建模并分析了无人机与机械臂的耦合作用，在CoppeliaSim环境下验证了运动学算法，并设计了自抗扰控制器和RBF滑模控制器以解决无人机与机械臂控制的耦合作用。

钟庆昌针对线性时不变（Linear Time- Invariant, LTI）系统提出了基于不确定性与扰动估计（Uncertainty and Disturbance Estimator, UDE）的鲁棒控制方法[58]。基于UDE的控制方法结构相对简单，具有较高的计算效率。该方法近来被应用于无人机的控制研究中，如在无卫星定位环境下的无人机鲁棒估计跟踪[59]。戚煜华等进一步提出了一种改进UDE控制律，在驱动器动力学辨识的基础上实现四旋翼无人机的精确姿态跟踪[60]。此外在分析系统动力学特性的基础上，还研究了多架四旋翼飞行机械臂的集群控制问题与协同运输问题[42]。

针对机器人自主抓取任务，任君凯提出了基于深度增强学习SAC方法，可不依赖于系统模型自主学习机械手的住区控制策略，具有较高的学习效率[61]。此外，Liu M等还提出了通过基于神经网络的方法生成高自由度机械手的抓取位姿[62]。

基于不同建模方式下的典型控制方法及其优劣对比如表1.2所示。

表1.2 振翼无人机-机械臂相关建模与控制方法对比  

<table><tr><td>建模
方式</td><td colspan="2">控制算法</td><td>优势</td><td>劣势</td></tr><tr><td rowspan="2">分离式</td><td>无
人
机</td><td>PID,反馈线性化,反步控制,自适应控制</td><td rowspan="2">模型相对简单;控制系统易于设计;计算量较小</td><td rowspan="2">通常不可同时驱动无人机与机械臂;控制精度较低</td></tr><tr><td>机
械
臂</td><td>独立联合控制
(FO,PID+重力补偿)</td></tr><tr><td>一体式</td><td colspan="2">反馈线性化,阻抗控制,非线性反步控制,LQR,自适应控制,模型预测控制(MPC)</td><td>无人机机械臂可同时驱动;闭环响应时间较短;控制精度较高</td><td>模型相对复杂;计算量较大</td></tr></table>

综上，无人机- 机械臂组合系统飞行过程中相互耦合作用显著，对外界扰动相对敏感，严重影响飞行控制的稳定性，成为非合作目标自主抓取方法研究的关键技术难题。国内外众多研究团队针对此问题开展了相关研究工作，针对不同任务场景设计了丰富多样的总体构型。当下研究对非合作目标的自主抓取仍存在诸多局限和不足，特别是对先进的控制算法仅在仿真平台实现，而在实际试验中多采用传统PID算法与分离式控制方案，对基于旋翼无人机平台的视觉伺服自主抓取技术研究尚不深入。

# (2）机械臂轨迹规划

机械臂的规划可分为从高层的任务规划、动作规划到低层的路径规划、轨迹规划，直至底层的电机控制[63]。路径规划指生成从起点到目标点的可行路径，路径通常由一组连接的航路点组成；轨迹规划是指在给定关节角约束条件下生成一个时间序列，如位置、速度和加速度的路径。有的文献中二者统称运动规划不做严格区分。

![](images/e7e8a6a53231caa10798be1eca4c556947a453eca4b8b248adcfe1c81de32bd1.jpg)  
图1.4机械臂规划与工作流程

轨迹规划可在关节空间或笛卡尔空间中进行。所规划的轨迹函数需连续光滑以保证运动的平稳性。在关节空间中是对单个关节的角位移、角速度和角加速度进行规划；在笛卡尔空间中是对机械臂末端的位置/姿态、速度/角速度进行规划，相应关节的位移、速度和加速度可通过逆运动学反解得到[41]。常用的规划方法有梯形法、多项式法(3阶或5阶)、二次最优规划及RRT算法等。

![](images/aa48798d2ea6fed861e535e87aa764f9f18f797b66991cc48ca5ae5159e6c938.jpg)  
图1.5笛卡尔空间与关节空间轨迹规划对比

# 1.2.3目标检测跟踪与视觉伺服控制研究现状

1.2.3 目标检测跟踪与视觉伺服控制研究现状空中操纵任务通常需要获取目标准确的位置信息，当前一些研究团队借助动作捕捉系统(MOCAP，如VICON、OptiTrack等）通过示教等方法来执行抓取任务[64- 66]。但该类方法在抓取时一般需要人工干预，不符合无人机系统对非合作目标自主抓取的研究目标。而基于机器视觉的视觉伺服技术是该领域未来重要的发展方向。

# 1.2.3.1基于深度学习的目标检测跟踪

1.2.3.1 基于深度学习的目标检测跟踪机器视觉方法通常用于目标的识别和定位以及运动规划等[67- 70]。由于“深度学习”技术的兴起，利用卷积神经网络进行目标检测的方法使得目标识别的准确率大大提高。Krizhevsky[71]在2012年首次利用深度学习完成图像分类得到了验证；2013年Ross Girshick[72]提出R- CNN（Regions with CNN features）算法，该算法中所提出的卷积神经网络框架是首个经典目标检测网络框架；Joseph[73]提出了YOLO（You Only Look Once）检测算法，该算法已迭代至YOLO v5，是当下的研究热点。刘伟[74]同时期提出了SSD（Single Shot Multibox Detector）算法，这两种算法将待检测的图像片划分为一个个较小的待检测区域，直接在较小的图像块中进行检测。这类方法在提升了算法的运行速度的同时，牺牲了算法的检测精度[75]。2010年Bolme[76]提出了基于判别式相关滤波（Discriminative Correlation Filter，DCF）的跟踪算法，该算法的跟踪速度极快，且具有良好的准确性。在相关滤波算法中，将跟踪问题转化为一个求目标特征和训练所得的最小均方误差输出和的滤波器的相关性的问题。Danelijan在算法中引入了HOG特征，HOG特征使得算法能够更为准确地理解到目标的纹理和边缘信息，通过将HOG映射到高维空间，分类更为准确，该方法被称为基于核化相关滤波器的（Kernelized Correlation Filters, KCF）跟踪算法[77]。针对无人机对非合作目标的跟踪问题，刘轩岑[78]进一步提出了一种基于YOLO- MSKCF（Multi- Scale KCF）的并行检测与跟踪方法，可以实现对静态与动态目标的高效检测跟踪。

# 1.2.3.2基于视觉伺服的机器人控制

1.2.3.2 基于视觉伺服的机器人控制视觉伺服（Visual Servo）是使用闭环控制环节中的计算机视觉数据来控制机器人运动。根据视觉误差定义的不同，视觉伺服控制系统主要分为基于位置的视觉伺服控制（Position- Based Visual Servo, PBVS）与基于图像的视觉伺服控制（Image- Based Visual Servo, IBVS）。其中，PBVS控制系统利用视觉测量信息在三维工作空间中对目标物体进行位姿估计，将末端执行器与目标物体的当前位姿和期望位姿之差传递至视觉伺服控制器并解算控制指令，驱动机械臂运动到达期望的位姿[79, 80]。IBVS控制系统根据当前的图像特征与预设的期望图像特征间的偏

差设计视觉伺服控制器，生成控制信号并驱动机械臂运动。其状态测量信息与控制指令均定义在二维像平面中。当前图像特征与期望图像特征的误差小预设阈值时，判定机械臂末端执行器到达期望位姿。IBVS方法将末端执行器/相机与目标的相对位姿关系隐含于图像特征中，对机器人模型、相机参数及图像测量信息的误差具有较强的宽容性。

![](images/51073e51f1f86fba562d03d2295530ef84f2ee375b710396e06a080cf49639ea.jpg)  
图1.6 PBVS与IBVS视觉伺服控制结构对比

手眼标定是实现视觉伺服控制的关键环节，Roger Tsai[81]等最早进行了关键标定技术研究。如图1.7所示，依据机器人和相机的安装方式，可将手眼标定问题分为两类构型：眼在手外(Eye- to- Hand)：相机固定，与机器人基坐标系相对位置不变；眼在手上(Eye- in- Hand)：相机安装在机器人末端并随着机器人一起移动。

![](images/e5cf3b5f5ca9180bc3e742960b56bc28e25d98a389a4620e95f078a0b1815ace.jpg)  
图1.7 机器人手眼标定构型示意图

对于Eye- to- Hand系统，相机可获得较大的视场范围，在此构型下可同时观测目标物体和末端执行器的运动状态。但机械臂的运动可能致使目标被遮挡，且测量误差随相机与目标的相对距离增加而增大，影响视觉伺服任务的执行精度。对于Eye- in- Hand系统，当末端执行器靠近目标时，相机的测量误差减小，可服务于高精度的视觉伺服控制任务。但由于相机的视角范围较小且视场随机械臂的运动而变化，目标可能会超出相机视场范围。因此，近来结合Eye- to- Hand和Eye- in- Hand构型的混合视觉伺服系统得到了广泛研究，这类系统在获取较大视场范围的同时能有效提高控制精度。如邱周静子提出了基于滑模观测器和自适应预测控制的混合视觉伺服动力学控制方法[82]，该方法可在无关节角速度测量信息的情形下，同时处理机械臂非线性动力学、模型不确定性和系统约束问题。

随着以深度相机为代表的3D图像传感设备的推出普及，对目标物体的立体检测与位姿估计得到了长足发展，以GraspNet为代表的自主抓取方法[83,84]近来开始

在机械臂视觉伺服领域大显身手。Wadim Kehl 等[85]提出了基于 SSD 算法的目标 6D 位姿估计，该方法结合了二维图像深度信息与三维物体 RGB- D 图像特征，如图 1.8(a)。文献[86]则基于 RGB- D 数据开发了一个端到端深度网络模型用于 6D 位姿估计，可对机器人实时抓取和操作进行快速准确的预测，如图 1.8(b)。此外，基于三维点云信息的目标识别与视觉伺服控制也在飞行机械臂领域得到关注[87, 88]。

![](images/21a87be79af6215cd4c6b53483a39a7c1326107f00eabd00bdda1b36002e97ef.jpg)  
图 1.8 基于深度学习的 6D 位姿估计与自主抓取

当前基于深度学习的人工智能技术在机器人视觉伺服中已得到初步应用，但针对旋翼无人机平台的视觉伺服系统研究尚不充分。此外，目前相关研究对嵌入式处理设备性能要求较高，这使视觉伺服系统在工作时计算量较大，难以满足系统实时性控制的要求。在图像处理完成后，如何在考虑无人机与机械臂耦合运动条件下解算图像特征与机器人各连杆关节运动间的关系是另一研究难题。

# 1.3 论文研究内容与组织结构

本论文以基于旋翼无人机- 机械臂组合系统的空中抓取平台为研究对象，紧跟多旋翼飞行器接触式应用的发展趋势，开展面向工程化应用的非合作目标自主抓取技术研究。根据预设非合作目标的物理特征，设计适用的带臂无人机组合系统总体构型，并基于一体化策略建立组合系统动力学模型；研究基于机器视觉技术的目标智能检测识别方法，并解算无人机与目标的空间相对位置与姿态，实现无人机向目标区域的自主靠近与避障；研究机械臂抓取目标的轨迹规划与基于视觉伺服的鲁棒跟踪控制方法，结合仿真与实验验证控制律与相关算法的有效性，最终实现旋翼无人机对特定非合作目标的稳定跟踪与精准抓取。

具体章节内容按如下安排：

(1) 绪论部分阐述了本论文的研究背景及研究现状，主要从系统构型、建模与控制方法、目标检测与视觉伺服三方面整理了当前基于旋翼无人机的自主操纵任务的学术与工程研究概况与前沿进展。对论文的研究内容与各部分组织关系进行了概述与梳理。

(2）第二章设计了面向非合作目标自主抓取的系统总体方案。针对任务需求选取合适的多旋翼无人机构型，确定机械臂与抓取机构的结构方案和性能指标，进一步设计机械臂搭载于多旋翼无人机平台的基本方案。对系统采用的视觉识别模块、机载嵌入式计算机及遥控地面站等软硬件模块进行选型。构建对应的仿真三维模型，对各分系统间的工作关系与信息流进行梳理分析。

(3）第三章推导了旋翼无人机与机械臂的运动学与动力学模型。首先建立无人机- 机械臂系统的基本坐标系并分析各坐标系向转化关系。借鉴分离式策略，根据六旋翼工作原理分析无人机运动学及动力学特性，基于D- H法则推导机械臂各连杆齐次变换关系，并迭代推算无人机、机械臂关节与末端执行器的运动学关系。基于欧拉- 拉格朗日方程建立了无人机- 机械臂复合系统的动力学模型，并对动力学方程的各项特性展开分析。

(4）第四章开展了无人机与机械臂自主控制与运动规划方法研究。分析旋翼无人机的基本分级控制逻辑，推导本文所用六旋翼无人机构型的控制分配方程。根据系统非线性动力学模型，考虑无人机与机械臂的耦合作用，设计分离式的自主控制策略。针对机械臂作动模式以及末端器受力特点，在无人机串级PID控制系统基础上设计基于UDE与调度增益（GS）策略的改进控制器，对自主跟踪控制系统进行设计；针对机械运动特点设计基于滚动时域策略的机械臂轨迹规划器。进行初步仿真分析验证系统在复杂扰动情况下实现稳定的悬停控制与轨迹跟踪的性能。

(5）第五章研究了复合系统的组合视觉伺服控制方法。阐述基于卷积神经网络的YOLOv5s方法的基本原理，以地面危爆品为对象进行目标检测试验；考虑实时检测的要求及机载设备的能力限制设计目标位置信息融合算法，依据检测与跟踪结果计算目标在图像视场的位置，基于EPnP方法计算目标与无人机、末端执行器的相对位姿关系；结合PBVS与IBVS的视觉伺服控制律，通过仿真与实验测试验证检测识别方案的可靠性。

(6）第六章分别基于仿真环境与实物平台进行了非合作目标抓取试验验证。基于Simulink- ROS搭建虚拟仿真平台，集成各系统模型与控制策略，迭代优化无人机- 机械臂系统的轨迹跟踪与自主控制算法。将仿真验证的控制律移植至实际多旋翼无人机抓取平台，进行实际飞行与对非合作目标的自主抓取测试。对比基于仿真与实际飞行抓取试验的结果，验证本论文构建模型的正确性及提出的目标检测跟踪方案、自主控制及轨迹规划算法的可行性。

(7）结束语对全文工作进行总结归纳，并分析存在的不足与未来研究工作的推进方向。

论文的组织结构与各章节关系如图1.9所示

![](images/869146491dbb6ff60583ae9315c544476b26cde8732018c95752bfb97c1105c1.jpg)  
图1.9论文组织结构图

# 第二章 旋翼无人机自主抓取系统总体设计

本章针对特定工程任务需求设计了一种基于旋翼无人机平台的自主抓取方案。确定了旋翼无人机构型及其搭载的机械臂与末端执行器的结构方案，对机载嵌入式计算机、机器视觉处理模块等进行了选型分析，初步分析了各分系统的性能参数与工作通讯关系并对仿真模型与实物平台进行集成构建。

# 2.1 任务需求分析与系统组成

# 2.1.1 自主抓取任务需求分析

为执行户外复杂环境下的自主抓取任务，以具有典型几何外观特征的微小型目标为识别与抓取对象，无人机及自主抓取装置应具备如下特征：

1. 无人机具备高精度定位与良好的姿控能力，续航、机动性与负载能力应符合需要；2. 可搭载嵌入式计算设备实时处理图像信息，将目标相对机体参考系的位姿信息实时发送给自主抓取操控系统；3. 无人机悬停时，机械臂应在不明显遮挡相机视场的前提下具有灵活的工作空间。机械臂执行舵机具有较高的力矩负载能力。执行抓取任务时，需尽可能避免奇异位形；4. 末端执行器应配备力传感器或采用柔性夹爪设计，以处理不同物理特性的任务目标，并设置末端图像传感设备，以完成抓取阶段的图像检测任务。

# 2.1.2 系统组成与工作流程

# 针对上节所述任务需求，设计如下基本方案：

基于旋翼无人机的自主抓取系统由无人机飞行平台、机械抓取系统、视觉检测模块及遥控地面站组成。

以六旋翼无人机为飞行载荷平台，在机架上集成飞控、传感器、电机、电调、数传电台等组件，可载重垂直起降、巡航并定点悬停；

视觉检测模块由机载计算机、机载云台相机、末端随动相机组成，将实时获取的图像在线处理识别目标并发送给地面站；

机械抓取系统与无人机平台底部固连，包含4自由度机械臂、末端执行器夹爪及驱动器，单自由度夹爪固连于机械臂末端；

遥控地面站由遥控器、高清显示屏、数传电台及移动便携式计算机组成，可

发送无人机与机械臂的执行指令并监测其状态信息，同时接收机载计算机处理后的图像与目标监测信息。

自主抓取系统的组成及各分系统工作流程如图2.1所示。其中空中端的传感器系统包括测量无人机位姿的气压计、惯组模块（IMU）、卫星定位模块（GNSS）及获取图像信息的云台相机与末端相机等视觉检测模块。传感器系统将无人机状态及拍摄的图像信息发送至中间机载计算机及飞行控制器处理模块，控制指令经机载计算机及飞控解算后发送给无人机电机、相机云台、机械臂舵机、末端执行器步进电机等执行机构。空中端与地面端通过数传与图传模块传输控制指令、状态信息及图像数据。

![](images/e2465a9a2776563027f51201db770cc43bf51849a84a1c4ddb477dbfa2b12fb2.jpg)  
图2.1旋翼无人机自主抓取系统组成与工作流程

# 2.2 旋翼无人机平台与机载设备选型

# 2.2.1六旋翼无人机平台

选用大疆经纬  $\mathrm{M600Pro}$  六旋翼无人机作为飞行与任务载荷平台。主要参数如表2.1所示：

表  $2.1\mathrm{M}600\mathrm{Pro}$  六旋翼无人机主要参数  

<table><tr><td>参数</td><td>规格/数值</td><td>参数</td><td>规格/数值</td></tr><tr><td>尺寸</td><td>1668×1518×727mm</td><td>螺旋桨</td><td>DJI 2170R</td></tr><tr><td>轴距</td><td>1133mm</td><td>电机</td><td>DJI 6010</td></tr><tr><td>自重</td><td>9.5kg</td><td>电池</td><td>TB47S</td></tr><tr><td>最大负载</td><td>6kg</td><td>最大俯仰角</td><td>25°</td></tr><tr><td>最大角速度</td><td>俯仰：300°/s
偏航：150°/s</td><td>悬停精度</td><td>水平：±1.5m
垂直：±0.5m</td></tr><tr><td>最大平飞速度</td><td>18m/s（无风）</td><td>最大升降速度</td><td>+5m/s，-3m/s</td></tr></table>

相比一般欠驱动的四旋翼布局，六旋翼无人机可在某个动力单元失效时，以放弃偏航角控制为代价换取其余通道控制的相对稳定[1]。因此，具有更高的安全冗余度。

![](images/7572d0a4070e3515fdef4b709166b59b1835599ab9f64621eec4d29a5fc89f24.jpg)  
图2.2 Matrice  $600\mathrm{Pro}$  六旋翼无人机构型

根据官方标称数据，该型无人机标配A3 Pro飞控，三冗余度IMU及GPS- 磁罗盘模块。搭载禅思X3云台相机通过Lightbridge2数字图传系统实时回传高清图像。无风时空载续航  $32\mathrm{min}$ ，具有灵活的大载荷装配能力[89]。针对本文的对非合作目标自主抓取任务，该型无人机可作为稳定的机载视觉与机械操作的载荷平台。

# 2.2.2 机载云台相机

为M600 Pro无人机配备禅思X3型云台相机。通过3自由度云台可调节相机的视线方向，并扩大无人机的视野范围。主要参数如表2.2所示：

![](images/eb74d99c121d1bc8b911424a038f6e2f056891c5edfbf15d91d40bb2df6f3058.jpg)  
图2.3 禅思X3云台相机实物图

表2.2禅思X3机载云台相机主要参数  

<table><tr><td>参数</td><td>规格/数值</td><td>参数</td><td>规格/数值</td></tr><tr><td>云台转角限制</td><td>纵向：[-90+30]°
水平：[-320+320]°</td><td>云台转速限制</td><td>纵向：120°/s
水平：180°/s</td></tr><tr><td>CMOS</td><td>Sony Exmor 1/2.3&quot;</td><td>光圈</td><td>F/2.8</td></tr><tr><td>等效焦距</td><td>20mm</td><td>视角(FOV)</td><td>94°</td></tr><tr><td>最高分辨率</td><td>4K (4000×3000)</td><td>最高帧率</td><td>60fps</td></tr></table>

# 2.2.3 机载计算设备

选用NVIDIA® Jetson Nano™及大疆妙算MANIFOLD 2- C作为机载图像处理及实时计算设备，与相机、无人机飞控及机械臂驱动器交互。在Ubuntu操作系统下进行机器视觉算法的部署，并基于DJI OSDK开展无人机与机械臂运动规划算法的二次开发。

![](images/ffc064057443b2188e80f2c5b2fd37b4b4d1839e0d552aa59d0231d52cc72cc8.jpg)  
图2.4 机载图像处理与计算设备

OSDK通过接口可获取无人机上的实时状态数据，将软件架构与控制算法部署于机载计算设备中，执行预定的计算处理任务，生成对应的控制指令控制无人机与机械臂执行相应的动作，实现如航线跟踪、图像处理及云台、负载控制等功能。

# 2.3 机械臂及末端执行机构设计

本文中固连于无人机平台的自主抓取机械装置采用了基于刚性连杆与数字伺服舵机的4R构型机械臂及基于鳍条效应的末端执行器设计。

# 2.3.1 多自由度机械臂构型

![](images/59ed96645c43b3bec29679d3a74f5e28697a2b30984f45c8a3faa9ec622ed3dc.jpg)  
图2.54R型串联开链机械臂构型

4R型串联开链舵机机械臂由连接无人机的固定基座、转台、3组连杆及4组数字舵机组成，具有4个转动自由度。舵机1的转轴与转台固连，与无人机机体平面垂直，赋予执行器绕机体竖直轴线旋转的自由度；舵机2、3、4通过连杆连接，转轴相互平行，赋予执行器沿朝向纵平面运动的自由度。伺服舵机相关参数见表2.3。注意机械臂装置使系统质心靠下，且随着位形变化导致系统惯性参数时变，对多旋翼无人机飞行稳定性会产生一定的影响。

表2.3机械臂数字舵机参数  

<table><tr><td>参数</td><td>舵机1,2</td><td>舵机3,4</td></tr><tr><td>驱动芯片</td><td>PCA9685</td><td>PCA9685</td></tr><tr><td>尺寸</td><td>64×33×70.1mm</td><td>65×30×48mm</td></tr><tr><td>质量</td><td>333g</td><td>163g</td></tr><tr><td>驱动电压</td><td>10~14.8V</td><td>6~8.4V</td></tr><tr><td>最大电压</td><td>8.5A</td><td>6.5A</td></tr><tr><td>转角范围</td><td>300°</td><td>270°</td></tr><tr><td>精度</td><td>2.5°</td><td>2.5°</td></tr><tr><td>脉宽范围</td><td>0.5~2.5ms</td><td>0.5~2.5ms</td></tr><tr><td>控制周期</td><td>20ms</td><td>20ms</td></tr></table>

# 2.3.2 末端执行器

![](images/317e07b297565e5ef7d4bab537a054275e0600e41f206169e9c8aa88a1c1ac6f.jpg)  
图2.6 基于鳍条效应的末端执行器模型

如图2.6所示，末端执行器由1- 固定基座、2- 丝杠螺母、3- 移动基座、4- 支撑连杆、5,6- 鳍条夹指与7- 步进电机构成。抓取的控制指令使步进电机的丝杠旋转，丝杠螺母将旋转运动转化沿电机轴线的平移运动，进而通过固定基座支撑杆、移动基座、支撑连杆与鳍条夹指固定端构成的四连杆平移机构实现各鳍条夹指开合角度的变化。步进电机主要参数见表2.4：

表2.4末端执行器步进电机参数  

<table><tr><td>参数</td><td>规格/数值</td><td>参数</td><td>规格/数值</td></tr><tr><td>驱动芯片</td><td>DRV8825</td><td>驱动方式</td><td>2H桥驱动</td></tr><tr><td>尺寸</td><td>35×35×47mm</td><td>标准电压</td><td>12V</td></tr><tr><td>质量</td><td>130g</td><td>额定电流</td><td>0.95A</td></tr><tr><td>步距角</td><td>1.8°</td><td>稳定力矩</td><td>0.1N·m</td></tr></table>

基于鳍条效应的三夹指设计可以使末端执行器自适应抓取具有不同几何特性的物体，特别适用于未预设配对接口的非合作目标。以球状物体为例，抓取效果如图2.7所示。

![](images/8e7d82bbba1fb060455b42072c15700c94c5b14e11e882c1882ae2ce88a1594f.jpg)  
图2.7 末端执行器抓取实物效果

# 2.3.3末端随动相机

2.3.3 末端随动相机在末端执行器鳍条连接端基座安装 FPV 相机，用以弥补因机械臂及末端执行器运动造成目标在机载云台相机成像遮挡的问题。该相机随末端执行器一同运动，光轴与步进电机转轴重合，在接近抓取目标时进行检测识别。本文选用如图 2.8 所示的 RunCam Split 4 型 FPV 相机，可实时向嵌入式计算设备传输高清图像，并由图传设备向地面站发送模拟图像。主要参数如表 2.5 所示。

表  $2.5\mathrm{RC}$  Split4末端随动相机主要参数  

<table><tr><td>参数</td><td>规格/数值</td><td>参数</td><td>规格/数值</td></tr><tr><td>尺寸</td><td>14×14×21.8mm</td><td>质量</td><td>10.2g</td></tr><tr><td>CMOS</td><td>Sony 13MP</td><td>通信接口</td><td>UART</td></tr><tr><td>等效焦距</td><td>\</td><td>视角(FOV)</td><td>140°</td></tr><tr><td>分辨率</td><td>4K</td><td>最高帧率</td><td>60fps</td></tr></table>

![](images/0a534282cea778e24b2762c3e511fba4522aa552fef7c561c94568c9baff36bf.jpg)  
图2.8 RC Split 4 FPV 相机实物图

# 2.4 系统复合模型构建与装配集成

2.4 系统复合模型构建与装配集成参考实物尺寸在 Solidworks 中分别建立无人机与机械臂的三维模型并整合为装配体，如图 2.9 所示。由于 M600 Pro 采用多传感器冗余及及 6 电池并联供电，系统较为复杂，部分组件参数未公开且未获取实测数据。为使仿真模型更可靠，参照采用相似构型并可查阅公开参数的 DJI S900 六旋翼飞行器，通过 Flyeval 及 Ecalc 开源平台进行无人机动力学性能初步评估（详见附录）并建模。注意各模型需严格参照相关坐标系定义（详见 3.1 节），并设定相应的质量、密度、转动惯量等属性，为后续 Simscape 动力学仿真作准备（详见 6.1 节）。

![](images/afb41c9d8697800bb33ac8ee433173d2795358fe6363bb9cf204a9a1af647ee5.jpg)  
图2.9 六旋翼无人机自主抓取系统 Solidworks 装配体模型

根据上述硬件系统的选型设计，依照图2.1中所设计的工作关系可梳理系统硬件连接与通讯关系。进一步完成对仿真模型与实物平台的集成装配与调试。本文所用的基于M600 Pro六旋翼无人机自主抓取系统实物测试平台集成装配状态如图2.10所示。

![](images/c11d29b6d54d1a1516c5b1a7af6627d3bd196bf48371bf42610ec8ccb7329dbb.jpg)  
图2.10 基于M600 Pro的自主抓取系统实物测试平台

# 2.5 本章小结

本章在考虑对非合作目标的空对地自主抓取任务需求的基础上，对多旋翼无人机飞行平台与机载计算机等硬件设备进行了选型，设计了4R串联开链构型的机械臂及基于鳍条效应的末端执行器。针对视觉系统处理的要求分别确定了机载云台相机与末端随动相机型号。参考所选各系统型号参数建立了用于仿真系统的三维模型，梳理了各硬件系统的通讯工作关系并进行集成装配。所设计的基于六旋翼无人机的机械操纵系统可以满足对预定非合作目标的自主抓取任务需求，为后文系统建模、控制律设计与仿真及实物试验确立了总体方案。

# 第三章 旋翼无人机-机械臂系统动力学建模

系统动力学模型的建立是后续进行控制系统设计的基础。本章在确立系统基本坐标系定义并进行无人机与机械臂运动学分析的基础上，采用牛顿- 欧拉方法推导不考虑构型变化的旋翼无人机动力学方程，并分析多自由度机械臂的运动学特性，进而推导建立全系统的拉格朗日动力学模型。

# 3.1 坐标系定义及转换关系

为描述无人机飞行的运动参数及机械臂各关节与末端执行器的相对位置，需定义相应的坐标系，并通过欧拉角及方向余弦阵描述各坐标系间的转换关系。

# 3.1.1 基本坐标系定义

本文所述坐标系均定义于笛卡尔空间，按右手法则确立。系统除机械臂各关节连杆外的基本坐标系如图3.1所示，各系  $X$  、  $Y$  、  $Z$  坐标轴分别用红、绿、蓝三色指示。

![](images/2ae6707657046e1a15a5e4adc64f652845442674a70fd1eabf2d02f2df7b2e20.jpg)  
图3.1无人机自主抓取系统基本坐标系定义

# 3.1.1.1世界坐标系  $\Sigma_{w}(O - X_{w}Y_{w}Z_{w})$

世界坐标系用于描述无人机质心及机械臂末端执行器的绝对位置。对短时近距的飞行任务，忽略地球自转的影响，  $\Sigma_{w}$  可视作惯性系。世界坐标系常采用ENU（东- 北- 天）、NED（北- 东- 地）两种定义。为统一描述无人机与执行器的运动参数便于与ROS交互，本文后续均采用ENU定义。

原点  $O$  ：与无人机执行任务的起飞点（机体系原点在地表竖直投影）固连； $X_{w}$  轴：沿当地水平面指向正东方向为正； $Y_{w}$  轴：沿当地水平面指向正北方向为正； $Z_{w}$  轴：垂直于当地水平面朝上为正。

# 3.1.1.2机体坐标系  $\Sigma_{d}(O_{d} - X_{d}Y_{d}Z_{d})$

机体坐标系固连于无人机跟随运动。

原点  $O_{d}$  ：与无人机质心或机械臂安装基点（第一关节旋转轴与安装平面交点）重合；

$X_{d}$  轴：沿机体对称平面指向飞行器正前方为正； $Y_{d}$  轴：垂直于机体对称平面指向飞行器左侧为正； $Z_{d}$  轴：沿机体对称平面朝飞行器上方为正。

# 3.1.1.3基坐标系  $\Sigma_{b}(O_{b} - X_{b}Y_{b}Z_{b})$

基坐标系用于描述机械臂各连杆及执行器相对无人机机体的运动参数。

原点  $O_{b}$  ：位于机械臂安装基点（第一关节旋转轴与安装平面交点），为简化分析设为与机体系原点  $O_{d}$  重合。

$X_{b}$  轴：沿机体对称平面指向飞行器正前方为正； $Y_{b}$  轴：垂直于机体对称平面指向飞行器右侧为正； $Z_{b}$  轴：沿机体对称平面朝飞行器下方为正。

# 3.1.1.4末端工具坐标系  $\Sigma_{e}(O_{e} - X_{e}Y_{e}Z_{e})$

原点  $O_{e}$  定义于末端执行器机械接口(MechanicalInterface)中心，同时设为预定抓取点，  $X_{e}$  轴朝外指向抓取方向。  $\Sigma_{e}$  系等价于机械臂末连杆坐标系，相关定义将在3.3节由D- H参数给出。

# 3.1.1.5目标坐标系  $\Sigma_{t}(O_{t} - X_{t}Y_{t}Z_{t})$

原点  $O_{t}$  定义于待抓取物体经目标检测后识别的几何中心处，各坐标轴指向根据目标几何特征预设。当执行抓取任务结束时，工具坐标系应与目标坐标系重合，

若不考虑抓取姿态的约束，仅需对应原点重合。

$\Sigma_{c0}$  、  $\Sigma_{c1}$  分别为机载相机与末端相机坐标系，与视觉系统相关的坐标系将在5.1节详细描述。

# 3.1.2坐标转换关系与欧拉角定义

对于无人机- 机械臂组合系统的运动学分析，需要通过坐标转换将各状态矢量转换到一致的坐标系中描述。对于姿态转换采用绕运动坐标轴连续旋转得到，以对应坐标系间的方向余弦阵描述。

从  $\Sigma_{w}$  系到  $\Sigma_{d}$  系的姿态转换可由采用3- 2- 1转序的欧拉角  $\Phi$  描述。 $\Phi = \left[\phi \theta \psi \right]^{\mathrm{T}}\in \mathbb{R}^{3}$  ，  $\phi$  、  $\theta$  、  $\psi$  分别表示滚转角、俯仰角、偏航角。从  $\Sigma_{w}$  系到  $\Sigma_{d}$  系的欧拉角转换关系如图3.2所示。

![](images/996aa8a93a8ea27e1fae4afbc3ea66215318aa0e30db7f8411e4b8859dd6acf6.jpg)  
图3.2世界系与机体系欧拉角关系示意图

设  $M_{1}(\phi),M_{2}(\theta),M_{3}(\psi)$  分别为绕各坐标轴旋转对应欧拉角的旋转矩阵：

$$
M_{1}(\phi) = \left[ \begin{array}{ccc}1 & 0 & 0\\ 0 & \cos \phi & \sin \phi \\ 0 & -\sin \phi & \cos \phi \end{array} \right],M_{2}(\theta) = \left[ \begin{array}{ccc}\cos \theta & 0 & -\sin \theta \\ 0 & 1 & 0\\ \sin \theta & 0 & \cos \theta \end{array} \right],M_{3}(\psi) = \left[ \begin{array}{ccc}\cos \psi & \sin \psi & 0\\ -\sin \psi & \cos \psi & 0\\ 0 & 0 & 1 \end{array} \right] \tag{3.1}
$$

则由世界系  $\Sigma_{w}$  到机体系  $\Sigma_{d}$  的方向余弦阵为：

$$
\begin{array}{rl} & {R_w^d = M_1(\phi)\cdot M_2(\theta)\cdot M_3(\psi)}\\ & {\quad = \left[ \begin{array}{ccc}\cos \theta \cos \psi & \cos \theta \sin \psi & -\sin \theta \\ \sin \phi \sin \theta \cos \psi -\cos \phi \sin \psi & \sin \phi \sin \theta \sin \psi +\cos \phi \cos \psi & \sin \phi \cos \theta \\ \cos \phi \sin \theta \cos \psi +\sin \phi \sin \psi & \cos \phi \sin \theta \sin \psi -\sin \phi \cos \psi & \cos \phi \cos \theta \end{array} \right]} \end{array} \tag{3.2}
$$

由  $\Sigma_{d}$  系到  $\Sigma_{b}$  系的坐标转换通过绕  $X_{d}$  轴旋转  $180^{\circ}$  得到：

$$
R_{d}^{b} = M_{1}(\pi) = \mathrm{diag}(1, -1, -1) \tag{3.3}
$$

由  $\Sigma_{b}$  系到  $\Sigma_{e}$  系的坐标转换将在3.3节中根据机械臂D- H法则由齐次变换推导得到。

# 3.2 多旋翼无人机建模

为简化分析便于后续控制系统的设计调参,忽略次要因素,多旋翼无人机的建模基于下述假设:

1. 无人机为刚体,质量定常(由于机械臂运动,质心与惯性张量不定,使动力学分析复杂化,本节中将机械臂的初始惯性参数视为定常与无人机相关参数合并,其惯性参数的变化视为外界扰动);

2. 无人机机身平面对  $Z_{d}$  轴中心对称,几何中心与质心重合(即上节所述  $\Sigma_{d}$  系及  $\Sigma_{b}$  系原点);

3. 忽略机臂上反角及桨叶挥舞效应,忽略机体结构对空气动力的影响,升力全部由螺旋桨提供且始终垂直于机身平面向上(即  $Z_{b}$  轴正向)。

由于旋翼无人机构型相较一般固定翼无人机复杂,不同姿态角及速度下阻力系数难以准确定量。考虑到本文中无人机执行任务时巡航速度较低或处于悬停状态,可忽略气动阻力影响或采用平方近似公式计算。

# 3.2.1 机体系下动力学模型

令  $\pmb{\nu}_{d} = \left[\nu_{x} \nu_{y} \nu_{z}\right]^{\mathrm{T}} \in \mathbb{R}^{3}$ ,  $\pmb{\omega}_{d} = \left[\omega_{x} \omega_{y} \omega_{z}\right]^{\mathrm{T}} \in \mathbb{R}^{3}$  分别为无人机在  $\Sigma_{d}$  系下的速度矢量与旋转角速度矢量。设系统质量为  $m$ ,电机- 螺旋桨产生的升力矢量在  $\Sigma_{d}$  系下表示为  $\pmb{T}_{d} = \left[0 0 T\right]^{\mathrm{T}}$ ,忽略外界扰动作用,则机体系下的质心平动动力学方程为:

$$
m\left(\dot{\pmb{\nu}}_{d} + \pmb{\omega}_{d} \times \pmb{\nu}_{d}\right) = \pmb{T}_{d} + \pmb{R}_{w}^{d}\pmb{G} \tag{3.4}
$$

其中,  $m$  为系统总质量,  $\pmb{G} = \left[0 0 - m g\right]^{\mathrm{T}}$  为  $\Sigma_{w}$  系下重力矢量,  $g$  为重力加速度。

由角速度合成定理可知,  $\Sigma_{d}$  系下无人机相对世界系的角速度矢量为:

$$
\pmb{\omega}_{d} = \dot{\pmb{\psi}} +\dot{\pmb{\theta}} +\dot{\pmb{\phi}} \tag{3.5}
$$

按坐标旋转关系,参考图3.2可得机体系下的欧拉动力学方程的分量形式:

$$
\left[ \begin{array}{l}\omega_{x}\\ \omega_{y}\\ \omega_{z} \end{array} \right] = M_{1}\left(\phi\right)M_{2}\left(\theta\right)\left[ \begin{array}{l}0\\ 0\\ \dot{\psi} \end{array} \right] + M_{1}\left(\phi\right)\left[ \begin{array}{l}0\\ \dot{\theta}\\ 0 \end{array} \right] + \left[ \begin{array}{l}\dot{\psi}\\ 0\\ 0 \end{array} \right] = \left[ \begin{array}{l} - \sin \theta & 0 & 1\\ \sin \phi \cos \theta & \cos \phi & 0\\ \cos \phi \cos \theta & -\sin \phi & 0 \end{array} \right]\left[ \begin{array}{l}\dot{\psi}\\ \dot{\theta}\\ \dot{\psi} \end{array} \right] \tag{3.6}
$$

将从欧拉角转轴到机体系  $\Sigma_{d}$  的转换矩阵记为  $\pmb{R}_{\epsilon}^{d}$ ，则上式可简记为：

$$
\omega_{d} = R_{\epsilon}^{d}\dot{\Phi} \tag{3.7}
$$

由动量矩定理可得：

$$
\pmb{I}_{d}\dot{\pmb{\omega}}_{d} + \pmb{\omega}_{d}\times \pmb{I}_{d}\pmb{\omega}_{d} = \pmb{M}_{e} \tag{3.8}
$$

$\pmb{M}_{e}$  为施加在机体系上的外力矩，  $\pmb{I}_{d}$  表示当前系统构型下组合系统的惯性张量：

$$
\pmb{I}_{d} = \left[ \begin{array}{ccc}I_{x} & -I_{xy} & -I_{xz}\\ -I_{xy} & I_{y} & -I_{yz}\\ -I_{xz} & -I_{yz} & I_{z} \end{array} \right] \tag{3.9}
$$

当  $\Sigma_{d}$  系各轴均为对系统质心的中心惯量主轴时，  $\pmb{I}_{d}$  中仅保留对角线上的各轴转动惯量，惯性积分量均为0。将(3.8)展开简化可得欧拉动力学方程：

$$
\left\{ \begin{array}{l}I_{x}\dot{\omega}_{x} = M_{x} - \left(I_{z} - I_{y}\right)\omega_{y}\omega_{z} \\ I_{y}\dot{\omega}_{y} = M_{y} - \left(I_{x} - I_{z}\right)\omega_{z}\omega_{x} \\ I_{z}\dot{\omega}_{z} = M_{z} - \left(I_{y} - I_{x}\right)\omega_{x}\omega_{y} \end{array} \right. \tag{3.10}
$$

# 3.2.2 世界系下动力学模型

设  $\pmb{p}_{d} = \left[x_{w}y_{w}z_{w}\right]^{\mathrm{T}}\in \mathbb{R}^{3}$  为  $\Sigma_{w}$  系下无人机质心的位置，  $\pmb{\omega}_{d}^{w} = \left[\omega_{x}^{w}\omega_{y}^{w}\omega_{z}^{w}\right]^{\mathrm{T}}\in \mathbb{R}^{3}$  为无人机的旋转角速度在  $\Sigma_{w}$  系下的表示。将从欧拉角转轴到世界系  $\Sigma_{w}$  的转换矩阵记为  $\pmb{R}_{\epsilon}^{w} = \pmb{R}_{b}^{w}\pmb{R}_{\epsilon}^{b}$ ，则  $\Sigma_{w}$  系下的欧拉运动学方程：

$$
\pmb{\omega}_{d}^{w} = R_{b}^{w}\pmb{\omega}_{d} = R_{\epsilon}^{w}\dot{\pmb{\Phi}} \tag{3.11}
$$

电机- 螺旋桨提供的总升力大小为  $T_{\parallel}$  对机体各轴的力矩设为  $\pmb {\tau} = \left[\tau_{x}\tau_{y}\tau_{z}\right]^{\mathrm{T}}$  。考虑小角度假设，忽略机械臂构型变化及外界扰动作用，世界系  $\Sigma_{w}$  下的动力学模型可简化为：

平动动力学：

$$
\left\{ \begin{array}{l}\ddot{x}_w = -\frac{T}{m} [\cos \psi \sin \theta \cos \phi +\sin \psi \sin \phi ] \\ \ddot{y}_w = -\frac{T}{m} [\sin \psi \sin \theta \cos \phi -\cos \psi \sin \phi ] \\ \ddot{z}_w = \frac{T}{m} [\cos \theta \cos \phi ] - g \end{array} \right. \tag{3.12}
$$

欧拉动力学：

$$
\left\{ \begin{array}{l}\ddot{\phi} = \frac{1}{I_x}\Big[(I_y - I_z)\dot{\theta}\dot{\psi} +I_r\dot{\theta}\overline{\Omega} +\tau_x\Big]\\ \ddot{\theta} = \frac{1}{I_y}\Big[(I_z - I_x)\dot{\phi}\dot{\psi} -I_r\dot{\phi}\overline{\Omega} +\tau_y\Big]\\ \ddot{\psi} = \frac{1}{I_z}\Big[(I_z - I_y)\dot{\theta}\dot{\phi} +\tau_z\Big] \end{array} \right. \tag{3.13}
$$

其中，  $\overline{\Omega} = - (\overline{\omega}_1 - \overline{\omega}_2 + \overline{\omega}_3 - \overline{\omega}_4 - \overline{\omega}_5 + \overline{\omega}_6)$ ，  $\overline{\omega}_k$  为编号  $k$  的无刷电机的转速，  $I_{r}$  为电机转子及螺旋桨关于转轴的转动惯量。

# 3.3 4R型机械臂运动学建模

机械臂运动学分析关节空间及笛卡尔空间下各连杆的位形、线运动及角运动特性，旨在建立末端执行器位姿与各关节变量运动参数的转换关系。

# 3.3.1 机械臂改进D-H法参数定义

参照改进Denavit- Hartenberg(D- H)法则建立机械臂各连杆坐标系并定义相应连杆参数[90]。令固连于  $\Sigma_{b}$  的机械臂基座编号0，末端执行器所在连杆编号为n，各活动连杆依次编号  $i(i = 1,\dots ,n)$ ，本文机械臂构型  $\mathfrak{n} = 5$  。连杆  $i - 1$  ，  $i$  的公共旋转轴定义为关节轴  $i$  。

# 3.3.1.1连杆坐标系  $\Sigma_{l_i}$ $(O_{l_i} - X_{l_i}Y_{l_i}Z_{l_i})$

基于改进D- H法则的连杆坐标系建立在各连杆靠近基座的近端。为与无人机参数协调，  $\Sigma_{l_0}$  与  $\Sigma_{b}$  重合，活动连杆  $i$  的坐标系定义如下：

原点  $O_{l_i}$  ：关节轴  $i$  ，  $i + 1$  公垂线与关节轴  $i$  的交点，若关节轴  $i$  ，  $i + 1$  相交，则交点设为原点；

$X_{l_i}$  轴：沿关节轴公垂线指向关节轴  $i + 1$  方向为正，若关节轴  $i$  ，  $i + 1$  相交则垂直于两关节轴所在平面；

$Y_{l_i}$  轴：垂直于  $X_{l_i}$  轴及关节轴  $i$  ，初始状态沿机体右/上方向为正；

$Z_{l_i}$  轴：沿关节轴  $i$  按右手法则确定。

本文所用4R型机械臂各连杆坐标系如图3.3所示

# 3.3.1.2 机械臂连杆D-H参数

机械臂连杆各参数定义如下：

$a_{i - 1}$  ：连杆长度，即关节轴  $i - 1$  ，  $i$  间的公垂线之长；

$\alpha_{i - 1}$  ：连杆扭转角，即绕公垂线  $a_{i - 1}$  （指向轴  $i$  ）将轴  $i - 1$  逆时针旋至平行于轴  $i$  方向的夹角；

$d_{i}$  ：连杆偏距，即  $\alpha_{i - 1}$  ，  $\alpha_{i}$  与轴  $i$  交点的间距；

$\theta_{i}$  ：关节角，即绕轴  $i$  将  $a_{i - 1}$  逆时针旋至平行于  $a_{i}$  方向的夹角。

![](images/8e161c41ada6b163b6cddbce8a5a801ed2f1a195766b4cc96becaaddc4f2895f.jpg)  
图3.34R型机械臂连杆坐标系定义示意图

对于本文中的4R型机械臂，关节角  $\theta_{i}$  为变量，其余参数定常。机械臂连杆改进D- H参数如表3.1所示。

表3.14R型机械臂连杆改进D-H参数表  

<table><tr><td>连杆i</td><td>ai-1</td><td>ai-1</td><td>di</td><td>θi</td></tr><tr><td>1</td><td>0</td><td>0</td><td>L1=0.172m</td><td>θ1</td></tr><tr><td>2</td><td>-90°</td><td>0</td><td>0</td><td>θ2</td></tr><tr><td>3</td><td>0</td><td>L2=0.096m</td><td>0</td><td>θ3</td></tr><tr><td>4</td><td>0</td><td>L3=0.917m</td><td>0</td><td>θ4</td></tr><tr><td>5</td><td>0</td><td>L4=0.160m</td><td>0</td><td>0</td></tr></table>

为与机体系统一，基坐标系原点未按一般D- H法则惯例建立在关节轴1、2的交点处，  $a_{4} = L_{4} = L_{4}^{x0} + 71\mathrm{mm} = 160\mathrm{mm}$  为从  $\Sigma_{l_4}$  系到  $\Sigma_{e}$  系沿  $X_{l_4}$  轴方向的偏移。

# 3.3.1.3 齐次坐标变换

结合旋转与平移变换的齐次坐标变换是机器人学与机器视觉通用的位姿变换表示方式。设  $R_{A}^{B}$  、  $P_{A}^{B}$  分别表示从坐标系B到坐标系A的旋转变换和平移变换，则从A系到B系的坐标齐次变换为：

$$
{}^{B}T_{A} = \left[ \begin{array}{cc}R_{A}^{B} & P_{A}^{B} \\ \pmb{O}_{1\times 3} & 1 \end{array} \right] \tag{3.14}
$$

代入3.3.1.2节中的连杆D- H参数可得：

$$
{}^{i - 1}T_{i} = \left[ \begin{array}{cccc}\cos \theta_{i} & -\sin \theta_{i} & 0 & a_{i - 1} \\ \cos \alpha_{i - 1}\sin \theta_{i} & \cos \alpha_{i - 1}\cos \theta_{i} & -\sin \alpha_{i - 1} & -\sin \alpha_{i - 1}\cdot d_{i} \\ \sin \alpha_{i - 1}\sin \theta_{i} & \sin \alpha_{i - 1}\sin \theta_{i} & \cos \alpha_{i - 1} & \cos \alpha_{i - 1}\cdot d_{i} \\ 0 & 0 & 0 & 1 \end{array} \right] \tag{3.15}
$$

注意从  $\Sigma_{l_4}$  系到  $\Sigma_{b}$  系存在沿  $Y_{14}$  轴方向的偏移  $L_{4}^{y} = 0.022m$  ，未表述为D- H参数（可设定固定关节角  $\theta_{5}$  表示），  $\pmb{P}_{e}^{4} = \left[L_{4}L_{4}^{y}0\right]^{\mathrm{T}}$  。令  ${}^{0}T_{1} = {}^{b}T_{1}$  ，  ${}^{4}T_{5} = {}^{4}T_{e}$  ，则从基坐标系  $\Sigma_{b}$  到末端工具系  $\Sigma_{e}$  的齐次变换为：

$$
{}^{b}T_{e} = \prod_{i = 1}^{5}{}^{i - 1}T_{i} \tag{3.16}
$$

则从世界系  $\Sigma_{w}$  到末端工具系  $\Sigma_{e}$  的完整齐次变换为：

$$
{}^{w}T_{e} = {}^{w}T_{d}\cdot{}^{d}T_{b}\cdot \prod_{i = 1}^{5}{}^{i - 1}T_{i} \tag{3.17}
$$

上述齐次变换完整形式详见附录。

由于机械臂固连于无人机机体系原点，可以通过无人机的协同控制使机械臂末端执行器具有更自由的运动范围。在本文中，为简化控制系统设计，仍假设无人机悬停于固定点，即分析机械臂在固定基座下的工作空间。

# 3.3.2 机械臂运动学模型

令  $\pmb {\Theta} = [\theta_{1}\theta_{2}\dots \theta_{n}]^{\mathrm{T}}\in \mathbb{R}^{n}$  表示机械臂各关节角的集合。

设  $\pmb{p}_{l_i}$  表示连杆  $l_{i}$  质心在  $\Sigma_{w}$  系下的位置，  $\pmb{p}_{l_i}^b$  表示连杆  $l_{i}$  质心在  $\Sigma_{b}$  系下的位置； $\omega_{l_i}$  表示连杆  $l_{i}$  在  $\Sigma_{w}$  系下的绝对角速度，  $\omega_{l_i}^b$  表示连杆  $l_{i}$  在  $\Sigma_{b}$  系下的相对角速度，则

$$
\begin{array}{r}\pmb {p}_l_i = \pmb {p}_d + R_b^w\pmb {p}_l_i^b \\ \pmb {\omega}_l_i = \pmb {\omega}_d^w +R_b^w\pmb {\omega}_l_i^b \end{array} \tag{3.19}
$$

雅可比矩阵用以联系末端执行器在笛卡尔空间下的速度与各关节速度, 也是联系不同坐标系下力和速度关系的枢纽。此外, 也用于映射不同坐标系间的力旋量 (包含力和力矩的矢量) [91]。

设  $J_{Pi}$ ,  $J_{Oi}$  分别为从关节空间到笛卡尔空间的平移与旋转雅克比矩阵, 则:

$$
\dot{\pmb{p}}_{l_{i}}^{b} = \sum_{k = 1}^{i}\frac{\partial\pmb{p}_{l_{i}}^{b}}{\partial\theta_{k}}\dot{\theta}_{k} = \pmb{J}_{P_{i}}\dot{\pmb{\Theta}} \tag{3.20}
$$

$$
\pmb{\omega}_{l_{i}}^{b} = \sum_{k = 1}^{i}J_{O_{k}}^{l_{i}}\dot{\theta}_{k} = \pmb{J}_{O_{i}}\dot{\pmb{\Theta}} \tag{3.21}
$$

雅克比矩阵具有如下形式:

$$
\pmb{J}_{l_{i}} = \left[ \begin{array}{c}\pmb{J}_{P_{i}} \\ \pmb{J}_{O_{i}} \end{array} \right] = \left[ \begin{array}{ccc}\pmb{e}_{z_{0}} \times \left(\pmb{p}_{l_{i}}^{b} - \pmb{p}_{0}^{b}\right) & \dots & \pmb{e}_{z_{i - 1}} \times \left(\pmb{p}_{l_{i}}^{b} - \pmb{p}_{i - 1}^{b}\right) \\ \pmb{e}_{z_{0}} & \dots & \pmb{e}_{z_{i - 1}} \end{array} \right] \tag{3.22}
$$

由于时变旋转矩阵满足  $\dot{R} = S(\omega)R$ , 综合上式, 可得:

$$
\dot{\pmb{p}}_{l_{i}} = \dot{\pmb{p}}_{d} - S\left(\pmb{R}_{b}^{w}\pmb{p}_{l_{i}}^{b}\right)\pmb{\omega}_{d}^{w} + \pmb{R}_{b}^{w}\pmb{J}_{P_{i}}\dot{\pmb{\Theta}} \tag{3.23}
$$

$$
\pmb{\omega}_{l_{i}} = \pmb{\omega}_{d}^{w} + \pmb{R}_{b}^{w}\pmb{J}_{O_{i}}\dot{\pmb{\Theta}} \tag{3.24}
$$

$S(\bullet)$  为角速度矩阵算子, 对角速度矢量  $\pmb {\omega} = [\omega_{x} \omega_{y} \omega_{z}]^{\mathrm{T}}$ , 有  $\pmb {\omega} \times \pmb {\nu} = \pmb {S}(\pmb {\omega}) \cdot \pmb{\nu}$

$$
S(\pmb {\omega}) = \left[ \begin{array}{ccc}0 & -\omega_{z} & \omega_{y} \\ \omega_{z} & 0 & -\omega_{x} \\ -\omega_{y} & \omega_{x} & 0 \end{array} \right] \tag{3.25}
$$

# 3.4 系统拉格朗日动力学建模

拉格朗日方程从能量关系出发推导系统各广义坐标运动参数与所受广义力间的关系[92]。在动力学分析时只需考虑主动力与摩擦力, 当广义坐标设为相对坐标时, 计算系统的绝对动能不需考虑牵连惯性力与科氏惯性力[93]。本节在世界系  $\Sigma_{w}$  下推导无人机- 机械臂复合系统的拉格朗日动力学方程。

在运动学上, 无人机可等价为具有 3 个移动关节与一个球腕关节的 6DOF 空间机器人的末端执行器。令系统广义坐标为  $\pmb{q} = \left[\pmb{p}_{d}^{\mathrm{T}} \pmb{\Theta}^{\mathrm{T}} \pmb{\Theta}^{\mathrm{T}}\right]^{\mathrm{T}} \in \mathbb{R}^{6 + n}$ , 易得

$$
\left\{ \begin{array}{l}\dot{\pmb{p}}_{d} = [E_{3} O_{3 \times (3 + n)}] \cdot \dot{\pmb{q}} \\ \dot{\pmb{\Theta}} = [O_{3} E_{3} O_{3 \times n}] \cdot \dot{\pmb{q}} \\ \dot{\pmb{\Theta}} = [O_{n \times 6} E_{n \times n}] \cdot \dot{\pmb{q}} \end{array} \right. \tag{3.26}
$$

其中， $E$ 、 $O$  分别表示角标对应维度的单位矩阵和零矩阵。代入(3.11)式有：

$$
\pmb{\omega}_{d}^{w} = [O_{3}R_{\epsilon}^{w}O_{3\times n}]\cdot \dot{\pmb{q}} \tag{3.27}
$$

对于旋转矩阵  $R$  及矢量  $\nu$ ，有  $RS(\nu)R^{\mathrm{T}} = S(R\nu)$  成立，故(3.23)式可化为：

$$
\dot{\pmb{p}}_i = \dot{\pmb{p}}_d - \pmb {R}_b^w S\left(\pmb {p}_l^b\right)\pmb {R}_w^b\pmb {\omega}_d^w +\pmb {R}_b^w\pmb {J}_P_i\dot{\pmb{\omega}} \tag{3.28}
$$

将(3.26)代入上式及(3.24)式，易得：

$$
\dot{\pmb{p}}_{l_i} = [E_3 - \pmb {R}_b^w S\left(\pmb {p}_l_i^b\right)\pmb {R}_\epsilon^b\pmb {R}_b^w J_{P_i}]\cdot \dot{\pmb{q}} \tag{3.29}
$$

$$
\pmb{\omega}_{l_i} = \left[O_3R_{\epsilon}^w R_b^w J_{O_i}\right]\cdot \dot{\pmb{q}} \tag{3.30}
$$

对于完整系统，紧凑形式的拉格朗日方程为：

$$
\frac{d}{dt}\left(\frac{\partial L}{\partial\dot{\pmb{q}}}\right) - \frac{\partial L}{\partial\pmb{q}} = \pmb{Q} \tag{3.31}
$$

其中，拉格朗日函数  $L(\pmb {q},\dot{\pmb{q}}) = T(\pmb {q},\dot{\pmb{q}}) - U(\pmb {q})$  为系统动能与势能之差（动势）， $\pmb{Q}$  为对应各广义坐标的非保守广义力矢量。

# 3.4.1 动能推导

系统的总动能为无人机与各连杆及关节舵机的动能之和：

$$
T = T_{d} + \sum_{i = 1}^{n}(T_{l_{i}} + T_{m_{i}}) \tag{3.32}
$$

为简化动力学模型，后续推导忽略机械臂舵机内部电机转速及齿轮传动影响，将舵机惯性参数归并至其固连连杆的惯性参数。

设  $m_{d}$  为无人机质量， $\pmb {I}_d^b$  为定义于  $\Sigma_{b}$  系下无人机的惯性张量（定常）； $\pmb {I}_d^w = \pmb {R}_b^w\pmb {I}_d^b\pmb {R}_w^b$  为定义于  $\Sigma_{b}$  原点的  $\Sigma_{w}$  平行坐标系（记为  $\Sigma_{w_b}$  ）下无人机的惯性张量（随无人机姿态而变）；则由柯尼希定理（Konig's Theorem），易得在  $\Sigma_{w}$  系下无人机的动能：

$$
\begin{array}{l}T_d = \frac{1}{2} m_d\dot{p}_d^{\mathrm{T}}\dot{p}_d + \frac{1}{2}\big(\pmb {\omega}_d^w\big)^{\mathrm{T}}\pmb {R}_b^w\pmb {I}_d^b\pmb {R}_w^b\pmb {\omega}_d^w\\ \displaystyle = \frac{1}{2} m_d\dot{p}_d^{\mathrm{T}}\dot{p}_d + \frac{1}{2}\big(\pmb {\omega}_d^b\big)^{\mathrm{T}}\pmb {I}_d^b\pmb {\omega}_d^b \end{array} \tag{3.33}
$$

设  $m_{l_i}$  为连杆  $l_i$  质量， $\pmb {I}_l_i^i$  为定义于连杆坐标系  $\Sigma_{i}$  下连杆  $l_i$  的惯性张量（定常）； $\pmb {I}_l^w_i$  为定义于连杆  $l_i$  质心的  $\Sigma_{w}$  平行坐标系（记为  $\Sigma_{w_i}$  ）连杆  $l_i$  的惯性张量（随机械臂位形而变）； $\pmb {R}_l^w_i$  为从  $\Sigma_{i}$  到  $\Sigma_{w_i}$  的旋转矩阵， $\pmb {I}_{ti}$  为应用惯性张量平行轴定理的

附加矩阵，则  $\pmb{I}_{l_{i}}^{w_{i}} = \pmb{R}_{l_{i}}^{w_{i}}\pmb{I}_{l_{i}}^{\mathrm{T}}\pmb{R}_{w_{i}}^{l} + \pmb{I}_{l_{i}}$  ，易得在  $\Sigma_{w}$  下各连杆的动能：

$$
T_{l_{i}} = \frac{1}{2} m_{l_{i}}\dot{p}_{l_{i}}^{\mathrm{T}}\dot{p}_{l_{i}} + \frac{1}{2}\pmb{\omega}_{l_{i}}^{\mathrm{T}}\pmb{I}_{l_{i}}^{w_{i}}\pmb{\omega}_{l_{i}} \tag{3.34}
$$

根据3.3.1节的运动学关系，通过雅克比矩阵将系统动能转化为关于广义坐标的函数，结合以上代入  $T$  可得二次型的动能表示：

$$
T = \frac{1}{2}\dot{q}^{\mathrm{T}}M(\pmb {q})\dot{\pmb{q}} \tag{3.35}
$$

其中，  $M(\pmb {q})\in \mathbb{R}^{(6 + n)\times (6 + n)}$  为对称正定的惯性矩阵。

$$
M(\pmb {q}) = \left[ \begin{array}{lll}M_{11} & M_{12} & M_{13}\\ M_{21} & M_{22} & M_{23}\\ M_{31} & M_{32} & M_{33} \end{array} \right] \tag{3.36}
$$

各子矩阵具有如下形式

$$
\begin{array}{r l}&{\left\{M_{11}=\left(m_{d}+\sum_{i=1}^{n}m_{i}\right)E_{3}\right.}\\ &{\left.\left\{M_{12}=M_{21}^{T}=-\sum_{i=1}^{n}m_{i}R_{b}^{w}S\left(p_{i}^{b}\right)R_{\epsilon}^{b}\right.\right.}\\ &{\left.\left\{M_{13}=M_{31}^{T}=\sum_{i=1}^{n}m_{i}R_{b}^{w}J_{P}\right.\right.}\\ &{\left.\left\{M_{22}=R_{b}^{\epsilon}\left(I_{d}^{b}+\sum_{i=1}^{n}m_{i}\left(\left(S\left(p_{i}^{b}\right)\right)^{\mathrm{T}}S\left(p_{i}^{b}\right)+I_{i}^{b}\right)\right)R_{\epsilon}^{b}\right.\right.}\\ &{\left.\left\{M_{23}=M_{32}^{T}=\sum_{i=1}^{n}\left(-m_{i}R_{b}^{\epsilon}\left(S\left(p_{i}^{b}\right)\right)^{\mathrm{T}}J_{P_{i}}+R_{b}^{\epsilon}I_{i}^{b}J_{O_{i}}\right)\right.\right.}\\ &{\left.\left\{M_{33}=\sum_{i=1}^{n}\left(m_{i}J_{P}^{\mathrm{T}}J_{P_{i}}+J_{O_{i}}^{\mathrm{T}}I_{i}^{b}J_{O_{i}}\right)\right.\right.}\end{array} \tag{3.37}
$$

# 3.4.2势能推导

系统的总势能是无人机与各连杆及舵机的势能之和：

$$
\begin{array}{l}{U = U_{d} + \sum_{i = 1}^{n}U_{i}}\\ {= m_{d}\pmb{g}_{w}^{\mathrm{T}}\pmb{p}_{d} + \sum_{i = 1}^{n}m_{i}\pmb{g}_{w}^{\mathrm{T}}(\pmb{p}_{d} + \pmb{R}_{b}^{w}\pmb{p}_{l_{i}}^{b})} \end{array} \tag{3.38}
$$

$\pmb{g}_{w} = [0\mathrm{~0~}g]^{\mathrm{T}}$  为定义于  $\Sigma_{w}$  系下的重力加速度矢量。

易知系统势能与  $\dot{q}$  无关。

# 3.4.3 动力学模型

将动能(3.35)、势能(3.38)分别代入拉格朗日方程令  $C(q,\dot{q})$  表式科氏力与离心力耦合的科氏项：

$$
C(\pmb {q},\dot{\pmb{q}}) = \pmb {M} - \frac{1}{2}\dot{\pmb{q}}^{\mathrm{T}}\frac{\partial\pmb{M}}{\partial\pmb{q}} \tag{3.39}
$$

重力项  $G(\pmb {q})$  为势能对广义坐标的偏导（雅克比）：

$$
G(\pmb {q}) = \frac{\partial U(\pmb{q})}{\partial\pmb{q}} \tag{3.40}
$$

则用包含无人机质心位姿与机械臂各关节角度的广义坐标表示的系统动力学方程可表示为紧凑形式：

$$
M(\pmb {q})\ddot{\pmb{q}} +C(\pmb {q},\dot{\pmb{q}})\dot{\pmb{q}} +G(\pmb {q}) = \pmb{Q} \tag{3.41}
$$

惯性项  $M(\pmb {q}) = \{m_{ij}\}$  在数学上是满秩/非奇异的，对应于流形  $M^n$  上的黎曼度量形式。故科氏项  $C(\pmb {q},\dot{\pmb{q}})$  各分量可由第一型克氏符（Christoffel symbols）求解[46,92]：

$$
\begin{array}{l}{c_{ij} = \sum_{k = 1}^{6 + n}c_{ijk}\dot{q}_k}\\ {= \sum_{k = 1}^{6 + n}\frac{1}{2}\Bigg(\frac{\partial M_{ij}}{\partial q_k} +\frac{\partial M_{ik}}{\partial q_j} -\frac{\partial M_{jk}}{\partial q_i}\Bigg)\dot{q}_k} \end{array} \tag{3.42}
$$

其中包含离心惯性力及科氏惯性力，具体形式较复杂，此处略。

重力项可由(3.37)式推导展开。

广义力  $\pmb{Q}$  由电机- 螺旋桨产生的升力、反作用力矩、陀螺力矩、气动阻力及阻尼力矩、关节驱动力矩与摩擦力矩等组成，各项定义如下：

(1)升力  $\pmb{T}$

无刷直流电机带动定距螺旋桨绕转轴高速旋转，产生转轴向上的升力，一般可忽略转轴与机体轴线的偏移，认为各轴升力垂直于机身平面向上。

(2)反作用力矩  $M_{r}$

根据对质心的动量矩定理，电机- 螺旋桨的转速变化也会对机体施加反向的力矩；同时空气对螺旋桨的阻力也会对机体施加与转向相反的力矩。

(3)陀螺力矩  $M_{g}$

设机体系下电机  $\dot{k}$  的转速矢量为  $\overline{\pmb{\omega}}_k$ ，由 Resal 定理可知，刚体高速自转时转

轴具有定向性，可抵抗小幅的干扰外力矩作用。在电机转子带动螺旋桨高速旋转并发生进动时，会对刚体系统产生反作用的陀螺力矩。机体的角速度  $\omega_{d}$  可视为电机的进度角速度，显然  $\left\| \overline{\omega}_k\right\| \gg \left\| \omega_d\right\|$ ，由陀螺近似理论及进动特性，各电机及其螺旋桨产生的陀螺力矩可表示为：

$$
M_{g} = \sum_{k = 1}^{6}I_{r}\overline{\omega}_{k}\times \omega_{d}^{b} \tag{3.43}
$$

(4)气动阻力  $\pmb {F}_d$  、阻尼力矩  $M_{d}$

相较于一般固定翼飞行器，多旋翼无人机的几何外形较为复杂，难以精确描述气动特性。本文假定无人机几何外形各向对称，采用如下简化模型计算对  $\Sigma_{d}$  系的气动阻力  $\pmb {F}_d = \left[F_{d_x}F_{d_y}F_{d_z}\right]^{\mathrm{T}}$  与气动阻尼力矩  $\pmb {M}_d = \left[M_{d_x}M_{d_y}M_{d_z}\right]^{\mathrm{T}}$

$$
F_{d_i} = K_d\cdot \left(\nu_d^i\right)^2,\qquad i = x,y,z \tag{3.44}
$$

$$
M_{d_i} = K_{dm}\cdot \left(\omega_i^d\right)^2,\qquad i = x,y,z \tag{3.45}
$$

式中  $K_{d}$ ， $K_{dm}$  分别为阻力系数与阻尼力矩系数。

为简化后续控制系统的复杂度，忽略机械臂关节摩擦力矩等系统内部阻尼项。

上文中(3.41)式为广义坐标到广义力的逆解形式，可通过给定的无人机- 机械臂位形状态求解机体及各关节所受的力与力矩。转化为求解加速度的正解形式如下：

$$
\ddot{q} = M^{-1}(q)\cdot \left[Q - C(q,\dot{q})\dot{q} -G(q)\right] \tag{3.46}
$$

由上式正向动力学可以在仿真中根据施加的力与力矩数值求解系统的运动学状态。

# 3.5 本章小结

本章建立了系统基本坐标系并推导了无人机与机械臂的运动学及动力学方程。针对所选用的无人机构型建立了不考虑扰动与机械臂构型变化的无人机简化动力学模型。针对所设计的4R型串联开链机械臂，依据改进D- H法则定义了各连杆坐标系及相应连杆参数，进而研究其末端执行器位姿与各关节参数的运动学关系。基于拉格朗日方程推导了无人机- 机械臂复合系统的完整动力学模型。

# 第四章 系统自适应控制与运动规划方法研究

针对无人机与机械臂动力学的耦合问题，在分析主流无人机飞控的串级控制逻辑基础上，基于分离式控制策略分别设计六旋翼无人机的自适应控制系统与机械臂的轨迹规划方法。考虑无人机悬停时的漂移与扰动，采用滚动时域策略优化机械臂在关节空间下的轨迹规划问题。对所提出的控制与运动规划方法进行相应的仿真分析。

# 4.1 基于UDE-GS的六旋翼无人机控制方案

主流无人机开源飞控系统如ArduPilot、PX4等均基于串级PID的控制逻辑设计控制器，经过了广泛的工程实践考验。但针对本文中带多自由机械臂的可变构型无人机系统，传统串级PID控制律难以有效适应系统惯性参数变化带来的额外控制挑战。根据与系统参考模型的偏差，可以设计合适的不确定性与扰动观测器(Uncertainty and Disturbance Estimator, UDE)，并采用调度增益方法(Gain Scheduling, GS)根据机械臂构型的变化实时修正控制参数。基于此提出采用惯性参数补偿的UDE- GS自适应控制方案。

![](images/7c73cf7d891302a2771463e2b4d6b0d1574d6869e5003c995b85b76ac6574a3d.jpg)  
图4.1 HEXA-X型无人机旋翼编号与转向示意图

如图4.1所示，六旋翼无人机各相邻旋翼转向相反，CW、CCW分别表示顺时针与逆时针。参照PX4飞控HEXA- X标准定义六旋翼各电机编号。其中1、3、6号电机转向为逆时针，2、4、5号电机转向为顺时针。各电机- 螺旋桨对机体施加的反作用力矩与转向相反。

# 4.1.1六旋翼无人机基本控制原理

六旋翼无人机根据期望位置、姿态生成控制指令，通过调整各电机转速改变对应螺旋桨升力。由总升力的竖直分量与重力之差控制无人机高度，利用各轴升力的差异产生对质心的力矩以改变机体姿态（滚转、俯仰），进而产生沿某一方向的推力分量实现沿该方向的平移运动。注意偏航运动是通过各电机- 螺旋桨不同

转向形成的净反作用力矩完成的[1,94]。

# 4.1.1.1无人机串级PID控制逻辑

PID控制可视作频域系统上的滤波器，分为比例(Proportional)、积分(Integral)、微分(Derivative)三个环节。设  $x$ ， $x^{*}$  为某一状态量（如高度、俯仰角等）及其期望值， $e_x = x^* - x$  为跟踪误差， $u_{x}$  为控制输出， $K_{p}$ 、 $K_{i}$ 、 $K_{d}$  分别为比例、积分、微分环节的增益系数，则连续形式的PID控制律可表示为：

$$
u_{x} = K_{p}e_{x} + K_{i}\int_{0}^{t}e_{x}dt + K_{d}\dot{e}_{x} \tag{4.1}
$$

串级PID控制作为多旋翼无人机底层控制系统的基础，分为位置、姿态、控制分配与电机控制四个层级[1]。

位置环控制器为外环，根据  $\Sigma_{w}$  系下无人机的期望位置  $\pmb{p}_{d}^{*}$  与当前位置  $\pmb{p}_{d}$  之差求解沿世界系  $X_{w}$ 、 $Y_{w}$ 、 $Z_{w}$  三轴的期望速度，进而与当前速度作差由PID控制器求解期望驱动力及其欧氏距离（总驱动力），并根据期望偏航角方向转化为期望欧拉角；注意对于高度控制，系统的重力一般可视为定常扰动，需增加适当的前馈项进行补偿（使用较大增益或仅依靠PI控制可能超调且所需调节时间较长）。

姿态环控制器为内环，首先根据期望欧拉角与当前欧拉角之差进行比例控制求解期望欧拉角速度，进而与当前欧拉角速度作差由PID控制器求解期沿机体系各轴方向的期望力矩。

注意以上各环节求解的控制量均需增加限幅函数。

![](images/e9509eb2dd4a99d62e24c8b4bd0f5a1d12388b791cb7b3bcd31b921ba15c1efd.jpg)  
图4.2旋翼无人机串级PID闭环控制框架图

# 4.1.1.2动力驱动模型

# (1)ESC模型

电机的期望转速指令以PWM信号传递给电子调速器（Electronic Speed Controller, ESC），进而驱动无刷直流电机的转子带动螺旋桨以特定转速旋转。本

文在仿真中构建如图 4.3 所示的简化 ESC 模型。

![](images/b2ff2b984ad8c50348555f2b005d191b96c155ad5ed3fd2bd923634d17cc9427.jpg)  
图4.3无人机ESC仿真模型

# (2）电机模型

无刷直流电机的动态模型可表示为从油门指令到实际转速的映射：

$$
\overline{\omega} (s) = \frac{e^{-\tau s}}{T_m s + 1} (C_R \sigma + \overline{\omega}_b) \tag{4.2}
$$

其中  $\sigma \in [0, 1]$  为油门指令， $T_m$  为达到稳定转速的响应时间， $C_R$  及  $\overline{\omega}_b$  为常参数。

# (3）驱动力与反作用力矩

设  $C_T, C_M$  分别为螺旋桨的拉力系数与转矩系数，单位： $\mathrm{N / (rad / s)^2}$ ， $\mathrm{N\cdot m / (rad / s)^2}$ ，由叶素理论按下述方法估算[1]：

已知双叶螺旋桨直径  $D_p$ ，螺距  $H_p$ ，展弦比  $A$ ，零升迎角  $\alpha_0$ 。当地空气密度  $\rho$  一般参考标准大气表插值得到（仿真中  $\rho \equiv 1.293 \mathrm{~kg} / \mathrm{m}^3$ ），则阻力系数可表示为：

$$
C_D = C_{D_0} + \frac{\pi A K_0^2}{e} \left(\frac{\epsilon \tan^{-1} \frac{H_p}{\pi D_p} - \alpha_0}{\pi A + K_0}\right)^2 \tag{4.3}
$$

其中  $C_{D_0}$  为零升阻力系数， $K_0 \approx 6.11$ ， $\epsilon$  为下洗效应的校正因子， $e$  为效率因子。

当无人机做小幅度机动或悬停时，对姿态欧拉角采用小角度假设，认为驱动力与升力近似相等，则

$$
\left\{ \begin{array}{l} k_T = \frac{1}{2} \pi^3 \lambda \zeta^2 K_0 \frac{\epsilon \tan^{-1} \frac{H_p}{\pi D_p} - \alpha_0}{\pi A + K_0} \\ k_M = \frac{1}{8A} \pi^2 C_D \zeta^2 \lambda B_p^2 \end{array} \right. \tag{4.4}
$$

其中  $\lambda$  为桨叶面积修正系数， $\zeta$  一般取值0.5附近。

$$
\left\{ \begin{array}{l} C_{T} = \frac{1}{4\pi^{2}} k_{T}\rho D_{p}^{4} \\ C_{M} = \frac{1}{4\pi^{2}} k_{M}\rho D_{p}^{5} \end{array} \right. \tag{4.5}
$$

参考Flyeval平台评估校核参数[95]（以S900构型为基准），可估算 $C_{T_{est}}^{*} = 4.696\times 10^{- 5}$  ，  $C_{M_{est}}^{*} = 8.854\times 10^{- 7}$  。

对编号为  $k$  的电机与螺旋桨，令  $\sigma_{k}$  表示其转向正负，则：

$$
\sigma_{k} = \left\{ \begin{array}{ll} 1 & k = 1,3,6 \\ -1 & k = 2,4,5 \end{array} \right. \tag{4.6}
$$

其对无人机的驱动力与反作用力矩分别为：

$$
\left\{ \begin{array}{l} T_{k} = C_{T}\overline{\omega}_{k}^{2} \\ M_{k} = C_{M}\sigma_{k}\overline{\omega}_{k}^{2} \end{array} \right. \tag{4.7}
$$

# 4.1.1.3六旋翼无人机的控制分配

根据上节所述由位置环求解的期望总驱动力及姿态环求解的期望力矩，根据控制分配矩阵求解无人机各电机及螺旋桨的期望转速。

设  $d$  为无人机半轴距（电机轴线与  $Z_{d}$  轴距离），当忽略机臂上反角时，电机- 螺旋桨对六旋翼无人机的总升力与各向力矩的控制分配方程为：

$$
\left[ \begin{array}{c}\tau_{x}\\ \tau_{y}\\ \tau_{z}\\ T \end{array} \right] = \left[ \begin{array}{cccccc} - C_{T}d & C_{T}d & \frac{1}{2} C_{T}d & -\frac{1}{2} C_{T}d & -\frac{1}{2} C_{T}d & \frac{1}{2} C_{T}d\\ 0 & 0 & \frac{\sqrt{3}}{2} C_{T}d & -\frac{\sqrt{3}}{2} C_{T}d & \frac{\sqrt{3}}{2} C_{T}d & -\frac{\sqrt{3}}{2} C_{T}d\\ C_{M} & -C_{M} & C_{M} & -C_{M} & -C_{M} & C_{M}\\ C_{T} & C_{T} & C_{T} & C_{T} & C_{T} & C_{T} \end{array} \right]\cdot \left[ \begin{array}{c}\overline{\omega}_{1}^{2}\\ \overline{\omega}_{2}^{2}\\ \overline{\omega}_{3}^{2}\\ \overline{\omega}_{4}^{2}\\ \overline{\omega}_{5}^{2}\\ \overline{\omega}_{6}^{2} \end{array} \right] \tag{4.8}
$$

方程右侧第一项即HEXA- X型六旋翼的控制分配矩阵  $M_{6}$  。当已知期望力与力矩时，需通过对  $M_{6}$  矩阵求M- P广义逆反解期望的各电机的期望转速指令：

$$
M_{6}^{+} = M_{6}^{\mathrm{T}}\left(M_{6}\cdot M_{6}^{\mathrm{T}}\right)^{-1} \tag{4.9}
$$

当  $C_{T}$  ，  $C_{M}$  ，  $d$  等参数无法精确获取时，需对PID参数进行额外调试。为更好地适应无人机的构型变化，将上述不确定参数从控制分配矩阵中分离。令 $P_{a} = diag(C_{T}d,C_{T}d,C_{M},C_{T})$  ，则

$$
M_{6}^{+}\left(C_{T},C_{M},d\right) = M_{6}^{+}\left(1,1,1\right)\cdot P_{a}^{-1} \tag{4.10}
$$

易得：

$$
M_{6}^{+}(1,1,1) = \frac{1}{6}\left[ \begin{array}{cccccc} - 2 & 2 & 1 & -1 & -1 & 1\\ 0 & 0 & -\sqrt{3} & \sqrt{3} & -\sqrt{3} & \sqrt{3}\\ 1 & -1 & 1 & -1 & -1 & 1\\ 1 & 1 & 1 & 1 & 1 & 1 \end{array} \right] \tag{4.11}
$$

# 4.1.1.3 无人机串级PID仿真控制模型

在Simulink中搭建如图4.4所示的串级PID系统。姿态环以滚转角控制为例，如图4.5所示；位置环以高度控制为例，如图4.6所示。各环节参数在封装的PID模块中调节。

![](images/bdf4cf7382b7c09aef92605cd4d6d16731a231735f22dc8efd50e19ffbf458ef.jpg)  
图4.4 Simulink下无人机串级PID控制系统架构

![](images/7bf2354c6c24624011a65874959ccf9962a519f78beed29720c56a4720921f2f.jpg)  
图4.5 滚转角PID控制器

![](images/20225967fb2fca76510f133e499b1aef370d655141712c1aee41557002d76ddf.jpg)  
图4.6 高度PID控制器

# 4.1.2 姿态环UDE控制律设计

UDE 控制是基于时延控制器 (Time Delay Controller, TDC) 改进的一类新型抗扰控制方法，含有比例、积分等环节的特征。UDE 控制基于如下基本思想：在频域内，模型的不确定性和外部扰动形成的信号可以用合适带宽的滤波器来近似。其核心是基于卷积构造某惯性环节截止频率下的扰动估计器[58]。

# 4.1.2.1 基于 UDE 的姿态环控制原理

本文在仿真中尝试在姿态环控制引入 UDE 项，以改善因模型动态变化与外界干扰造成的控制误差。基于 UDE 的姿态环控制需将滚转、俯仰、偏航三通道解耦为独立的控制子系统[59]。

以滚转通道为例，控制量为期望的滚转力矩，可表示为标准控制项与 UDE 项之和与  $X$  轴转动惯量  $I_{x}$  的乘积：

$$
u_{\phi} = I_{x}\left(\underbrace{\ddot{\phi}^{*} + K_{p}e_{\phi} + K_{d}\dot{e}_{\phi}}_{\text{标准控制项}} + \underbrace{\frac{1}{T_{\phi}}\left(K_{d}e_{\phi} + K_{p}\int_{0}^{t}e_{\phi}dt + \dot{e}_{\phi}\right)}_{\text{UDE项}}\right) \tag{4.12}
$$

具体推导如下：

令  $\phi^{*}$  为期望滚转角信号，跟踪误差为  $\epsilon_{\phi}$ ，控制输入为对应欧拉角的期望力矩  $u_{\phi} = \tau_{x}$ 。

将系统欧拉动力学方程(3.13)改写为状态方程形式并提取公因式  $\frac{1}{I_{x}}$ ：

$$
\ddot{\phi} = \frac{1}{I_{x}}\left(\zeta_{\phi} + u_{\phi}\right) \tag{4.13}
$$

其中，  $\zeta_{\phi}$  为关于滚转角的集成不确定项，  $d_{x}$  为扰动力矩引起的对  $X$  轴角加速度：

$$
\zeta_{\phi} = \left(I_{y} - I_{z}\right)\dot{\theta}\dot{\psi} - I_{r}\dot{\theta}\overline{\Omega} + d_{x} \tag{4.14}
$$

跟踪误差为：

$$
e_{\phi} = \phi^{*} - \phi \tag{4.15}
$$

滤波后的跟踪误差及其关于时间的导数：

$$
\epsilon_{\phi} = \lambda_{\phi}e_{\phi} + \dot{e}_{\phi} \tag{4.16}
$$

$$
\dot{\epsilon}_{\phi} = \lambda_{\phi}\dot{e}_{\phi} + \ddot{\phi}^{*} - \frac{1}{I_{x}}\left(\zeta_{\phi} + u_{\phi}\right) \tag{4.17}
$$

其中，  $\lambda_{\phi}$  为预设参数，若各状态量均可测，根据期望误差动力学进行反馈线性化，令  $\dot{\epsilon}_{\phi} = - k_{\phi}\epsilon_{\phi}$ ，则控制器可设计如下：

$$
u_{\phi} = I_{x}\left(\lambda_{\phi}\dot{e}_{\phi} + \ddot{\phi}^{*} + k_{\phi}\epsilon_{\phi}\right) + u_{\phi}^{d} \tag{4.18}
$$

其中,  $u_{\phi}^{d} = - \zeta_{\phi}$  为不确定与扰动补偿项。

然而, 由于系统的不确定性与扰动, 集成不确定项  $\zeta_{\phi}$  无法直接测量。控制量需要重新设计。将(4.18)代入(4.17), 易得:

$$
\dot{\epsilon}_{\phi} = -k_{\phi}\epsilon_{\phi} - \frac{1}{I_{x}}\left(\zeta_{\phi} + u_{\phi}^{d}\right) \tag{4.19}
$$

则集成不确定项  $\zeta_{\phi}$  可表示为:

$$
\zeta_{\phi} = -I_{x}\left(\dot{\epsilon}_{\phi} + k_{\phi}\epsilon_{\phi}\right) - u_{\phi}^{d} \tag{4.20}
$$

通过带单位增益及零相转换的低通滤波器  $G_{\phi}^{f}(s)$ ,  $\zeta_{\phi}$  可通过下式由拉普拉斯逆变换与卷积近似:

$$
\hat{\zeta}_{\phi} = \mathcal{L}^{-1}\left[G_{\phi}^{f}(s)\right]*\zeta_{\phi} \tag{4.21}
$$

式中  $*$  表示卷积算符, 令  $u_{\phi}^{d} = - \hat{\zeta}_{\phi}$ , 则:

$$
u_{\phi}^{d} = \mathcal{L}^{-1}\left[G_{\phi}^{f}(s)\right]*\left[I_{x}\left(\dot{\epsilon}_{\phi} + k_{\phi}\epsilon_{\phi}\right) + u_{\phi}^{d}\right] \tag{4.22}
$$

根据上式求解  $u_{\phi}^{d}$

$$
u_{\phi}^{d} = I_{x}\cdot \mathcal{L}^{-1}\left[\frac{G_{\phi}^{f}(s)}{1 - G_{\phi}^{f}(s)}\right]*\left(\dot{\epsilon}_{\phi} + k_{\phi}\epsilon_{\phi}\right) \tag{4.23}
$$

与(4.18)式联立可得姿态环控制量为:

$$
u_{\phi} = I_{x}\left(\left(\ddot{\phi}^{*} + k_{\phi}\epsilon_{\phi} + \lambda_{\phi}\dot{\epsilon}_{\phi}\right) + \mathcal{L}^{-1}\left[\frac{G_{\phi}^{f}(s)}{1 - G_{\phi}^{f}(s)}\right]*\left(\dot{\epsilon}_{\phi} + k_{\phi}\epsilon_{\phi}\right)\right) \tag{4.24}
$$

其中, 低通滤波器设置为:

$$
G_{\phi}^{f}(s) = \frac{1}{T_{\phi}s + 1} \tag{4.25}
$$

$T_{\phi}$  为用以调节低通滤波带宽的时间常数。代入(4.24)可将滚转角控制量表示为:

$$
u_{\phi} = I_{x}\left(\ddot{\phi}^{*} + \left[\lambda_{\phi}k_{\phi} + \frac{\lambda_{\phi} + k_{\phi}}{T_{\phi}}\right]e_{\phi} + \frac{\lambda_{\phi}k_{\phi}}{T_{\phi}}\int_{0}^{t}e_{\phi}dt + \left(\lambda_{\phi} + k_{\phi} + \frac{1}{T_{\phi}}\right)\dot{\phi}_{\phi}\right) \tag{4.26}
$$

令  $K_{p} = \lambda_{\phi}k_{\phi},K_{d} = \lambda_{\phi} + k_{\phi}$ , 则将上式提取公因式  $\mathcal{V}_{x}$  简化后即可表示为(4.12)式的形式。

# 4.1.2.2 无人机UDE仿真控制模型

对串级PID的总体控制逻辑进行优化改进, 参照上小节所述的基本原理在

Simulink 中搭建如图 4.7 所示的 UDE 控制系统。姿态环同样以滚转角控制为例，如图 4.8 所示；位置环以高度控制为例，如图 4.9 所示。

![](images/591c18712c3c0c017070e2debf7fb8474e49cafa59f903ceea200d52ff03a36e.jpg)  
图 4.7 Simulink 下基于 UDE 的无人机控制系统架构

![](images/3021c297e8431043c689d7ed26dd676fc40210cf032c548fedb60a0f604a6a32.jpg)  
图 4.8 基于 UDE 的姿态角控制器

![](images/14a6f31c625ccdd5b768e11ca12dc4e351c1a0f971201efc5df8ff03fd946e71.jpg)  
图 4.9 基于 UDE 的高度控制器

# 4.1.3 考虑惯性项偏移的 UDE-GS 控制方案

观察(4.12)式可知，上节所述姿态环 UDE 控制方法依赖于对机体系下系统各轴转动惯量的确定。然而，由于机械臂的运动导致系统惯性张量时变，且质心偏移同时会对系统产生额外的扰动力矩，实际调试中采用固定参数的标准 UDE 控制效果较传统串级 PID 并未取得明显优势。根据第二章的动力学分析，机械臂各关节运动导致的惯性张量的变化可由机械臂位形解算，但解析形式较为复杂。

本节尝试在 UDE 控制系统中引入调度增益 (GS) 方法，提出考虑惯性项偏移的 UDE- GS 改进控制律以提高控制系统的鲁棒性。调度增益方法将非线性系统控制器中的部分增益设置为系统特定时变状态量（即调度变量）的函数。通常选取系统的数个典型状态（即特征点），对调度变量的对应控制增益调参，而一般状态下的控制增益根据各特征点的控制增益由插值得到[96]。

# 4.1.3.1 调度变量设置

针对本文中因机械臂不同位形使复合系统惯性参数偏移的问题，将系统实时质心  $O_{l}$  相对  $\Sigma_{d}$  系原点  $O_{d}$  的偏移量  $\Delta \mathbf{x}_{o} = \left[\Delta \mathbf{x}_{o} \Delta \mathbf{y}_{o} \Delta \mathbf{z}_{o}\right]^{\mathrm{T}}$  作为调度变量。  $\Sigma_{d}$  系下复合系统实时质心的位置矢量为：

$$
\pmb{p}_{o}^{d} = \frac{\sum_{i}^{n} m_{i} \cdot \pmb{p}_{i}^{d}}{m_{d} + \sum_{i}^{n} m_{l_{i}}} \tag{4.27}
$$

式中  $\pmb{p}_{l_{i}}^{d}$  可由 3.3 节机械臂运动学通过齐次变换计算。

若系统初始质心偏移位置为  $\pmb{p}_{o(0)}^{d}$ ，易得：

$$
\Delta \mathbf{x}_{o} = \pmb{p}_{o}^{d} - \pmb{p}_{o(0)}^{d} \tag{4.28}
$$

为简化控制系统复杂度，假设任务中无人机航向始终对准目标方向，滚转角与俯仰角均为小量，仅考虑系统质心在  $X_{d} - O_{d} - Z_{d}$  平面内的变化，即  $\Delta y_{o} \equiv 0$ 。

选用几种机械臂典型构型计算质心偏移量作为调度变量的特征点，不同质心偏移状态下，UDE 控制各通道系数  $K_{p}$  、  $K_{d}$  、  $T_{k}$  根据特征点的系数通过插值得到。

在  $\Sigma_{d}$  系下质心偏移量与转动惯量的变化是各关节角变化的函数。此外，无人机起落架亦可视为一副并联的单自由度机械臂，因其收放过程中转动惯量变化造成的扰动可参照同样方法进行动态补偿。通过结合 UDE 与调度增益方法实现对惯性参数变化的自适应控制。

# 4.1.3.2 控制参数设置

不同控制律的姿态环与位置环初始参数设置对比分别如表 4.1，4.2 所示。

表4.1串级PID与UDE控制律姿态环参数设置  

<table><tr><td></td><td colspan="2">串级 PID</td><td colspan="2">UDE</td></tr><tr><td rowspan="3">滚转角φ</td><td>Kp</td><td>4</td><td>Kp</td><td>4</td></tr><tr><td>Ki</td><td>0.3</td><td>Tφ</td><td>1</td></tr><tr><td>Kd</td><td>0.4</td><td>Kd</td><td>2</td></tr><tr><td rowspan="3">俯仰角θ</td><td>Kp</td><td>7</td><td>Kp</td><td>3.5</td></tr><tr><td>Ki</td><td>0.3</td><td>Tθ</td><td>1</td></tr><tr><td>Kd</td><td>0.4</td><td>Kd</td><td>2</td></tr><tr><td rowspan="3">偏航角ψ</td><td>Kp</td><td>0.5</td><td>Kp</td><td>8.7</td></tr><tr><td>Ki</td><td>0.05</td><td>Tφ</td><td>1</td></tr><tr><td>Kd</td><td>0.003</td><td>Kd</td><td>1.2</td></tr></table>

表4.2串级PID与UDE控制律位置环参数设置  

<table><tr><td></td><td colspan="2">串级 PID</td><td colspan="2">UDE</td></tr><tr><td rowspan="3">XENU</td><td>Kp</td><td>0.5</td><td>Kp</td><td>1.8</td></tr><tr><td>Ki</td><td>0.001</td><td>Tx</td><td>1</td></tr><tr><td>Kd</td><td>0.2</td><td>Kd</td><td>2.5</td></tr><tr><td rowspan="3">YENU</td><td>Kp</td><td>0.6</td><td>Kp</td><td>2</td></tr><tr><td>Ki</td><td>0.001</td><td>Ty</td><td>1.1</td></tr><tr><td>Kd</td><td>0.1</td><td>Kd</td><td>1.4</td></tr><tr><td rowspan="3">ZENU</td><td>Kp</td><td>2</td><td>Kp</td><td>4.5</td></tr><tr><td>Ki</td><td>0.15</td><td>Tz</td><td>0.7</td></tr><tr><td>Kd</td><td>0.06</td><td>Kd</td><td>1.4</td></tr></table>

# 4.2 机械臂逆运动学求解与轨迹规划方法

# 4.2.1 机械臂可操作性分析

根据第三章对于机械臂的运动学分析可获得  $\Sigma_{b}$  系下瞬时正运动学关系：

$$
\pmb{\nu}_{e}^{b} = \pmb {J}(\pmb {\Theta})\cdot \dot{\pmb{\Theta}} \tag{4.29}
$$

其中，  $\pmb{\nu}_{e}^{b} = \left[\left(\dot{\pmb{p}}^{b}\right)^{\mathrm{T}}\left(\pmb {\omega}^{b}\right)^{\mathrm{T}}\right]^{\mathrm{T}}\in \mathbb{R}^{6}$  表示末端执行器的速度空间（速度与角速度状态量）。  $\pmb {J}(\pmb {\Theta})\in \mathbb{R}^{6\times n}$  为末端执行器对应的雅克比矩阵。对于Yoshikawa可操作度 $\sqrt{\left|JJ^{\mathrm{T}}\right|}$  ，当该值为0时，说明末端执行器在该位姿处于奇异状态[92]。

机械臂在执行抓取任务，在奇异位形下机械臂末端执行器将会损失笛卡尔空间下的自由度，无法通过运动实现在某个方向上的运动。故后续逆运动学求解与轨迹规划应尽可能避免机械臂的奇异位形。

# 4.2.2基于BFGS拟牛顿法的机械臂逆运动学求解

当设定末端执行器期望位姿后，规划一条由当前位姿平滑过渡期望位姿的平滑轨迹。对各时刻对应轨迹的期望位姿，通过逆运动学求得各关节期望关节角。

对于一般欠驱动机械臂，不满足Pieper准则[90]，无法获得封闭形式的解析解。其末端执行器的可达位姿受限。对本文采用的4R构型机械臂，假定无人机悬停于定点且目标位于机械臂工作空间内时，可通过放松末端执行器的姿态约束使其达到预期目标位置。

在仿真中，基于Broyden- Fletcher- Goldfarb- Shanno(BFGS）拟牛顿法选代求解逆运动学的数值解。该数值方法使用状态量的二阶导数（Hessian矩阵）确定当前迭代步长，使用梯度投影法处理机器人关节约束的代价函数边界限制。对迭代初始值偏离较大或目标构型接近关节边界约束的情况具有较好的适应性[97]。

# 4.2.2.1求解优化指标

4.2.2.1求解优化指标逆运动学数值求解的优化指标为求解特定时刻下机械臂的期望关节角  $\pmb {\Theta}_e^*$  ，使 $\Sigma_{b}$  系下考虑权重的末端执行器位姿  $\left(\boldsymbol {p}_e^b,\boldsymbol {E}_e^b\right)$  与目标位姿  $\left(\boldsymbol {p}_e^b,\boldsymbol {E}_e^b\right)$  的欧氏距离尽可能小：

$$
\begin{array}{rl} & {\pmb {\Theta}_e^* = \arg \min_{\pmb {\theta}_e}f(\pmb {\Theta}_e)}\\ & {\quad = \arg \min_{\pmb {\theta}_e}\left(\left\| \pmb {w}_1^\mathrm{T}\cdot \left(\pmb {p}_e^b -\pmb {p}_g^b\right)\right\| _2 + \left\| \pmb {w}_2^\mathrm{T}\cdot \left(\pmb {E}_e^b -\pmb {E}_g^b\right)\right\| _2\right)} \end{array} \tag{4.30}
$$

其中，  $\pmb {w}_1 = \left[w_xw_yw_z\right]^{\mathrm{T}},\pmb {w}_2 = \left[w_\psi w_\theta w_\phi\right]^{\mathrm{T}}$  分别为位置项与姿态项的计算权重。 $\pmb {p}_e^b,\pmb {E}_e^b$  通过(3.16)利用齐次变换矩阵  ${}^b T_e$  求解。

# 4.2.2.2选代求解步骤

基于BFGS拟牛顿法的逆运动学选代求解步骤如下：

1．设定各关节角选代初值  $\pmb{x}^{(0)}$  及  $H = B^{-1}$  ，  $t = 0$

2. 计算搜索方向  $a^{(t)} = -\boldsymbol {B}_t^{-1}\cdot \boldsymbol {g}_t$

3. 从  $\pmb{x}^{(t)}$  沿  $a^{(t)}$  求最优步长，并更新  $\pmb{x}^{(t + 1)}$

$$
\lambda_{t} = \arg \min_{\lambda}f\left(\pmb{x}^{(t)} + \lambda \cdot \pmb{d}^{(t)}\right) \tag{4.31}
$$

$$
\pmb{x}^{(t + 1)} = \pmb{x}^{(t)} + \lambda_t\cdot \pmb{d}^{(t)} \tag{4.32}
$$

4. 若  $\left|g_{t + 1}\right|$  达到精度要求，则终止选代，否则进入下一步；

5.  $\Delta g = g_{t + 1} - g_t$  ，  $\Delta \pmb {x} = \pmb{x}^{(t + 1)} - \pmb{x}^{(t)}$

更新  $\pmb{B}^{- 1}$  值

$$
\pmb{B}_{t + 1}^{-1} = \left(I_{n} - \frac{\Delta x_{t}\Delta g_{t}^{T}}{\Delta x_{t}^{T}\Delta g_{t}}\right)\pmb{B}_{t}^{-1}\left(I_{n} - \frac{\Delta g_{t}\Delta x_{t}^{T}}{\Delta x_{t}^{T}\Delta g_{t}}\right) + \frac{\Delta x_{t}\Delta x_{t}^{T}}{\Delta x_{t}^{T}\Delta g_{t}} \tag{4.33}
$$

6.  $t = t + 1$  ，转入第2步继续迭代。

在Simulink中调用机器人系统工具箱的InverseKinematics模块设置BFGS拟牛顿法的相关参数，构建如图4.10所示的求解子系统，实现逆运动学的快速计算。仿真中由输入的末端执行器期望位置矢量与姿态角转化为齐次变换形式进行求解，将姿态项约束的权重  $W_{2}$  设为0，仅考虑位置项精度，最大迭代次数设为1500，实际计算中通常只需迭代20步左右即可满足精度要求。

![](images/f6b10993c92de15d0e7d9aa64a6112a221fadac9a0329ddb0d2a6d545cacdfa6.jpg)  
图4.10机械臂逆运动学求解子系统

与一般安装于固定基座的机械臂不同，无人机与机械臂的运动相互耦合，对控制提出了较高要求。此外，逆运动学求解还需满足控制系统的实时性要求，即时对因外界扰动造成的位形变化做出修正。

# 4.2.3基于关节空间的机械臂多项式轨迹规划

由于在笛卡尔空间下规划机械臂执行器的轨迹可能出现奇异位形等问题，本文中的轨迹规划均在关节空间下进行。关节空间下的轨迹规划旨在设计执行周期下各关节角的时变曲线使末端执行器以平滑的轨迹从初始位置稳定地移动到期望目标位姿。

基于4.2.2节所述的逆运动学求解得到的各期望末关节角  $\pmb{\Theta}_{e}$  ，由传感器获得当前各初始关节角  $\pmb{\Theta}_{0}$  及初始关节角速度  $\dot{\pmb{\Theta}}_{0}$  ，令期望末关节角速度  $\dot{\pmb{\Theta}}_{e} = O_{n\times 1}$  ，执行时长为  $T$  。设计三次多项式轨迹方程：

$$
\pmb {\Theta}(t) = \sum_{j = 0}^{3}\pmb {K}_j\cdot t^j \tag{4.34}
$$

其中，各阶系数  $\pmb {K}_j$  为

$$
\left\{ \begin{array}{l}K_{0} = \pmb{\Theta}_{0} \\ K_{1} = \dot{\pmb{\Theta}}_{0} \\ K_{2} = -\frac{2\dot{\pmb{\Theta}}_{0} + \dot{\pmb{\Theta}}_{e}}{T} +\frac{3(\pmb{\Theta}_{e} - \pmb{\Theta}_{0})}{T^{2}} \\ K_{3} = \frac{\dot{\pmb{\Theta}}_{0} + \dot{\pmb{\Theta}}_{e}}{T^{2}} -\frac{2(\pmb{\Theta}_{e} - \pmb{\Theta}_{0})}{T^{3}} \end{array} \right. \tag{4.35}
$$

当机械臂需在执行中经过特定位形，如考虑避障时，需在基坐标系下将该位形下各关节期望速度由雅克比逆矩阵转化为相应的关节速度，并作为前后两段执行周期的期望末关节角速度与初始关节角速度，以保证机械臂运动的连续性。

末端执行器的仿生鳍条由步进电机驱动，在收到执行指令后，同样基于上述三次多项式根据初始与终止的夹持角度规划执行轨迹。若需要机械臂执行笛卡尔空间下更平滑的参考轨迹，可尝试三次样条曲线等其它参考函数。

![](images/f6fc675f62d7584c996c12bc9088a8db3be61c2fcdfcda77aff984acfa294b5d.jpg)  
图4.11 机械臂关节角轨迹规划子系统

# 4.3 滚动时域执行策略与结果分析

# 4.3.1 机械臂滚动时域执行策略

由于机械臂与无人机运动的相互耦合，当机械臂各关节按预期轨迹执行结束后，末端执行器通常已偏离预期抓取位置。对此，本文提出一种关节空间下“滚动时域（Receding Horizon）”的轨迹规划与控制执行策略，其基本思想如下：

首先确定轨迹规划的基本采样时间  $T_{\mathrm{sample}}$ ，规划时长比例系数  $K_{t}$  及最大规划时长  $T_{\mathrm{max}}$ ，注意  $T_{\mathrm{max}} > T_{\mathrm{sample}}$ 。若各关节舵机可反馈角度信息，第  $k$  轮执行周期初始获取当前机械臂各关节的关节角  $\pmb{\Theta}_{k}$  及关节角速度  $\dot{\pmb{\Theta}}_{k}$ ，根据当前终端距离  $d_{end}$ （执行器原点与预期抓取点位置距离）设定预估执行时长  $T_{k}$  并限幅：

$$
T_{k} = sat(K_{t}\cdot d_{end},T_{\mathrm{max}}) \tag{4.36}
$$

其中限幅函数设定为

$$
sat(x, x_{\mathrm{max}}) = \left\{ \begin{array}{ll}x, & \left|x\right|< x_{\mathrm{max}} \\ \operatorname {sign}(x) \cdot x_{\mathrm{max}}, & \left|x\right| \geq x_{\mathrm{max}} \end{array} \right. \tag{4.37}
$$

按4.2节中的规划策略驱动机械完成本轮周期的动作指令。若当前终端距离 $d_{end}$  大于限值  $d_{\mathrm{max}}$  ，则进入第  $k + 1$  轮执行周期。直至  $d_{end}\leq d_{\mathrm{max}}$  ，即认为执行器已到目标位置，发送鳍条的驱动指令，完成对目标的抓取动作。

后续仿真中设置  $T_{\mathrm{sample}} = 0.2\mathrm{s}$  ，  $K_{t} = 25$  ，  $T_{\mathrm{max}} = 5\mathrm{s}$  。

机械臂各关节角切值设为  $\pmb {\theta}_0 = \left[0 - 60^\circ 50^\circ 64.83^\circ \right]^{\mathrm{T}}$  ，该位形可以保证机械臂的质心尽可能靠近  $\Sigma_{\mathrm{b}}$  系  $Z_{b}$  轴的同时，末端相机获得较好的前向视野。

仿真中相应的机械臂预估执行时长  $T_{k}$  随仿真时间的变化曲线如图4.12所示。

![](images/0ca709f0b5ce39774903bb0e5d87514c58e8737d91d02a7def01f245fc9c9c5e.jpg)  
图4.12预估执行时长变化曲线

# 4.3.2步进电机与舵机的传递函数

本文选用的机械臂舵机设定有角度传感器，但无法感知关节力矩。假定舵机驱动器可实时补偿机械臂重力项，在仿真中对步进电机及舵机采用开环控制。而在轨迹规划环节根据实时角度监测量重新设定期望关节角，实现近似闭环控制的效果。

执行器步进电机与机械臂舵机的仿真模型可以二阶惯性环节近似表示，仿真预设与经参数辨识后的步进电机与舵机传递函数分别表示如下：

$$
G_{sm}(s) = \frac{1}{s^2 + 0.02s + 1} \tag{4.38}
$$

$$
G_{sv}(s) = \frac{4235d_w^2}{s^2 + 54.83d_\xi d_w s + 4511d_w^2} \tag{4.39}
$$

其中， $d_{\xi}$ ， $d_w$  分别为阻尼系数与自然频率调节系数。

# 4.3.3 机械臂执行结果分析

本节不考虑无人机运动对机械臂的耦合影响，设置固定基座构型并增设高斯扰动对机械臂的轨迹规划与控制策略进行测试分析。采用滚动时域策略规划的机械臂期望状态如图4.13所示。关节空间下各关节角期望值的规划结果较为平稳，在相邻执行周期的切换时刻存在角速度期望值的小幅突变，可通过伺服舵机执行时的预设限幅函数予以消除，保证舵机输入指令的平滑连续。

![](images/e80f94e55cb1d2f25bc669acfe410bcf873eb2745968a7a05e53bcfaa2deb53a.jpg)  
图4.13 机械臂规划关节角与关节角速率对比

根据末端  $\Sigma_{e}$  系位姿与关节状态量  $\pmb{\Theta}$  与  $\dot{\pmb{\theta}}$  的对应关系，可参照3.3.2节运动学模型由(3.22)式的雅可比矩阵计算末端执行器在  $\Sigma_{b}$  系下的角速度与速度的时变关系。在Simulink中调用机器人系统工具箱的“Get Transform”及“Get Jacobian”模块

建立如图 4.14 所示的末端执行器的预估抓取距离与速度状态计算模块。

![](images/5475c40bc1cb94a8083982d301bbe603fd1abe67f9ad08455dd68e72846fabc1.jpg)  
图4.14 末端执行器齐次变换及速度状态量计算模块

计算结果如图4.15所示，可见在任务周期内向预定目标运动的过程中，末端执行器相对  $\Sigma_{b}$  系保持了相对平稳的运动状态。图中速度与角速度的分别存在周期性的小幅跳变，最大幅度分别为  $0.023\mathrm{m / s}$  及  $0.045\mathrm{rad / s}$  左右，频率与机械臂关节角状态量的监测采样频率一致。经分析跳变是由仿真中采用滚动时域策略执行时，轨迹规划模块输入的采样时间延迟所致。仿真结果表明，跳变幅度较小，对无人机与机械臂的控制效果无明显影响，可以验证机械臂运动规划方案的可行性与控制系统的鲁棒性。

![](images/5338186d982f317befeed1c0dae4c8195fdf37505bdaea1b398c9ef59afaac8b.jpg)  
图4.15 末端执行器速度与角速度变化曲线

# 4.4 本章小结

本章设计了基于 UDE- GS 方法的六旋翼无人机的自适应控制方案及机械臂的轨迹规划方法。基于惯性项补偿的 UDE 控制方案可有效抑制因机械运动及外界扰动对无人机运动的干扰作用，显著提高了控制系统的鲁棒性。基于“滚动时域”策略的三次多项式轨迹规划可快速更新机械臂的关节角指令，对于浮动基座构型的无人机- 机械臂系统可实现在预定执行周期下系统的稳定控制与对终端位姿的稳定跟踪。

# 第五章 系统组合视觉伺服控制方法研究

视觉伺服控制是基于光学图像信息反馈的闭环控制。为实现无人机- 机械臂系统的视觉伺服控制，首先需进行图像处理提取视觉特征，确定目标物体相对相机系及机体系/基坐标系的位姿，进而控制无人机飞抵目标前的期望位置并驱动各关节使末端执行器按预定轨迹到达目标位姿。

# 5.1 视觉系统的标定与测试

视觉系统的标定是保证机器视觉工程精度的基础。包括相机的内部参数（内参）、外部参数（外参）标定及相机与机器人系统相对关系的手眼标定。

# 5.1.1 相机模型与内参标定

基于小孔成像的相机中央投影模型及相关坐标如图5.1所示。 $P$  表示空间目标点位置， $\pmb{p}$  为该点在成像平面的投影位置，主光轴通过像平面的中心且与像平面垂直。

![](images/6cae9ce4623f14abc77c11dbfb055f04d2d68fe1a6f5397b4b455e4421a7d75b.jpg)  
图5.1相机中央投影与相关坐标示意图

# 5.1.1.1 视觉相关坐标系定义

(1）相机坐标系  $\Sigma_{c}(O_{c} - X_{c}Y_{c}Z_{c})$

原点  $O_{c}$  位于相机的光心，即透镜的中心， $X_{c}$  轴、 $Y_{c}$  轴均垂直于主光轴，分别朝向相机右侧与下侧为正， $Z_{c}$  轴沿主光轴朝向相机前方为正。机载相机系  $\Sigma_{c0}$  与末端相机系  $\Sigma_{c1}$  在系统中的相对位姿示意图见图3.1。

# (2）像平面坐标系  $\Sigma_{i}(x,y)$

如图5.1所示，像平面位于  $\Sigma_{c}$  原点前的焦距  $f$  处，与主光轴垂直。  $\Sigma_{i}$  系原点为主光轴与像平面的交点（主点），  $x,y$  轴分别与  $\Sigma_{c}$  系得  $X_{c}$  、  $Y_{c}$  轴平行。

# (3）像素坐标系  $\Sigma_{p}(u,\nu)$

将像平面均匀划为  $\mathrm{w}\times \mathrm{h}$  的网格。每个网格单元对应于一个像素，其宽、高分别为  $\rho_{w}$  、  $\rho_{h}$  。  $\Sigma_{p}$  系原点位于像平面左上角，  $u$  、  $\nu$  轴分别与  $\Sigma_{i}$  系  $x,y$  轴平行。主点坐标设为  $\left(u_{0},\nu_{0}\right)$  。

相机系坐标  $\pmb {P}_c = \left(X_c,Y_c,Z_c\right)$  与像平面坐标  $\pmb {p}_i = (x,y)$  的转化关系为：

$$
\left[ \begin{array}{l}x\\ y \end{array} \right] = \frac{f}{Z_c}\cdot \left[ \begin{array}{l}X_c\\ Y_c \end{array} \right] \tag{5.1}
$$

像素坐标  $\pmb {p} = (u,\nu)$  与像平面坐标  $\pmb {p}_i$  的转化关系为：

$$
\left[ \begin{array}{l}u\\ \nu \end{array} \right] = \left[ \begin{array}{l}u_0\\ \nu_0 \end{array} \right] + \left[ \begin{array}{ll}\frac{x}{\rho_w} & \frac{y}{\rho_h} \end{array} \right]^{\mathrm{T}} \tag{5.2}
$$

# 5.1.1.2相机内参模型

相机的内参即内部参数，描述透镜与感光元件的固有属性，包括相机焦距  $f$  像素点宽  $\rho_{w}$  、高  $\rho_{h}$  ，主点坐标  $\left(u_{0},\nu_{0}\right)$  。

设  $\tilde{P} = \left[x_{w},y_{w},z_{w},1\right]^{\mathrm{T}}$  为目标点在  $\Sigma_{w}$  系下的齐次坐标，  $\tilde{p} = [u,\nu ,w]^{\mathrm{T}}$  为目标点在  $\Sigma_{p}$  系上的齐次坐标，  ${}^{c}T_{w}$  为目标点从  $\Sigma_{w}$  系到  $\Sigma_{p}$  系的齐次变换（即外参）。

令  $\pmb {K}_I$  为相机的内参矩阵：

$$
\pmb {K}_I = \left[ \begin{array}{cccc}\alpha_x & k_s & u_0 & 0\\ 0 & \alpha_y & \nu_0 & 0\\ 0 & 0 & 1 & 0 \end{array} \right] \tag{5.3}
$$

其中，  $\begin{array}{r}\alpha_{x} = \frac{f}{\rho_{w}} \end{array}$ $\begin{array}{r}\alpha_{y} = \frac{f}{\rho_{h}} \end{array}$ $k_{s}$  为  $\alpha_{x}$  与  $\alpha_{y}$  的skew系数。则目标点从  $\Sigma_{w}$  系到  $\Sigma_{p}$  系的投影转化关系可表示为[91]：

$$
\tilde{p} = K_{I}\cdot{}^{c}T_{w}\cdot \tilde{P} \tag{5.4}
$$

# 5.1.1.3相机畸变模型

相机透镜的几何畸变主要分径向与切向畸变，会导致目标在像平面上的投影位置偏离由(5.4)计算的理论值[91,98]。本文采用图像空间下的Brown畸变模型，像素坐标系上某投影点沿  $u$  、  $\nu$  方向的畸变偏移值为  $\delta_{u}$  、  $\delta_{\nu}$  可由下式计算：

$$
\left[ \begin{array}{c}\delta_{i} \\ \delta_{i} \end{array} \right] = \underbrace{\left[ \begin{array}{c}u \\ v \end{array} \right]}_{i = 1} \cdot \sum_{i = 1}^{n} k_{i} r^{2i} + \underbrace{\left[ \begin{array}{c}2 u \nu \\ r^{2} + 2 \nu^{2} \end{array} \right]}_{\begin{array}{c}2 u \nu \\ 2 u \nu \end{array}} \left[ \begin{array}{c}p_{1} \\ p_{2} \end{array} \right] \tag{5.5}
$$

其中， $k_{i}$  为  $2i$  阶的径向畸变系数， $p_{1}, p_{2}$  为切向畸变系数， $r = \sqrt{u^{2} + \nu^{2}}$ 。

# 5.1.1.4 相机参数的标定

由于生产及调试等过程产生的误差，相机的内参数除像素的  $\rho_{i - 1}, \rho_{i}$  外会相对标称值产生一定偏差，故需要与畸变系数一同重新标定。

![](images/4c1fc50e47d5620c8fed0deb3ab1a8425e68c63e52f890794136ff66d6ea3d09.jpg)  
图5.2 MATLAB相机内参标定检测示意图

选用RunCam Split- 4作为末端随动相机进行标定测试，以边长  $31\mathrm{mm}$  的  $7 \times 9$  的棋盘格为标定板。采集2.7K分辨率图像，相机的内参矩阵、畸变系数等参数可通过MATLAB计算机视觉标定工具箱程序标定获得。标定结果如下表所示：

表5.1末端随动相机参数标定结果  

<table><tr><td>内部参数</td><td>畸变系数</td></tr><tr><td>αx=1141.9360</td><td>k1=-0.1719</td></tr><tr><td>αy=1018.5490</td><td>k2=0.0416</td></tr><tr><td>ks=9.8578</td><td>p1=-1.109e-3</td></tr><tr><td>(u0, v0)=(1314.1428, 714.2908)</td><td>p2=-2.718e-3</td></tr></table>

如图5.3所示，畸变映射图展示了像平面上从理想映射点到畸变映射点的移动分布。图像边缘存在较大径向畸变而切向畸变数量级很小，故在后续相机外参（位姿估计）计算中不可忽略径向畸变参数。标定结果的平均投影误差见图5.5。

![](images/60806168efacc834e09558a8f9436afd55dc8e5b4f38dd441b32e5793564e699.jpg)  
图5.3 相机畸变映射图[91]

![](images/18acd257fe924403912bfb550a5995c41195a97025c3f72356ee1a64ff8360ba.jpg)  
图5.4 相机系下标定板的相对位姿

![](images/c21d1083817e058518e18d6ecffbe6d65ceecbfbc032002331b28d4afc65eddf.jpg)  
图5.5 标定各图像平均投影误差

# 5.1.2 视觉系统手眼标定

本文中的视觉系统包含机载云台相机（Cam0, Eye- to- Hand）与末端随动相机（Cam1, Eye- in- Hand）。两组相机构型需分别进行手眼标定。Cam0与Cam1对应相机坐标系分别记为  $\Sigma_{c0}$  与  $\Sigma_{c1}$ 。

机载云台相机需标定  $\Sigma_{c0}$  系相对基坐标系的相对位姿  $^b T_{c0}$  。首先标定相机相对

于特定 ArUco 靶标的外参矩阵，进而利用齐次变换矩阵计算  $^b T_{c0}$ 。

末端随动相机需标定  $\Sigma_{c1}$  系相对末端工具系的相对位姿  $T_{c1}$ 。通过设定机械臂不同位形使末端执行器处于不同位姿。在不同位姿下标定 Cam1 相对固定靶标的外参矩阵，进而利用最小二乘法求解  $^e T_{c1}$ 。

在仿真中，设定相机安装误差为0，则  $^b T_{c0}$  与  $^e T_{c1}$  可直接通过坐标转换关系求解；在实物实验中，需要经过手眼标定获得  $^b T_{c0}$  与  $^e T_{c1}$  以消除安装误差。

# 5.2 目标检测与位姿估计方法

采用基于深度学习的目标检测算法（YOLO）实现无人机- 机械臂系统对非合作目标的检测与识别；采用基于EPnP的位姿估计方法，服务于后续基于位置的视觉伺服（PBVS）控制。

# 5.2.1 基于YOLOv5s的图像目标检测

YOLOv5是一系列在COCO数据集上训练的复合缩放目标检测模型，包括测试时间增强（TTA）、模型加密、超参数演化以及导出到ONNX、CoreML和TFLite的简化功能[99]。YOLOv5s以牺牲一定AP精度为代价，通过减小网络数目提高检测速度，可部署于嵌入式机载平台上，网络结构如图5.6所示。基于NUC平台可以在IntelCPU上实时运行Yolov5等深度学习的目标检测程序，而不必再依赖Nvidia等平台的GPU处理器。对于处理速度要求较高，GPU性能受限的机载嵌入式设备，基于YOLOv3- tiny则是目前常用的目标检测算法。

![](images/0bd8f6409de7c42342ee1c0c6babf7da282db783da043b4ed6084741a6eee638.jpg)  
图5.6YOLOv5s网络结构图[100]

在第二章中所选用的JetsonNano嵌入式计算机上部署训练的检测模型，利用机载目标检测识别装置对不同目标区域进行拍摄，以不同地表背景下的危爆品为

检测识别对象，检测结果如图 5.7 所示：

![](images/c39ad28c261fcb0bb560357569585e0d549e3f27c23ef026ccbfde882d896e83.jpg)  
图5.7 不同背景下的目标检测结果

# 5.2.2 基于EPnP的位姿估计方法

相机获取的图像通过YOLO算法实时检测目标，通过角点检测算法识别目标特征点信息。从图像检测识别结果到角点检测的特征点提取过程已在计算机视觉领域得到广泛研究，不作为本文研究工作重点。当预设特征点在目标系  $\Sigma_t$  下的相对位置矢量已知时，可根据检测结果通过EPnP方法进行位姿估计，服务于后续的视觉伺服控制。

# 5.2.2.1 EPnP基本原理

n点透视（Perspective- n- Point, PnP）问题即当相机内参及目标物体的几何属性已知时，根据多个目标特征点在像平面的投影坐标求解目标坐标系相对相机系的外参（姿态角及平移变换）。设目标特征点数为  $n_t$ ，当  $n_t > 3$  时，可任取3个非共线点及其中心点通过共面P4P方法求解初始外参，进而利用递推最小二乘方法求解更精准的相对位姿。当目标点数大于5时，一般可直接采用Faugeras等标定方法线性地求解外参[98]。

在MATLAB仿真中使用Peter Corke机器视觉工具箱，基于EPnP[101]方法进行位姿估计。设  $n_t$  个目标特征点在  $\Sigma_w$  系及  $\Sigma_c$  系下的坐标分别为  $\pmb {p}_i^w$  及  $\pmb {p}_i^c$ ， $i = 1,\ldots ,n_t$ 。EPnP根据  $n_t$  个点的世界坐标选择4个控制点并计算加权系数，通过相机模型和  $n_t$  个点的像素坐标求解4个控制点在相机坐标系下的坐标，进而得到  $n_t$  个点在相机

坐标系下的坐标, 将问题转化为 2D- 3D 位姿估计并利用 ICP 求解。相较其它位姿估计方法可以兼顾求解效率与精度。

基于 EPnP 的位姿估计求解步骤如下:

1. 设定  $\Sigma_{w}$  系下的 4 个非共面控制点  $\mathbf{c}_k^w (k = 1,\ldots ,4)$ , 其中  $\mathbf{c}_k^w$  设为各特征点的几何中心, 其余控制点通过主成分分析计算得到;

2. 在  $\Sigma_{w}$  系与  $\Sigma_{c}$  系下分别将各特征点表示为控制点的线性组合:

$$
\left\{ \begin{array}{l}\pmb {p}_i^w = \sum_{j = 1}^{4}\alpha_{ij}\cdot \pmb {c}_j^w \\ \pmb {p}_i^c = \sum_{j = 1}^{4}\alpha_{ij}\cdot \pmb {c}_j^c \\ \displaystyle \sum_{j = 1}^{4}\alpha_{ij} = 1 \end{array} \right. \tag{5.6}
$$

其中,  $\alpha_{ij}$  为齐次重心坐标, 根据相机内参及目标在像平面坐标, 由相机中央投影模型求解控制点在相机系下的坐标;

将相机中央投影模型(5.4)展开消去末行, 化为线性矩阵方程:

$$
M\cdot x = 0 \tag{5.7}
$$

其中,  $\mathbf{x}$  对应  $\alpha_{ij}$  、相机内参、像素坐标共 12 个未知量,  $\mathbf{M} \in \mathbb{R}^{n\times 12}$

(5.7)式的解可表示为  $M$  的零空间:

$$
\mathbf{x} = \sum_{i = 1}^{N}\beta_{i}\mathbf{\nu}_{i} \tag{5.8}
$$

$\nu_{i} \in \mathbb{R}^{12}$  为  $M$  的第  $i$  个零特征值对应的右奇异向量。

3. 优化  $\beta$  参数, 使不同坐标系下控制点欧氏距离之差最下;

$$
\left\{ \begin{array}{l}\beta^{*} = \arg \min_{\beta}\sum_{(i,j) \text{ s.t.} i< j}\left\| \text{Error}_{ij}(\beta)\right\|^{2} \\ \left\{ \begin{array}{l}\text{Error} (\beta)_{ij} = \left\| \pmb {c}_i^c - \pmb {c}_j^c\right\| ^2 -\left\| \pmb {c}_i^w - \pmb {c}_j^w\right\| ^2 \end{array} \right. \end{array} \right. \tag{5.9}
$$

4. 根据映射关系由奇异值分解求解目标相对相机系的外参  $\mathbf{T}_c$ , 即相对位姿。

此外还可利用光束平差法 (Bundle Adjustment, BA) 转化为最小化重投影误差的优化问题, 即计算满足下式的齐次变换:

$$
\pmb{T}^{*} = \underset {\pmb{T}}{\arg \min}\frac{1}{2}\sum_{i = 1}^{n_{i}}\left\| \tilde{\pmb{p}}_{i} - \frac{1}{w_{i}}\pmb{K}_{I}^{c}\pmb{T}_{w}\tilde{\pmb{p}}_{i}\right\|^{2} \tag{5.10}
$$

其中,  $\mathbf{K}_I$  为相机的内参矩阵,  $\tilde{\pmb{p}}_i$  、  $\tilde{\pmb{P}}_i$  分别对应目标点在  $\Sigma_{p}$  系及  $\Sigma_{w}$  系下的齐次坐标。

参照 5.1 节的标定结果设定相机参数，并添加  $\sigma = 0.05$  的白噪声。设定边长  $0.05\mathrm{m}$  的立方体特征点作为 EPnP 测试目标，给定 2 组目标位姿，立方体特征点在像素平面坐标系下的投影结果如图 5.8 所示。

![](images/86bd0975f9d5251c103d1408f985f6f38ffcbac62afa8a79358ffb98e68fddad.jpg)  
图 5.8 预设立方体目标在机载相机像平面下的投影

5.3.3 节算例中对目标的位姿估计结果如图 5.9，5.10 所示。

![](images/e1bc0d607ffe125ec8e7ad8709b29be9f33c1c1d62666dfce8790d895011f0e3.jpg)  
图 5.9 目标相对基坐标系的位置实时估计曲线（单位：m）

![](images/90617e09d97119dd6ac4aa3c5f3b6a31a79f5230632ed07711d8fd1198534559.jpg)  
图 5.10 目标相对基坐标系的姿态实时估计曲线（单位：rad）

# 5.2.2.3ArUco码检测

ArUco是OpenCV中一类可有效用于目标位姿估计的二维码标记库[102]。

![](images/252f72cece4177666b377cd86ba49fbe96a501619ec4464fb09601cb029a1c0b.jpg)  
图5.11各面标记角点在OpenCVArUco库中的表示[103]

若放宽对目标的非合作特性的限定，在目标几何特征已知时，可通过角点检测等算法获得图像特征点在像平面的坐标，从而利用EPnP基于递归最小二乘法求解相对位姿。在实物试验中，立方体各特征点在像平面的投影无法对应预设编号，可通过在各面设置ArUco码以确定各面位姿与角点编号。选择边长  $20\mathrm{mm}$  的正立方体作为检测目标，验证上述位姿估计方法。立方体除底面外各面贴有不同编号的ArUco标记。设第  $k$  个标记相对相机系的齐次变换矩阵为：

$$
H_{k}^{c} = \left[ \begin{array}{cc}R_{q}(q_{k}) & p_{k}\\ 0 & 1 \end{array} \right]i\in [0,N_{m}] \tag{5.11}
$$

$q_{k}$  是第  $\mathbf{k}$  个标记对应的姿态变换四元数，  $R_{q}$  是其对应的旋转矩阵。在ROS中通过调用OpenCV的ArUco库及detectMarkers(),solvePnP()函数对立方体各面二维码进行独立位姿估计，进一步采用文献[103]所述方法实现对立方体目标的融合位姿估计。

# 5.3 组合视觉伺服控制方法

5.3 组合视觉伺服控制方法旋翼无人机可视为某6自由度空间机器人的执行器，机载相机与无人机构成“眼在手上”的视觉伺服系统；而对于机载机械臂，相机与其构成了“眼在手外”的视觉伺服系统[98]。前者可通过机器视觉引导支持无人机的自主运动规划，后者则是在无人机悬停时实现对目标精准识别抓取的视觉伺服的基础。然而，机载相机的视野可能会被机械臂及末端执行器所遮挡，因此需要安装末端随动相机执行后续目标检测与操作任务。

# 5.3.1组合视觉伺服控制逻辑

组合视觉伺服系统配备两组相机，固定于无人机前端的相机具有较大视野，

用于预备阶段无人机巡航时搜寻目标，并在悬停时服务于第一阶段基于位置的视觉伺服（Position- Based Visual Servoing, PBVS）控制；固定于末端执行器上的随动相机可精确识别跟踪目标，服务于第二阶段基于图像的视觉伺服（Image- Based Visual Servoing, IBVS）控制。系统组合视觉伺服控制逻辑可参考图5.12，该方法效果类似“混合视觉伺服”方法，可以容许一定的相机标定误差，保证特征点不偏离相机视野，实现全局收敛性[87]。（末端执行器的相对位姿由关节角推算，若不对末端执行器进行位姿估计，则执行后可能存在稳态误差，故需设计“眼在手上”的构型）

![](images/539114b493011c83b6426ec856ceaf593568b56636ca5c4e5d5fd77d7a23d412.jpg)  
图5.12 系统组合视觉伺服控制方法结构框图

预备阶段，无人机起飞至预设高度搜寻目标，当发现识别到目标后，控制无人机飞至目标前的预备抓取位置。

第一阶段，在无人机悬停且目标位于机械臂工作空间内时，PBVS控制系统通过机载云台相机获取目标图像，识别特征点后经位姿估计驱动机械臂到达目标前的预备抓取点。在运动过程中，目标可能超出机载相机视场范围或被机械臂及末端执行器遮挡，导致PBVS失效。

在该阶段应赋予末端执行器姿态角  $X$  轴分量较大权重，使运动后期末端随动相机尽可能对准目标以服务于IBVS。该阶段PBVS控制以5.2.2节所述的EPnP方法进行目标的位姿估计。

第二阶段，当末端执行器到达预备抓取点时，切换至IBVS控制系统。IBVS控制系统由“眼在手上”的末端随动相机识别目标，并反馈给控制器，驱动末端执行器精准抓取目标。在该阶段，若无人机不发生大幅度机动，则相机可以通过机械臂的运动始终对准目标，降低目标特征点跟踪丢失的概率。

如果执行过程中目标图像丢失，则按上一执行周期机载相机获取的目标位姿进行控制，直至随动相机重新获取目标图像。

# 5.3.2 基于图像的视觉伺服控制原理

IBVS需预先通过示教的方法确定在执行器预估抓取位姿下，目标特征点在随动相机像平面上的位置，即期望特征点。其控制逻辑是通过机械臂的运动使像平面上目标特征点向期望特征点移动，因而避开了对目标的位姿估计过程。

设  $\Sigma_{p}$  系下目标特征点相对主点的坐标  $\left(\overline{u}, \overline{\nu}\right) = \left(u - u_{0}, \nu - \nu_{0}\right)$ ； $\dot{\pmb{p}} = \left[\dot{u} \dot{\nu}\right]^{\mathrm{T}}$  为目标特征点在像平面的运动速度，即“光流（Optical Flow）”； $\nu_{c}, \omega_{c}$  分别为相机系  $\Sigma_{c}$  相对世界系  $\Sigma_{w}$  运动的速度及角速度； $J_{p} \in \mathbb{R}^{2 \times 6}$  为目标特征点的图像雅可比矩阵。令  $f' = \frac{2}{\rho_{w} + \rho_{h}}$ ，则目标特征点在像素坐标系下投影运动速度与相机系相对世界系运动的速度关系如下[91]：

$$
\begin{array}{rl} & {\dot{\pmb{p}} = \pmb {J}_p(\pmb {p},\pmb {Z}_c)\cdot \pmb{\nu}}\\ & {\quad = \left[ \begin{array}{cccccc} - \frac{f'}{Z_c} & 0 & \frac{\overline{u}}{Z_c} & \frac{\overline{u}\overline{\nu}}{f'} & -\frac{f'^2 + \overline{u}^2}{f'} & \overline{\nu}\\ 0 & -\frac{f'}{Z_c} & \frac{\overline{\nu}}{Z_c} & \frac{f'^2 + \overline{\nu}^2}{f'} & -\frac{\overline{u}\overline{\nu}}{f'} & -\overline{u} \end{array} \right]\left[ \begin{array}{c}\nu_c\\ \omega_c \end{array} \right]} \end{array} \tag{5.12}
$$

设特征点在像平面的期望位置为  $\pmb{p}^{*}$ ，按(5.12)将多个目标特征点速度合并为特征速度矩阵  $\left[J_{p}\right] = \left[J_{p_{1}} J_{p_{2}} \dots J_{p_{n}}\right]^{\mathrm{T}}$ ，并，令  $\dot{\pmb{p}}^{*} = K_{c}\left(\pmb{p}^{*} - \pmb {p}\right) = K_{c} \cdot \pmb{e}_{p}$ ，可得

$$
\pmb {\nu} = K_{c} \cdot \left[J_{p}\right]^{-1} \cdot \pmb{e}_{p} \tag{5.13}
$$

其中， $K_{c}$  为控制比例系数。

取当前状态与期望状态图像雅可比矩阵的均值，以获取相机与像平面运动的二阶近似关系。当组合特征点数大于3时，使用伪逆求解最小化误差范数的最小二乘解。则(5.13)式变为：

$$
\pmb {\nu} = \frac{K_{c}}{2} \cdot \left[\left[J_{p}\right]^{+} + \left[J_{p}^{*}\right]^{+}\right] \cdot \pmb{e}_{p} \tag{5.14}
$$

根据上式即可由当前特征图像差值求解预期的相机运动。进而根据  $\Sigma_{cl}$  系的运动状态计算  $\Sigma_{e}$  系与  $\Sigma_{b}$  系的实时相对位姿，由逆运动学实时求解机械臂各关节舵机的驱动指令。

# 5.3.3 视觉伺服控制仿真验证

在仿真中设定边长  $20 \mathrm{~mm}$  的半透明立方体并假定立方体8个角点均可识别检测，且各点编号可在EPnP算法中一一对应。设定两组仿真算例进行验证，目标立

方体  $\Sigma_{t}$  系在  $\Sigma_{w}$  系下的位姿如表5.2所示。

表5.2目标立方体在世界系下的预设位姿  

<table><tr><td></td><td>算例1</td><td>算例2</td></tr><tr><td>位置(m)</td><td>[0.8, 0.05, 0.1]</td><td>[0.4, 0.03, 0.01]</td></tr><tr><td>姿态(rad, 1-2-3转序)</td><td>[pi/6, pi/2, 0]</td><td>[pi/4, pi/4, 0]</td></tr></table>

算例中目标特征点在机载固定相机与末端随动相机像平面的运动轨迹分别如图5.13，图5.14所示，特征点颜色对应于仿真运行时刻。蓝色立方体对应初始时刻目标的投影，红色立方体对应末时刻目标的投影。由图可知，在2.5s左右的PBVS阶段，由于无人机的运动使目标超出了机载相机视野范围，5.5s左右末端相机重新捕获目标特征点，转入IBVS阶段。通过视觉伺服控制驱动末端执行器使目标特征点重回像平面中心附近。

![](images/4b032a7279131f846900a9955c070ae15f664660243bfb27dc46efd361a236d3.jpg)  
图5.13目标特征点在机载相机像平面的运动轨迹

![](images/d01c6c81b2065fc069c5c3ea1fbbaffb617b41caf9132112681cc502dd858a55.jpg)  
图5.14目标特征点在末端相机像平面的运动轨迹

算例2中机械臂在  $\Sigma_{b}$  系下执行初始与终止位形如图5.15所示，其中  $\Sigma_{b}$  系、  $\Sigma_{e}$  系分别以黑色、紫色表示，黄色方框表示机载相机位置，目标特征点以蓝色圆圈表示。可见  $\Sigma_{e}$  系在终止位形下较精确地处于目标中心。注意各特征点对应编号在实际试验中可由5.2.2.3节所述的ArUco码确定，而实际使用的立方体通常至少会有1角点被遮挡，需对EPnP求解变量进行修正。

![](images/5d2b0fadb5dc54f903382e937c2b9521779cb1be0e345bf2aace35f7f7fc5872.jpg)  
图5.15 基坐标系下机械臂执行初始与终止位形示意图

# 5.4 本章小结

本章描述了基于小孔成像的相机中央投影模型，对相机的内部参数及“手眼关系”进行标定。提出了分别基于EPnP位姿估计的PBVS和基于图像雅可比的IBVS组合视觉伺服控制方案。通过整合第四章所述的系统控制方案与视觉系统的目标检测算法，可以实现旋翼无人机系统自主抓取系统的视觉伺服控制。在仿真中设置两组目标位姿特定的仿真算例，初步验证了本文提出的视觉伺服控制系统方案的可行性。

# 第六章 系统联合仿真分析与实物试验验证

本章在 Simulink- ROS 环境下对前文所提出的旋翼无人机- 机械臂自适应控制，运动规划方法及系统组合视觉伺服自主抓取方案进行联合数值仿真，并基于 DJI M600 Pro 无人机平台展开户外局部实物试验的验证分析。

# 6.1 Simulink 仿真系统集成设计

在仿真环境中集成旋翼无人机与机械臂的控制模型，同时建立 Simulink 与 ROS 的通讯。前者将无人机的当前位姿实时发布给 ROS，后者将 Gazebo 中目标检测的视觉信息实时反馈给 Simulink，实现系统视觉伺服的闭环仿真验证。

# 6.1.1 Simulink 系统仿真框架

在 Simulink 仿真环境中集成第四章所述的无人机与机械臂控制律及第五章所述的视觉伺服控制方案，总体框架如图 6.1 所示。利用 Simulink 中的 Simscape 多体动力学（Multibody）库，根据附有惯性属性的 CAD 模型参数构建相对精确的仿真模型，与无人机- 机械臂控制模型及视觉伺服系统集成调试，并在 Mechanics Explores 窗口下运行可视化的仿真结果。

![](images/4d0f118a9e03994be91466d541448579ed807a6e683e7698aea0c16f2e37fb90.jpg)  
图 6.1 旋翼无人机-机械臂自主抓取系统 Simulink 仿真总体框架

首先参照实物模型尺寸及相关物理参数，如第二章所述在 Solidworks 中建立六旋翼无人机及机械臂、末端执行器各组件的三维模型。参照第三章的坐标系定义将各组件三维模型依次导入 Simscape 中的“File Solid”模块中，并依据各坐标系的转换关系通过“Rigid Transform”及“Revolute Joint”模块连接各组件。进而

将各部分封装为相应的Simscape动力学模型子系统。

六旋翼无人机的Simscape模型如图6.2所示，机体系相对世界系的运动可通过“6- DOF Joint”模块连接，并输出相对位置、速度、四元数等参数。欧拉角及欧拉角速度可通过四元数转换及求导获得。无刷电机与螺旋桨分配模型如图6.5所示，由于Simscape无法直接模拟桨叶气动特性且不确定其中转动刚体是否模拟陀螺效应，故电机转子与螺旋桨质量暂设为0。螺旋桨产生的升力、对机体的反扭矩、陀螺力矩等均通过“External Force and Torque”模块施加到对应组件及机体系输出端上。同时，添加适当的服从高斯分布的外界扰动以验证控制系统的鲁棒性。

![](images/6680c1b2ebd953622f433732cb54396c2dcdb0a4e4da510e16b3229ec07d0904.jpg)  
图6.2六旋翼无人机Simscape子系统

无人机动力学模型中气动阻尼项与陀螺力矩均需转换到机体系下计算，其中陀螺力矩的计算考虑了机臂  $3.84^{\circ}$  上反角的影响。二者的近似计算模块分别如图6.3，6.4所示。

![](images/56b5e0861bcab60694be8d4caf9cbad8ce37199b3c8af6c55d931aa0d7c6558c.jpg)  
图6.3气动阻尼项近似计算模块

![](images/8ea26bb96bf52cf8c43535b88f45b9d4465d9ed21554344cf57e9bedf4067320.jpg)  
图6.4 陀螺力矩近似计算模块

![](images/a73421ef3326a6fa7bc143cbdbb74effc3d8d1df919b8eacd51567c7243a610d.jpg)  
图6.5 六旋翼无刷电机与螺旋桨 Simscape 子系统

机械臂与末端执行器的 Simscape 模型分别如图 6.6, 6.7 所示。目标检测信号经 PBVS 的位姿估计或 IBVS 的驱动指令, 经逆运动学求解模块确定机械臂的期望位形, 通过轨迹规划模块获得各时刻的期望关节角指令并传递给步进电机与舵机的简化模型。开启 “Revolute Joint” 的角度与角速度输出, 按特定采样频率反馈至轨迹规划模块, 实现机械臂系统的闭环控制。

![](images/bd5acab90834f968b773a0611fc75dd6f10b3b22911b118fad33d4cad196f324.jpg)  
图 6.6 4R 型机械臂 Simscape 子系统

![](images/26b52d86a2026334298a665c66adf5119ba77b373bda2c81cb37c1618093e7c5.jpg)  
图 6.7 末端执行器 Simscape 子系统

![](images/54d61f31d9bb24ff0b7a22e017eec92b8d32b082e5fff0551fc405752df50f29.jpg)  
图 6.8 末端执行器指令触发与执行系统

设定如图 6.8 所示的指令触发系统，当末端执行器的预估抓取点与目标的相对距离小于预定限值时（由 PnP 位姿估计计算），触发执行指令。

Simscape 中的物理信号需要通过 PS- Simulink 转换后发送给控制系统，控制指令亦需经 Simulink- PS 转换后传递至 Simscape 模型。各子系统不同采样频率的信号需通过“Rate Transition”模块进行转化。

仿真结果可实时在 Simscape Mechanics Explorer 中进行可视化演示。仿真演示界面中，复合系统的初始状态构型如图 6.9 所示。

![](images/114e6b8a314c543d5bd891cbff42c9c5e06ce8dc5e4218c4427902cfea4ac38d.jpg)  
图 6.9 Simscape Mechanics Explorer 可视化仿真演示界面

各分系统的参数调试应注意遵循“先独立，后集成”的原则。无人机控制系统调试时，需先断开机械臂轨迹规划模块的角度输入，将各关节角设为特定位形下的定值。首先对姿态环调参，需将位置输入设为 0 以固定机体系原点；待姿控系统调试至稳定状态时，解开位置约束以进一步对位置环调参。机械臂控制系统调试时，需将无人机位置与姿态输入均设为 0，即等效为固定基座；或断开与机体系的连接，将基坐标系经转换后与世界系直连。当各分系统均调试稳定后，恢复各系统完整连接状态，在不同工况及扰动输入下进一步优化全系统的控制参数，以实现基于视觉伺服的稳定自主抓取。仿真中基于 Stateflow Chart 分配系统不同阶段的控制指令。

# 6.1.2 Simulink 与 ROS 通讯

在 Ubuntu 系统的仿真机运行机器人操作系统 (Robot Operating System, ROS)

及Gazebo可视化仿真环境，将基于YOLO的实时目标检测结果以话题形式发布。在Windows系统的工作机通过MATLABROS工具箱的"Publish"模块，将Simulink仿真环境下的无人机及相机系的实时位姿发布并由ROS端订阅，通过“Subscribe”模块订阅ROS端发布的话题，并将检测结果传递给位姿估计结算模块，以实现视觉系统与无人机- 机械臂控制系统的联合闭环仿真。

# 6.2 仿真试验结果对比分析

# 6.2.1 联合仿真参数设置

# 6.2.1.1 仿真基本参数

在Simulink仿真环境中设置如表6.1所示的物理参数，目标与无人机的初始参数及求解器的相关参数：

表6.1联合仿真基本参数设置  

<table><tr><td>参数</td><td>数值</td></tr><tr><td>重力常数</td><td>g=9.80665m/s²</td></tr><tr><td>大气密度</td><td>ρ=1.293kg/m³</td></tr><tr><td>目标立方体边长</td><td>0.02m</td></tr><tr><td>Σw系下目标初始位置</td><td>ptarget=[0.6 0.03 0.01]Tm</td></tr><tr><td>目标Σr系相对Σw系初始姿态</td><td>Et=[pi/4 pi/4 0]T</td></tr><tr><td>Σw系下无人机原点Od初始位置</td><td>pdw==[0 0 0.372]Tm</td></tr><tr><td>Σw系下Od相对目标期望位置</td><td>pd==[-0.2 0 0.452]Tm</td></tr><tr><td>微分方程求解器</td><td>ode45(变步长Runge-Kutta)</td></tr><tr><td>最小求解步长</td><td>0.001s</td></tr><tr><td>仿真时长</td><td>10s</td></tr></table>

# 6.2.1.2 高斯扰动参数

为验证控制系统的抗扰动性能，对机体系施加服从高斯分布的干扰力  $\pmb {f}_d\in \mathbb{R}^3$  及干扰力矩  $\pmb {\tau}_d\in \mathbb{R}^3$  （噪声离散采样频率：  $50\mathrm{Hz}$  ）。

$$
\begin{array}{r}\left\{ \begin{array}{ll}f_{d_i}\sim N\big([1, - 1,0.5],0.01\big), & i = x,y,z\\ \tau_{d_i}\sim N\big([0.5,0.5,0.2],0.01\big), & i = x,y,z \end{array} \right. \end{array} \tag{6.1}
$$

# 6.2.2 运动学结果分析

在Simulink- ROS全系统联合仿真环境下按预设无人机- 机械臂模型及上节所

设参数运行算例，对仿真结果中无人机、机械臂与末端执行器的相关运动学参数展开分析。

# 6.2.2.1 旋翼无人机运动学结果

不考虑高斯扰动时，无人机采用串级PID控制律。任务执行过程中，位姿及其变化率参数的相应变化曲线如图6.10所示。可见1.8s前在俯仰角及  $X_d$  轴方向的姿态与位置产生了明显的超调；虽然至4.4s姿态恢复平衡，但俯仰角存在小幅稳态误差，且在任务时间沿  $X_d$  轴及高度方向内的位置状态尚未完全恢复平衡。

![](images/4a32f20e5a5bced7406a2c089af02e80046c027481001fb562c1dc48ca1c079d.jpg)  
图6.10无人机位姿参数响应曲线（无扰动）

进而考虑高斯扰动时，无人机采用4.1节提出的UDE- GS方法进行控制。任务执行过程中，无人机的速度及欧拉角变化率变化情况如图6.11所示。可见在起飞阶段，无人沿竖直方向发生了幅值小于  $0.03\mathrm{m / s}$ ，持续约0.06s的小幅震荡，并于1.2s左右基本恢复高度方向的平衡。沿  $X_d$  轴方向的机动相对无扰动情况发生了一定超调，并于6.8s左右基本恢复平衡。由于机械臂运动的耦合作用，欧拉角变化率会发生与滚动时域采样周期同频率的小幅跳变，至5s左右无人机姿态基本稳定在平衡位置附近。

![](images/1d015e7bca571e0449d348b299ee4ff1e382bf93a5b748491c1224dd0e93cf36.jpg)  
图6.11无人机速度与欧拉角变化率曲线

# 6.2.2.2机械臂与末端执行器运动学结果

仿真结果中，机械臂运动学参数如图6.12- 13所示，可见在执行过程中，机械臂的各关节舵机均可参照规划轨迹作动并保持了较平滑的运动状态。由于无人机偏航角变化量及目标位置与机体纵平面偏距均较小，因此舵机1仅在任务中段进行了最大幅值  $23.5^{\circ}$  的运动；通过舵机2- 4的协同运动完成了执行器向目标实时运动的目标。

![](images/ed7479351ec93fb8456023d46ad3cf17a1b605caedf21d077cf0ad741aca4e4d.jpg)  
图6.12机械臂关节角响应曲线（单位：°）

![](images/e8647b2bc8123974ea620d3ecf78ec71b73061b9db993e53ac61dee7615ae989.jpg)  
图6.13机械臂关节角速度响应曲线（单位：°/s）

末端执行器与目标的距离变化曲线如下图所示，可见按滚动时域执行策略，经过各关节舵机协同运动，在7.6s左右，执行器基本稳定在目标位置附近，进而

驱动鳍条夹指顺利完成抓取指令。

![](images/5599e1609b38d65f999b7c4023490b4f6ff7b2cb58d2e0929b5256a4b3b9845d.jpg)  
图6.14末端执行器与目标距离变化曲线对比

# 6.2.2.3基于Simscape的系统可视化仿真结果

图6.15展示了仿真中执行自主抓取任务各阶段无人机、机械臂的构型变化。图中  $\Sigma_{w}$  系以红色标记，固连于质心处的各中心惯量主轴方向以橘红色坐标系指示，末端  $\Sigma_{e}$  系以浅蓝色标记。

![](images/b30bdb6be280f3d0e1a86d5cfe50ea5fc52a559d4269b579db3045f1e2c8959a.jpg)  
图6.15自主抓取各阶段无人机、机械臂构型变化

如图6.16所示，在仿真结束时刻，无人机稳定悬停于相对于目标点的预定位置附近。经机械臂各关节舵机驱动使末端执行器实现了对立方体目标的精准抓取，且旋翼无人机平台与机械臂均处于稳定姿态。因此，在仿真预设条件下验证了无人机- 机械臂自适应控制与视觉伺服控制方案。

![](images/39354fba594c3a3c55abcadda28c6b9707b56162d09d165307a437d66186cd1e.jpg)  
图  $6.16t = 10\mathrm{s}$  完成自主抓取时系统各向视图

![](images/6cbb40d220cf1258391f7a2cb216d4797d6365c96c821eba4bf8b3f02762193d.jpg)  
图6.17 世界系下的无人机与末端执行器轨迹

图6.17展示了算例中无人机原点  $O_d$  与末端执行器(EE)中心  $O_e$  的运动轨迹图。从中可见在仿真中无人机可以沿平滑的轨迹飞抵预定目标前方，并驱动机械臂末端平稳地完成对目标的抓取任务。进一步可对不同目标及在不同扰动条件下增设Monte Carlo仿真分析以深入验证自主抓取方法的鲁棒性。

# 6.2.3 动力学结果分析

# 6.2.3.1 旋翼无人机受力情况展示分析

电机的转速是旋翼无人机动力学模型的输入量。在考虑高斯扰动的算例中，

经无人机控制分配解算、ESC驱动及电机动态模型响应后的6组无刷电机转速变化情况如图6.18所示，注意正、负分别表示逆时针与顺时针转向。

![](images/078e82e41f9561a0c36baa287c70b7da52fa0749ddf076d7a4af0e1aaf1318b7.jpg)  
图6.18 无人机各电机转速变化曲线

由旋翼电机产生的对机体的推力与反作用力矩如图6.19所示。注意此处数据均定义于与各电机固连的独立坐标系下，沿电机轴线方向朝下。由于机臂上反角的存在与实际作用与  $\Sigma_d$  系的力与力矩存在细微差别（上反角较小，影响可忽略）。

![](images/95c0834ff606fda42ff6088c948ed5d6474cda73b7d628f55ef78a67e6ce7824.jpg)  
图6.19 旋翼电机推力与力矩变化曲线

![](images/994eb4d6d5501c616bf6ca6d166b7cffcfd47d46cf80a5f360fdccffc10324d1.jpg)  
图6.20 无人机在机体系下所受气动阻力与阻尼力矩

![](images/0c6653e9310ed4a8d1413bb2d6c97883bb71afbd652cfbd992fb41602f6aad3e.jpg)  
图6.21 旋翼电机对机体系陀螺力矩变化曲线

由图中结果可知，由于无人机姿态的变化，高速旋转的无刷电机与螺旋桨会对机体产生显著变化的陀螺力矩。与旋翼电机产生的陀螺力矩相比，无人机在低速飞行或近悬停状态下的气动阻尼项为小量，而旋翼电机的陀螺效应不可忽略。

![](images/8c068ed3f7e7dd217e6599d41821d274652ab4a72b5dca3832099b27d8546c5a.jpg)

![](images/9b42f2486635227e123e066fbc6861aef4cc85d50bba6cba7496781a53e4c3ec.jpg)  
图6.22 机械臂运动过程对无人机产生的扰动力及扰动力矩

在无人机与机械臂基座固连处设置“Inertial Measurement”传感器，可记录机械臂运动过程对机体产生的扰动数据。由图6.22可知，机械臂的运动会对机体产生较为显著的扰动力矩，扰动力主要表现为机械臂的重力。在本节算例中，由于机械臂主要沿机体  $X$  轴方向运动（无人机偏航角与机械臂第1关节角的偏转较小），扰动力矩的Y轴分量较为显著。

# 6.2.3.2 机械臂运动对系统惯性参数的影响分析

由图6.23可知，在初始位形下，质心并未与前文所定义的  $\Sigma_d$  系及  $\Sigma_b$  系原点重合。特别是沿  $\Sigma_d$  系  $Z$  轴方向存在约  $- 58.9\mathrm{mm}$  的偏差。随着机械臂的各关节运动，质心沿  $\Sigma_d$  系三轴的分量均发生了不同幅度的偏移，其中  $t = 6.91\mathrm{s}$  时，  $X$  轴方向质心偏移达到  $16.05\mathrm{mm}$  。

![](images/235e5caff46784b05bab496bde4a111aa2aede01d4e9f4e2369a4683d10b9efd.jpg)  
图6.23 运动过程系统质心变化曲线

由图6.24可知，在机械臂运动过程中，系统对机体系各轴的转动惯量均发生了显著变化（忽略惯性积耦合项）；且由于质心偏移，在机体系与质心平移系下计算的转动惯量存在较大差异，对无人机姿态环控制器的影响显著。

![](images/cac05130f17ab610a349bd8a74fa26a90449c94c9251f6a6c4f7b6d634479f1b.jpg)  
图6.24 运动过程机体系及质心平行机体系转动惯量变化曲线

![](images/9bf39d80d601129a335d29d88f317abb163c6d041908b8b9cd4f6a3c13bcdc00.jpg)  
图6.25 机体系到惯量主轴坐标系欧拉角变化（单位：rad）

综上，在无人机起飞及机械臂运动过程中，系统在机体系下的质心与各轴转动惯量均发生了较显著的变化，对控制系统的鲁棒性存在较大考验。仿真算例结果表明，本文采用的UDE- GS方法可以有效克服因系统惯性参数变化及外界干扰对控制系统的影响，可以实现无人机的稳定控制与机械臂的平稳作动，完成对特定目标的精准抓取。

# 6.3 户外实物抓取试验局部验证

根据第二章所述的系统总体方案，集成六旋翼无人机、4R型机械臂、末端执行器、视觉处理模块等子系统硬件并安装调试。将基于鳍条效应的末端执行器安装到4R型机械臂的末端，完成自主抓取装置的装配与调试；将机械抓取系统安装到  $\mathrm{M600Pro}$  六旋翼无人机的正下方；将用于目标检测机载计算设备与相机安装于无人机的前下方，完成旋翼无人机空中平台的搭建；连接高清显示屏与遥控器，并将拓展组件连接到遥控器上，通过HDMI数据线将高清显示屏与便携式计算机相连，完成遥控地面站的集成。集成调试后的系统实物如图6.26所示。

进一步参考仿真模型对无人机与机械臂的控制参数进行调试，在户外环境展开初步的实物试验，重点验证文中提出的目标检测，机械臂轨迹规划与视觉伺服控制方案的可行性。

![](images/2abf6c9b1b2eecf5114bd183e35b25b3cc0a2fdb99e316fb71fe6fdb28febe17.jpg)  
图6.26基于  $\mathrm{M600Pro}$  无人机平台的实物试验系统组成

以在户外复杂环境下对哑弹等危爆品的安全处置为任务背景，展开全流程的飞行与自主抓取试验。基于旋翼无人机的自主抓取排爆任务基本流程可分为：

（1）调试系统软硬件设备，无人机平台起飞；（2）开启图像识别软件完成初始设置；（3）采集并接收视频图像数据；（5）截取当前视频图像数据，存储为标准格式图像；（6）进行几何变换、图像增强等图像预处理工作；（7）利用YOLO图像检测算法完成目标检测于识别；（8）无人机飞至目标区域悬停并着陆；（9）展开4R型机械臂接近目标，调整末端执行器准备抓取；

（10）末端执行器驱动柔性爪抓取目标；

（11）机械臂收回，无人机将目标转运到指定区域并释放；

（12）无人机返航。

无人机在起飞超过安全高度后需收起落架，以避免遮挡相机视野并扩大机械臂在基坐标系下的有效工作空间。当飞抵预定目标空域后需判断目标是否在工作空间内，若满足要求则着陆进行目标检测及后续抓取转运任务。

基于旋翼无人机的自主抓取排爆任务的详细工作流程如图6.27所示。

![](images/6eaba5b4c9503542e680741e2b61d2a50abb2c82d3c145350525ad6e254067cb.jpg)  
图6.27无人机户外自主抓取试验流程图

图6.28展示了户外飞行与抓取实物试验流程的各阶段，旋翼无人机、机械臂与末端执行器及遥控地面站的工作关系与实拍状态。

![](images/87592a707fba65dec5c0899901cd38833dba9d530fa2774300e3e4da957980eb.jpg)  
图6.28 无人机自主抓取流程实物展示

以具有典型几何特征的地面危爆品模型为目标，在5.2.3节所述目标检测结果的基础上，操控机械臂开展地面自主抓取试验，关键过程节点与抓取结果如图6.29所示。试验初步验证了在户外环境下无人机悬停至目标空域并平稳降落后，固定基座状态的机械臂应用本文所述控制方案对非合作目标进行自主抓取的可行性。

![](images/e2c61fec9ae509e928b4009a9c9598273be377cd0034ba00f81c794974e973bb.jpg)  
图6.29 户外机械臂抓取实物试验

(a) 启动机械臂控制；(b) 机械臂执行操作指令；(c) 末端执行器抓取目标；(d) 机械臂收回

# 6.4 本章小结

本章基于 Simscape 搭建了可视化的系统动力学仿真系统，将前文所述无人机、机械臂自适应控制与运动规划方法及视觉伺服方案在 Simulink- ROS 仿真环境中进行集成。通过设置包含高斯扰动的仿真算例，验证了本文所提出的自主抓取方案与视觉伺服控制系统的可行性。进一步将程序移至硬件平台进行实物试验，在 M600 Pro 六旋翼无人机平台下部分验证了目标检测与机械臂控制方案。结果表明，本论文提出的 UDE- GS 方法可以有效解决机械臂惯性参数变化与外界干扰对控制系统稳定性的影响，所设计的基于六旋翼无人机平台的自主抓取系统可以在应用组合视觉伺服控制方案的基础上完成对预定目标的精准抓取任务。

# 结束语

# 主要研究成果与结论

本文针对面向非合作目标的旋翼无人机空对地自主抓取问题为展开了系统研究，设计了结合六旋翼无人机平台与4R型机械臂的总体构型方案，在建立复合系统动力学模型的基础上，对无人机与机械臂的自适应控制及系统组合视觉伺服控制方案等技术问题进行了重点研究，主要成果与结论如下：

（1）基于拉格朗日方程建立了旋翼无人机-机械臂复合系统的动力学模型。

参照MAVROS协议及改进D- H法则对特定任务场景下的无人机- 机械臂复合系统设定对应坐标系，对无人机与机械臂分别进行运动学分析，进而推导建立了旋翼无人机的简化动力学模型与矩阵方程形式的复合系统拉格朗日动力学模型。通过对动力学模型各项分析及相应仿真算例验证确定了系统的动力学特性与模型的正确性。

（2）考虑惯性参数偏移提出了基于UDE-GS的系统自适应控制方法。

对目前旋翼无人机的底层串级PID控制逻辑进行了分析梳理，将不确定性与扰动估计器(UDE)引入控制系统中，针对机械臂实时构型的惯性参数变化设计调度增益(GS)策略。基于拟牛顿迭代法进行机械臂逆运动学求解，通过滚动时域的三次多项式方法规划关节空间下的机械臂轨迹。通过对比仿真试验证明所设计控制方法可以有效抵消动力学模型的不确定性与扰动影响。

（3）结合目标检测与EPnP位姿估计方法设计验证了系统视觉伺服控制方案。

基于YOLOv5s算法训练了检测模型并进行了目标检测试验。针对任务流程与系统构型特点提出了机载云台相机与末端随动相机结合的组合视觉伺服系统控制方案。分别在靠近与抓取阶段采用基于EPnP位姿估计的PBVS与基于图像雅克比的IBVS视觉伺服方法，可以实现对非合作目标的精准自主抓取。

（4）在Simulink-ROS环境下完成系统联合仿真分析并开展了局部实物试验。

在Simulink中构建了基于Simscape的集成仿真模型，并将本文所设计的无人机- 机械臂视觉伺服控制方案通过Simulink控制系统与ROS端的目标检测信息结合进行联合闭环仿真，设定固定立体靶标并增加适当扰动，验证了不同工况下全系统视觉伺服控制方案的可行性。此外，前述目标检测与机械臂视觉伺服控制方案在M600Pro无人机平台上开展了户外实飞与分系统测试验证。

综上，本文所提出的无人机与机械臂的自适应控制律与运动规划方法，及系统视觉伺服控制方案具有良好的抗扰性能，能够实现对预定非合作目标的自主抓取，对基于旋翼飞行机械臂的工程应用具有较高参考价值。

# 未来研究工作与展望

本论文初步搭建了无人机- 机械臂复合动力学系统的控制仿真平台，对其耦合运动特性与视觉伺服控制等方面问题进行了系统的研究分析。由于时间与精力限制，研究工作尚存在许多不足，难以直接指导实际工程应用，尚需展开下述进一步探索：

（1）考虑无人机传感器模型，完善组合导航算法

本文中的仿真程序未考虑的加速度计、陀螺仪、GNSS等传感器模型，假定控制系统可精确获取无人机状态信息，故与实物试验条件存在较大差异。未来可在仿真中设置传感器模型，加入MEMS惯组噪声等误差模型，并应用卡尔曼滤波算法将优化的组合导航信息传递给控制系统，以更好地贴近实际试验情况。

（2）借鉴主流平台开源程序，优化控制逻辑与参数

对于无人机飞控系统，应充分借鉴PX4的控制逻辑。对于机器视觉控制系统，目前仅调用了ROS在Gazebo下的机器视觉模块。未来应考虑进一步在ROS系统下集成无人机与机械臂的动力学与控制模块，将机械臂参数以URDF或XARCO标准格式统一导入仿真环境。目前无人机的控制参数由人工逐步调试，并非最优，可利用PSO等智能算法迭代优化。此外，在仿真中机械臂未实现考虑动力学的控制律设计。未来可完善舵机反馈模型，可引入机器人的阻抗或导纳控制律，同时在机械臂的轨迹规划中可进一步考虑避障问题。

（3）引入双目立体视觉，实现更精准地位姿估计

本文设计的视觉伺服系统中机载相机与末端随动相机按不同阶段分别设置相应控制逻辑，未利用双目立体视觉信息进行位姿估计。未来可以考虑为机载系统配备激光测距雷达，借助点云等前沿技术进行数据融合通过立体视觉更精准地进行位姿估计。在室内环境通过动作捕捉系统（OptiTrack）实现无卫星定位条件下的无人机-机械臂系统的测试试验。

（4）完善部署嵌入式硬件系统的控制程序，展开进一步实物试验

目前户外自主抓取试验中大疆飞控与机械臂视觉伺服系统独立工作，未充分应用Simulink仿真中的UDE- GS控制逻辑。未来可利用DJIOSDK，在ROS- Gazebo仿真环境下充分测试后，在Manifold- C机载计算机上进一步集成调试控制算法。仿真模型参数与真机参数差异较大，可对真机进行更精确的参数测量与动力学参数辨识。进一步将PX4飞控或大疆A3飞控嵌入半实物仿真环境，优化仿真中的参数以更好地为实物试验做参考。

# 参考文献

[1] 全权. 多旋翼飞行器设计与控制 [M]. 北京: 电子工业出版社, 2018. [2] Ding X, Guo P, Xu K, et al. A review of aerial manipulation of small- scale rotorcraft unmanned robotic systems [J]. Chinese Journal of Aeronautics, 2019, 32(1): 200- 214. [3] Meng X, He Y, Han J. Survey on Aerial Manipulator: System, Modeling, and Control [J]. Robotica, 2020, 38(7): 1288- 1317. [4] Thomas J, Loianno G, Daniilidis K, et al. Visual Serving of Quadrotors for Perching by Hanging From Cylindrical Objects [J]. IEEE Robotics and Automation Letters, 2016, 1(1): 57- 64. [5] Thomas J, Loianno G, Polin J, et al. Toward Autonomous Avian- Inspired Grasping for Micro Aerial Vehicles [J]. Bioinspiration & Biomimetics, 2014, 9(2): 025010. [6] Gawel A, Kamel M, Novkovic T, et al. Aerial Picking and Delivery of Magnetic Objects with MAVs [C]. 2017 IEEE International Conference on Robotics and Automation (ICRA). Singapore. IEEE, 2017: 5746- 5752. [7] Estrada M A, Mintchev S, Christensen D L, et al. Forceful manipulation with micro air vehicles [J]. Science Robotics, 2018, 3(23): eaau6903. [8] 张广玉, 何玉庆, 代波, 等. 面向抓取作业的飞行机械臂系统及其控制 [J]. 机器人, 2019, 41(1): 19- 29. [9] Lin L, Yang Y, Cheng H, et al. Autonomous Vision- Based Aerial Grasping for Rotorcraft Unmanned Aerial Vehicles [J]. Sensors (Basel), 2019, 19(15): 3410. [10] 何慰, 方勇纯, 梁潇, 等. 一种两自由度飞行机械臂系统的设计与实现 [J]. 航空学报, 2021, 41(2): 264- 274. [11] 熊靖丰. 带单关节机械臂四旋翼无人机建模与控制 [D]. 上海: 上海交通大学, 2018. [12] 李选聪. 多旋翼无人机的机械臂抓取动力学分析和控制研究 [D]. 哈尔滨: 哈尔滨工业大学, 2016. [13] Delamare Q, Giordano P R, Franchi A. Toward Aerial Physical Locomotion: The Contact- Fly- Contact Problem [J]. IEEE Robotics and Automation Letters, 2018, 3(3): 1514- 1521. [14] Lee H, Kim H, Kim H J. Planning and Control for Collision- Free cooperative aerial transportation [J]. IEEE Transactions on Automation Science and Engineering, 2018, 15(1): 189- 201. [15] Lee H, Kim S, Kim H J. Control of an Aerial Manipulator using On- line Parameter Estimator for an unknown payload [C]. 2015 IEEE International Conference

on Automation Science and Engineering (CASE). Gothenburg, Sweden. IEEE, 2015: 316- 321.

[16] Ding L, Wu H. Dynamical Modelling and Robust Control for an Unmanned Aerial Robot Using Hexarotor with 2- DOF Manipulator [J]. International Journal of Aerospace Engineering, 2019, 2019: 5483073.

[17] 刘金辉. 六自由度并联型飞行机械臂系统设计、建模与控制 [D]. 哈尔滨: 哈尔滨工业大学, 2021.

[18] Laiacker M, Huber F, Kondak K. High accuracy visual servoing for aerial manipulation using a 7 degrees of freedom industrial manipulator [C]. 2016 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Daejeon. IEEE, 2016: 1631- 1636.

[19] Wu C, Qi J, Song D, et al. Development of an unmanned helicopter automatic barrels transportation system [C]. 2015 IEEE International Conference on Robotics and Automation (ICRA). Seattle, WA. IEEE, 2015: 4686- 4691.

[20] Huber F, Kondak K, Krieger K, et al. First Analysis and Experiments in Aerial Manipulation Using Fully Actuated Redundant Robot Arm [C]. 2013 IEEE/RSJ International Conference on Intelligent Robots and Systems. Tokyo. IEEE, 2013: 3452- 3457.

[21] Staub N, Bicego D, Sablé Q, et al. Towards a Flying Assistant Paradigm: the OTHex [C]. 2018 IEEE International Conference on Robotics & Automation. Brisbane, QLD. IEEE, 2018: 6997- 7002.

[22] Gabrich B, Saldaña D, Kumar V, et al. A Flying Gripper Based on Cuboid Modular Robots [C]. 2018 IEEE International Conference on Robotics and Automation (ICRA). Brisbane, QLD. IEEE, 2018: 7024- 7030.

[23] Haberfeld G B, Sun D, Hovakimyan N. Stabilization and Optimal Trajectory Generation for a Compact Aerial Manipulation System with a Delta- type Parallel Robot [C]. 2018 International Conference on Unmanned Aircraft Systems (ICUAS). Dallas, TX. IEEE, 2018: 1091- 1100.

[24] Zhang Y, Xiang C, Xu B, et al. Design and Implementation of a Novel Aerial Manipulator with Tandem Ducted Fans [C]. 2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Madrid. IEEE, 2018: 4210- 4217.

[25] Korpela C, Orsag M, Danko T, et al. Flight stability in aerial redundant manipulators [C]. 2012 IEEE International Conference on Robotics and Automation. Saint Paul, MN. IEEE, 2012: 3529- 3530.

[26] Jimenez- Cano A E, Braga J, Heredia G, et al. Aerial manipulator for structure inspection by contact from the underside [C]. 2015 IEEE/RSJ International Conference on Intelligent Robots & Systems. Hamburg. IEEE, 2015: 1879- 1884.

[27] Baizid K, Giglio G, Pierri F, et al. Experiments on behavioral coordinated

control of an Unmanned Aerial Vehicle manipulator system [C]. 2015 IEEE International Conference on Robotics and Automation (ICRA). Seattle, WA. IEEE, 2015: 4680- 4685.

[28] Zhang G, He Y, Dai B, et al. Grasp a Moving Target from the Air: System & Control of an Aerial Manipulator [C]. 2018 IEEE International Conference on Robotics and Automation (ICRA). Brisbane. IEEE, 2018: 1681- 1687.

[29] Danko T W, Oh P Y. A hyper- redundant manipulator for mobile manipulating unmanned aerial vehicles [C]. 2013 International Conference on Unmanned Aircraft Systems (ICUAS). Atlanta, GA. IEEE, 2013: 974- 981.

[30] Bartelds T, Capra A, Hamaza S, et al. Compliant Aerial Manipulators: Toward a New Generation of Aerial Robotic Workers [J]. IEEE Robotics and Automation Letters, 2016, 1: 477- 483.

[31] Caballero A, Suarez A, Real F, et al. First Experimental Results on Motion Planning for Transportation in Aerial Long- Reach Manipulators with Two Arms [C]. 2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Madrid. IEEE, 2018: 8471- 8477.

[32] Korpela C, Orsag M, Oh P. Valve turning using a dual- arm aerial manipulator [C]. IEEE/RSJ International Conference on Intelligent Robots & Systems. Orlando, FL. IEEE, 2014: 3411- 3416.

[33] Kamel M, Alexis K, Siegwart R. Design and Modeling of Dexterous Aerial Manipulator [C]. 2016 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Daejeon. IEEE, 2016: 4870- 4876.

[34] Kim S J, Lee D Y, Jung G P, et al. An origami- inspired, self- locking robotic arm that can be folded flat [J]. Science Robotics, 2018, 3(16): eara2915.

[35] Ma R, Dollar A. Yale OpenHand Project: Optimizing Open- Source Hand Designs for Ease of Fabrication and Adoption [J]. IEEE Robotics & Automation Magazine, 2017, 24(1): 32- 40.

[36] Crooks W, Yukasin G, O'sullivan M, et al. Fin Ray® Effect Inspired Soft Robotic Gripper: From the RoboSoft Grand Challenge toward Optimization [J]. Frontiers in Robotics and AI, 2016, 3: 70.

[37] 刘超, 张广玉, 熊安斌. 旋翼飞行机械臂研究综述 [J]. 高技术通讯, 2020, 30(7): 735- 747.

[38] Orsag M, Korpela C, Pekala M, et al. Stability control in aerial manipulation [C]. 2013 American Control Conference (ACC). Washington DC, 2013: 5581- 5586.

[39] Lippiello V, Ruggiero F. Cartesian Impedance Control of a UAV with a Robotic Arm [J]. IFAC Proceedings Volumes, 2012, 45(22): 704- 709.

[40] Bonyan Khamseh H, Janabi- Sharifi F, Abdessameud A. Aerial manipulation—A literature survey [J]. Robotics and Autonomous Systems, 2018, 107:

221- 235.

[41] 王耀兵. 空间机器人(Space Robotics) [M]. 北京: 北京理工大学出版社, 2018.

[42] Qi Y, Wang J, Shan J. Aerial cooperative transporting and assembling control using multiple quadrotor- manipulator systems [J]. International Journal of Systems Science, 2017, 49(3): 662- 676.

[43] Lippiello V, Ruggiero F. Exploiting redundancy in Cartesian impedance control of UAVs equipped with a robotic arm [C]. 2012 IEEE/RSJ International Conference on Intelligent Robots & Systems. Vilamoura- Algarve. IEEE, 2012: 3768- 3773.

[44] 宋大雷, 孟祥冬, 齐俊桐, 等. 3 自由度旋翼飞行机械臂系统动力学建模与预测控制方法 [J]. 机器人, 2015, 37(2): 152- 160.

[45] Арнольд В И. 经典力学的数学方法, 第4版 [M]. 齐民友译. 北京: 高等教育出版社, 1999.

[46] Gu E Y L. A Journey from Robot to Digital Human: Mathematical Principles and Applications with MATLAB Programming [M]. Berlin, Heidelberg: Springer, 2013.

[47] Meng X, He Y, Li Q, et al. Contact Force Control of an Aerial Manipulator in Pressing an Emergency Switch Process [C]. 2018 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Madrid. IEEE, 2019: 2107- 2113.

[48] Arleo G, Caccavale F, Muscio G, et al. Control of quadrotor aerial vehicles equipped with a robotic arm [C]. 21st Mediterranean Conference on Control and Automation. Platanias- Chania, Crete. IEEE, 2013: 1174- 1180.

[49] Konstantin, Kondak, Kai, et al. Closed- Loop Behavior of an Autonomous Helicopter Equipped with a Robotic Arm for Aerial Manipulation Tasks [J]. International Journal of Advanced Robotic Systems, 2013, 10(2): 145.

[50] Jimenez- Cano A E, Heredia G, Bejar M, et al. Modelling and control of an aerial manipulator consisting of an autonomous helicopter equipped with a multi- link robotic arm [J]. Proceedings of the Institution of Mechanical Engineers, Part G: Journal of Aerospace Engineering, 2015, 230(10): 1860- 1870.

[51] 钟杭, 王耀南, 李玲, 等. 旋翼飞行机械臂建模及动态重心补偿控制 [J]. 控制理论与应用, 2016, 33(3): 42- 51.

[52] Khalifa A, Fanni M. A new quadrotor manipulation system: Modeling and point- to- point task space control [J]. International Journal of Control Automation and Systems, 2016, 15(3): 1- 13.

[53] Fanni M, Khalifa A. A New 6- DOF Quadrotor Manipulation System: Design, Kinematics, Dynamics and Control [J]. IEEE/ASME Transactions on Mechatronics, 2017, 22(3): 1315- 1326.

[54] Sharifi M, Sayyaadi H. Nonlinear robust adaptive Cartesian impedance control of UAVs equipped with a robot manipulator [J]. Advanced Robotics, 2015, 29(3): 171- 186.

[55] Garimella G, Kobilarov M. Towards model- predictive control for aerial pick- and- place [C]. 2015 IEEE International Conference on Robotics and Automation (ICRA). Seattle, WA. IEEE, 2015: 4692- 4697.

[56] Caccavale F, Giglio G, Muscio G, et al. Adaptive control for UAVs equipped with a robotic arm [J]. IFAC Proceedings Volumes, 2014, 47(3): 11049- 11054.

[57] Darivianakis G, Alexis K, Burri M, et al. Hybrid Predictive Control for Aerial Robotic Physical Interaction towards Inspection Operations [C]. 2014 IEEE International Conference on Robotics and Automation (ICRA). Hong Kong. IEEE, 2014: 53- 58.

[58] Zhong Q- C, Rees D. Control of Uncertain LTI Systems Based on an Uncertainty and Disturbance Estimator [J]. Journal of Dynamic Systems, Measurement, and Control, 2004, 126(4): 905- 910.

[59] Lu Q, Ren B, Parameswaran S, et al. Uncertainty and Disturbance Estimator- Based Robust Trajectory Tracking Control for a Quadrotor in a Global Positioning System- Denied Environment [J]. Journal of Dynamic Systems, Measurement, and Control, 2018, 140(3): 031001.

[60] Qi Y, Zhu Y, Wang J, et al. MUDE- based control of quadrotor for accurate attitude tracking [J]. Control Engineering Practice, 2021, 108: 104721.

[61] 任君凯. 面向机器人自主抓取控制的深度增强学习方法研究 [D]. 长沙: 国防科技大学, 2022.

[62] Liu M, Pan Z, Xu K, et al. Generating Grasp Poses for a High- DOF Gripper Using Neural Networks [C]. 2019 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS). Macau. IEEE, 2020: 1518- 1525.

[63] 徐文福, 梁斌. 冗余空间机器人操作臂: 运动学、轨迹规划与控制 [M]. 北京: 科学出版社, 2017.

[64] Meng X, He Y, Wang Q, et al. Force- Sensorless Contact Force Control of an Aerial Manipulator System [C]. 2018 IEEE International Conference on Real- time Computing and Robotics (RCAR). Kandima. IEEE, 2018: 595- 600.

[65] Ryll M, Muscio G, Pierri F, et al. 6D Physical Interaction with a Fully Actuated Aerial Robot [C]. 2017 IEEE International Conference on Robotics and Automation (ICRA). Singapore. IEEE, 2017: 5190- 5195.

[66] Vempati A S, Khurana H, Kabelka V, et al. A Virtual Reality Interface for an Autonomous Spray Painting UAV [J]. IEEE Robotics and Automation Letters, 2019, 4(3): 2870- 2877.

[67] Chen H, Quan F, Fang L, et al. Aerial Grasping with a Lightweight

Manipulator Based on Multi- Objective Optimization and Visual Compensation [J]. Sensors, 2019, 19(19): 4253.

[68] Lippiello V, Cacace J, Santamaria- Navarro A, et al. Hybrid Visual Servoing With Hierarchical Task Composition for Aerial Manipulation [J]. IEEE Robotics & Automation Letters, 2017, 1(1): 259- 266.

[69] Kim S, Seo H, Choi S, et al. Vision- Guided Aerial Manipulation Using a Multirotor With a Robotic Arm [J]. IEEE/ASME Transactions on Mechatronics, 2016, 21(4): 1- 1.

[70] Thomas J, Loianno G, Sreenath K, et al. Toward image based visual servoing for aerial grasping and perching [C]. 2014 IEEE International Conference on Robotics and Automation (ICRA). Hong Kong. IEEE, 2014: 2113- 2118.

[71] Krizhevsky A, Sutskever I, Hinton G E. ImageNet Classification with Deep Convolutional Neural Networks [J]. Communications of the ACM, 2017, 60(6): 84- 90.

[72] Ross G, Jeff D, Trevor D, et al. Rich Feature Hierarchies for Accurate Object Detection and Semantic Segmentation [C]. 2014 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). Columbus, OH. IEEE, 2014: 580- 587.

[73] Joseph R, Santosh D, Ross G, et al. You Only Look Once Unified, Real- Time Object Detection [C]. 2016 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). Las Vegas, NV. IEEE, 2016: 779- 788.

[74] Liu W, Anguelov D, Erhan D, et al. SSD: Single Shot MultiBox Detector [C]. 14th European Conference on Computer Vision (ECCV). Amsterdam. Springer, 2016: 21- 37.

[75] 程兴. 基于无人机的地面目标识别与跟踪 [D]. 哈尔滨: 哈尔滨工业大学, 2019.

[76] Bolme D S, Beveridge J R, Draper B A, et al. Visual Object Tracking using Adaptive Correlation Filters [C]. 23rd IEEE Conference on Computer Vision and Pattern Recognition. San Francisco, CA. IEEE, 2010: 2544- 2550.

[77] Henriques J F, Caseiro R, Martins P, et al. High- Speed Tracking with Kernelized Correlation Filters [J]. IEEE Transactions on Pattern Analysis & Machine Intelligence, 2015, 37(3): 583- 596.

[78] 刘轩岑. 基于视觉导引的微小型无人机目标跟踪与飞行控制系统研究 [D]. 长沙: 国防科技大学, 2021.

[79] Assa A, Janabi- Sharifi F. A Robust Vision- Based Sensor Fusion Approach for Real- Time Pose Estimation [J]. IEEE Transactions on Cybernetics, 2014, 44(2): 217- 227.

[80] Janabi- Sharifi F M, M. A Kalman- Filter- Based Method for Pose Estimation in Visual Servoing [J]. IEEE Transactions on Robotics, 2010, 26(5): 939- 947.

[81] Tsai R Y, Lenz R K. A New Technique for Fully Autonomous and Efficient

3D Robotics Hand- Eye Calibration [J]. IEEE Transactions on Robotics & Automation, 1989, 5(3): 345- 358.

[82] 邱周静子. 基于预测控制的机械臂约束视觉伺服研究 [D]. 上海: 上海交通大学, 2019.

[83] Mousavian A, Eppner C, Fox D. 6- DOF GraspNet: Variational Grasp Generation for Object Manipulation [C]. 2019 IEEE/CVF International Conference on Computer Vision (ICCV). Seoul. IEEE, 2019: 2901- 2910.

[84] Fang H- S, Wang C, Gou M, et al. GraspNet- 1Billion: A Large- Scale Benchmark for General Object Grasping [C]. 2020 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR). Seattle, WA. IEEE, 2020: 11441- 11450.

[85] Kehl W, Manhardt F, Tombari F, et al. SSD- 6D: Making RGB- based 3D detection and 6D pose estimation great again [C]. 2017 IEEE International Conference on Computer Vision (ICCV). Venice. IEEE, 2017: 1530- 1538.

[86] Wang C, Xu D, Zhu Y, et al. DenseFusion: 6D Object Pose Estimation by Iterative Dense Fusion [C]. 2019 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR). Long Beach, CA. IEEE, 2019: 3338- 3347.

[87] 孙敬陶. 旋翼飞行机械臂系统的机器视觉伺服算法研究 [D]. 长沙: 湖南大学, 2019.

[88] 罗燕杨. 基于物体三维信息的飞行机械臂抓取研究 [D]. 绵阳: 西南科技大学, 2021.

[89] Dji 大疆创新. 经纬 MATRICE 600 PRO 技术参数 [EB/OL]. https://www.dji.com/cn/matrice600- pro/info#specs, 2018- 04- 17/2021- 06- 19.

[90] Craig J J. Introduction to Robotics: Mechanics and Control, 4th Edition [M]. London: Pearson Education, Inc., 2018.

[91] Corke P. Robotics, Vision And Control: Fundamental Algorithms in MATLAB, 2nd Edition [M]. Cham: Springer, 2017.

[92] Siciliano B, Sciavicco L, Villani L, et al. Robotics: Modelling, Planning and Control [M]. London: Springer, 2010.

[93] 孙世贤, 黄圳圭, 唐乾刚. 理论力学教程, 第 2 版 [M]. 长沙: 国防科技大学出版社, 2009.

[94] 范智伟. 一种多旋翼无人飞行器的总体设计与实现 [D]. 武汉: 华中科技大学, 2016.

[95] Shi D, Dai X, Zhang X, et al. A Practical Performance Evaluation Method for Electric Multicopters [J]. IEEE/ASME Transactions on Mechatronics, 2017, 22(3): 1337- 1348.

[96] Rugh W J, Shamma J S. Research on Gain Scheduling [J]. Automatica, 2000, 36(10): 1401- 1425.

[97] Mathworks. Inverse Kinematics Algorithms [EB/OL]. https://www.mathworks.com/help/robotics/ug/inverse- kinematics- algorithms.html, 2021- 10- 12. [98] 徐德, 谭民, 李原. 机器人视觉测量与控制, 第 3 版 [M]. 齐民友. 北京: 国防工业出版社, 2015. [99] Jocher G. YOLov5 in PyTorch > ONNX > CoreML > TFLite [EB/OL]. https://github.com/ultralytics/yolov5, 2022- 02- 22/2022- 03- 12. [100] 江大白. Yolov5 核心基础知识完整讲解 [EB/OL]. https://zhuanlan.zhihu.com/p/172121380, 2022- 04- 01/2022- 04- 21. [101] Lepetit V, Moreno- Noguer F, Fua P. EPnP: An Accurate O(n) Solution to the PnP Problem [J]. International Journal of Computer Vision, 2008, 81(2): 155- 166. [102] Garrido- Jurado S, Muñoz- Salinas R, Madrid- Cuevas F J, et al. Automatic generation and detection of highly reliable fiducial markers under occlusion [J]. Pattern Recognition, 2014, 47(6): 2280- 2292. [103] Tordal S S, Hovland G. Relative Vessel Motion Tracking using Sensor Fusion, Aruco Markers, and MRU Sensors [J]. Modeling, Identification and Control: A Norwegian Research Bulletin, 2017, 38(2): 79- 93.

# 附录 系统动力学相关参数补充

# 六旋翼无人机惯性参数（DJI S900仿真）

Mass_Drone=3.3kg  $\%$  无人机质量（除相机起落架等额外零部件）Mass_Cam1=0.0102kg;  $\%$  EE相机质量Mass_LowerGear=0.220156kg;  $\%$  起落架总质量将机械臂视为质点添加到无人机质心处时，沿机体系各轴的转动惯量为：

$$
I_{x} = 0.1203\mathrm{kg}\cdot \mathrm{m}^{2},\quad I_{y} = 0.1176\mathrm{kg}\cdot \mathrm{m}^{2},\quad I_{z} = 0.1176\mathrm{kg}\cdot \mathrm{m}^{2}
$$

无刷电机转子与螺旋桨转动惯量

$$
I_{r} = 8.06\times 10^{-4}\mathrm{kg}\cdot \mathrm{m}^{2}
$$

# 4R型机械臂惯性参数

各连杆质量属性如下（单位：kg）：

Mass_Link1Base=0.854012;  $\%$  连杆1- 基座Mass_Link1Servo=0.725309;  $\%$  连杆1- 舵机Mass_Link2=0.095441;  $\%$  连杆2Mass_Link3=0.136074;  $\%$  连杆3Mass_Link4Servo=0.0980389;  $\%$  连杆4- 舵机Mass_EEBase=0.423394;  $\%$  末端执行器- 基座Mass_Fin=0.0153053;  $\%$  末端执行器- 鳍条Mass Bracket=0.00530913;  $\%$  末端执行器- 移动基座

# 复合系统惯性参数

总质量：5.9139kg 机体系下初始位形惯性张量：

$$
I_{d} = \left[ \begin{array}{lll}0.2316 & 0.0001 & 0.0254 \\ 0.0001 & 0.2405 & 0.0002 \\ 0.0254 & 0.0002 & 0.2113 \end{array} \right]\mathrm{kg}\cdot \mathrm{m}^{2}
$$

基坐标系下初始位形惯性张量：

$$
I_{d}^{b} = M_{1}(\pi)\cdot I_{d}\cdot (M_{1}(\pi))^{\mathrm{T}}\cdot = \left[ \begin{array}{lll}0.2316 & -0.0001 & -0.0254 \\ -0.0001 & 0.2405 & 0.0002 \\ -0.0254 & 0.0002 & 0.2113 \end{array} \right]\mathrm{kg}\cdot \mathrm{m}^{2}
$$

# 电调参数

由系统最大总质量  $12\mathrm{kg}$  反算电调参数，限定最大转速：652.6058rad/s

![](images/ad897f49ba94df03293eea11f6e45001169a2e15c400a903aeefee43297b4b09.jpg)  
Flyeval动力学评估参数设置与计算结果

多旋翼总质量  $\begin{array}{rl}{\mathrm{~:~m~}}&{=6\mathrm{~kg~}}\\{\mathrm{~:~g~}}&{=9.8\mathrm{~m/s^2~}}\\{\mathrm{~:~J_{xx}~}}&{=2.483\mathrm{e - 1~kg.m^2~}}\\{\mathrm{~:~J_{yy}~}}&{=2.483\mathrm{e - 1~kg.m^2~}}\\{\mathrm{~:~J_{zz}~}}&{=4.408\mathrm{e - 1~kg.m^2~}}\\{\mathrm{~:~d~}}&{=0.45\mathrm{~m~}}\end{array}$  重力加速度转动惯量矩阵 $\mathbf{J} = \mathrm{diag}(\mathbf{J}_{\mathrm{XX}},\mathbf{J}_{\mathrm{YY}},\mathbf{J}_{\mathrm{ZZ}})$ 多旋翼机身半径  $(1 / 2$  轴距）单桨综合拉力系数，拉力  $(\mathrm{N})_{\mathrm{SS}}$  以转速  $\mathrm{^2(rad / s)}$  即  $(\mathrm{C_t} = \mathrm{T_p} / \omega^2)$ 单桨综合力矩系数，力矩  $(\mathrm{N},\mathrm{m})$  除以转速  $\mathrm{^2(rad / s)}$  即  $(\mathrm{C_{dm} = M / w^2})$ 电机曲线：输入油门量  $(0\sim 1)$  到：电机稳态转速  $\omega_{\mathrm{ss}}$  (rad/s) $(\omega_{\mathrm{ss}} = \mathrm{C_R}^* \sigma + \omega_{\mathrm{b}})$  电机螺旋桨转动惯量电机响应时间常数机身阻力系数，阻力(N)除以飞行速度  $\mathrm{^2(m / s)}$  ，即  $(\mathrm{C_d} = \mathrm{D} / \mathrm{V}^2)$ 机身阻尼力矩系数，力矩(N)除以转速  $\mathrm{^2(rad / s)}$  ，即  $(\mathrm{C_{dm} = M / w^2})$

# 齐次变换  ${}^{b}T_{e}$  完整形式

将4R型机械臂D- H参数代入(3.16)式，展开可得：

$$
{}^{b}T_{e} = \left[ \begin{array}{cccc}R_{11} & R_{12} & R_{13} & p_{x}\\ R_{21} & R_{22} & R_{23} & p_{y}\\ R_{31} & R_{32} & R_{33} & p_{z}\\ 0 & 0 & 0 & 1 \end{array} \right]
$$

为节约篇幅，约定  $s\theta = \sin \theta$  ，  $c\theta = \cos \theta$  ，则  ${}^{b}T_{e}$  各分量表示为：

$$
\begin{array}{rl} & {R_{11} = \mathsf{c}\theta_{4}\mathsf{c}\theta_{1}\mathsf{c}\big(\theta_{2} + \theta_{3}\big) - \mathsf{s}\theta_{4}\mathsf{c}\theta_{1}\mathsf{s}\big(\theta_{2} + \theta_{3}\big)}\\ & {R_{12} = -s\theta_{4}c\theta_{1}c\big(\theta_{2} + \theta_{3}\big) - c\theta_{4}c\theta_{1}s\big(\theta_{2} + \theta_{3}\big)} \end{array}
$$

$R_{13} = - s\theta_{1}$ $R_{21} = s\theta_{1}\left(c\theta_{4}c\left(\theta_{2} + \theta_{3}\right) - s\theta_{4}s\left(\theta_{2} + \theta_{3}\right)\right) = s\theta_{1}c\left(\theta_{2} + \theta_{3} + \theta_{4}\right)$ $R_{22} = - c\theta_{4}\left(c\theta_{2}s\theta_{1}s\theta_{3} + c\theta_{3}s\theta_{1}s\theta_{2}\right) - s\theta_{4}\left(c\theta_{2}c\theta_{3}s\theta_{1} - s\theta_{1}s\theta_{2}s\theta_{3}\right)$ $R_{23} = c\theta_{1}$ $R_{31} = - c\theta_{4}\left(c\theta_{3}s\theta_{2} + s\theta_{2}s\theta_{3}\right) - s\theta_{4}\left(c\theta_{3}s\theta_{2} - s\theta_{2}s\theta_{3}\right)$ $R_{32} = s\theta_{4}\left(c\theta_{3}s\theta_{2} + s\theta_{2}s\theta_{3}\right) - c\theta_{4}\left(c\theta_{3}s\theta_{2} - s\theta_{2}s\theta_{3}\right)$ $R_{33} = 0$ $p_{x} = L_{2}c\theta_{1}c\theta_{2} - L_{4}^{y}\left(c\theta_{4}c\theta_{1}s\left(\theta_{2} + \theta_{3}\right) + s\theta_{4}c\theta_{1}c\left(\theta_{2} + \theta_{3}\right)\right)$ $- L_{4}\left(- c\theta_{4}c\theta_{1}c\left(\theta_{2} + \theta_{3}\right) + s\theta_{4}c\theta_{1}s\left(\theta_{2} + \theta_{3}\right)\right) + L_{3}c\theta_{1}c\left(\theta_{2} + \theta_{3}\right)$ $p_{y} = s\theta_{1}\left( \begin{array}{l}L_{3}c\left(\theta_{2} + \theta_{3}\right) - L_{4}^{y}\left(c\theta_{4}s\left(\theta_{2} + \theta_{3}\right) + s\theta_{4}c\left(\theta_{2} + \theta_{3}\right)\right)\\ +L_{4}\left(c\theta_{4}c\left(\theta_{2} + \theta_{3}\right) - s\theta_{4}s\left(\theta_{2} + \theta_{3}\right)\right) + L_{2}c\theta_{2} \end{array} \right)$ $p_{z} = L_{1} + L_{3}\left(c_{3}s_{2} + s_{2}s_{3}\right) - L_{4}^{y}\left(c_{4}\left(c_{3}s_{2} - s_{2}s_{3}\right) - s_{4}\left(c_{3}s_{2} + s_{2}s_{3}\right)\right)$ $- L_{2}s_{2} - L_{4}\left(c_{4}\left(c_{3}s_{2} + s_{2}s_{3}\right) + s_{4}\left(c_{3}s_{2} - s_{2}s_{3}\right)\right)$